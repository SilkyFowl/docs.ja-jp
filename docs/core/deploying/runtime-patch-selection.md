---
title: .NET Core での自己完結型アプリのデプロイにおけるランタイムのロール フォワード
description: 自己完結型展開における dotnet publish の変更について説明します。
author: KathleenDollard
ms.date: 05/31/2018
ms.openlocfilehash: 6bc578c63b28f51f1dd98e3e7e56fbe2c7a3e7cf
ms.sourcegitcommit: f2ab02d9a780819ca2e5310bbcf5cfe5b7993041
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/03/2021
ms.locfileid: "99505909"
---
# <a name="self-contained-deployment-runtime-roll-forward"></a><span data-ttu-id="3f584-103">自己完結型展開ランタイムのロール フォワード</span><span class="sxs-lookup"><span data-stu-id="3f584-103">Self-contained deployment runtime roll forward</span></span>

<span data-ttu-id="3f584-104">.NET Core [自己完結型のアプリケーション展開](index.md)には、.NET Core ライブラリと .NET Core ランタイムの両方が含まれます。</span><span class="sxs-lookup"><span data-stu-id="3f584-104">.NET Core [self-contained application deployments](index.md) include both the .NET Core libraries and the .NET Core runtime.</span></span> <span data-ttu-id="3f584-105">.NET Core 2.1 SDK (バージョン 2.1.300) 以降、自己完結型のアプリケーションのデプロイ[では、お使いのコンピューター上にある最新の修正プログラムのランタイムを発行するようになりました](https://github.com/dotnet/designs/blob/main/accepted/2018/self-contained-roll-forward.md)。</span><span class="sxs-lookup"><span data-stu-id="3f584-105">Starting in .NET Core 2.1 SDK (version 2.1.300), a self-contained application deployment [publishes the highest patch runtime on your machine](https://github.com/dotnet/designs/blob/main/accepted/2018/self-contained-roll-forward.md).</span></span> <span data-ttu-id="3f584-106">既定では、自己完結型展開のための [`dotnet publish`](../tools/dotnet-publish.md) では、発行マシン上に SDK の一部としてインストールされている最新バージョンが選択されます。</span><span class="sxs-lookup"><span data-stu-id="3f584-106">By default, [`dotnet publish`](../tools/dotnet-publish.md) for a self-contained deployment selects the latest version installed as part of the SDK on the publishing machine.</span></span> <span data-ttu-id="3f584-107">これにより、展開したアプリケーションを `publish` 時に利用可能なセキュリティ修正プログラム (およびその他の修正) と共に実行できます。</span><span class="sxs-lookup"><span data-stu-id="3f584-107">This enables your deployed application to run with security fixes (and other fixes) available during `publish`.</span></span> <span data-ttu-id="3f584-108">新しい修正プログラムを取得するには、アプリケーションを再発行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3f584-108">The application must be republished to obtain a new patch.</span></span> <span data-ttu-id="3f584-109">`dotnet publish` コマンドで `-r <RID>` を指定するか、プロジェクト ファイル (csproj / vbproj) 内またはコマンド ライン上で [ランタイム識別子 (RID)](../rid-catalog.md) を指定すると、自己完結型のアプリケーションが作成されます。</span><span class="sxs-lookup"><span data-stu-id="3f584-109">Self-contained applications are created by specifying `-r <RID>` on the `dotnet publish` command or by specifying the [runtime identifier (RID)](../rid-catalog.md) in the project file (csproj / vbproj) or on the command line.</span></span>

## <a name="patch-version-roll-forward-overview"></a><span data-ttu-id="3f584-110">修正プログラムのバージョンのロール フォワードの概要</span><span class="sxs-lookup"><span data-stu-id="3f584-110">Patch version roll forward overview</span></span>

<span data-ttu-id="3f584-111">[`restore`](../tools/dotnet-restore.md)、[`build`](../tools/dotnet-build.md) および [`publish`](../tools/dotnet-publish.md) は、個別に実行できる `dotnet` コマンドです。</span><span class="sxs-lookup"><span data-stu-id="3f584-111">[`restore`](../tools/dotnet-restore.md), [`build`](../tools/dotnet-build.md) and [`publish`](../tools/dotnet-publish.md) are `dotnet` commands that can run separately.</span></span> <span data-ttu-id="3f584-112">ランタイムの選択は、`publish` や `build` ではなく、`restore` 操作の一部です。</span><span class="sxs-lookup"><span data-stu-id="3f584-112">The runtime choice is part of the `restore` operation, not `publish` or `build`.</span></span> <span data-ttu-id="3f584-113">`publish` を呼び出す場合、修正プログラムの最新バージョンが選択されます。</span><span class="sxs-lookup"><span data-stu-id="3f584-113">If you call `publish`, the latest patch version will be chosen.</span></span> <span data-ttu-id="3f584-114">`--no-restore` 引数で `publish` を呼び出した場合、以前の `restore` はポリシーを発行する新しい自己完結型のアプリケーションで実行されていない可能性があるため、必要な修正プログラムのバージョンを取得しない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3f584-114">If you call `publish` with the `--no-restore` argument, then you may not get the desired patch version because a prior `restore` may not have been executed with the new self-contained application publishing policy.</span></span> <span data-ttu-id="3f584-115">この場合、次のようなテキストでビルド エラーが生成されます。</span><span class="sxs-lookup"><span data-stu-id="3f584-115">In this case, a build error is generated with text similar to the following:</span></span>

  <span data-ttu-id="3f584-116">"プロジェクトは Microsoft.NETCore.App バージョン 2.0.0 を使用して復元されましたが、代わりに最新の設定、バージョン 2.0.6 が使用されます。</span><span class="sxs-lookup"><span data-stu-id="3f584-116">"The project was restored using Microsoft.NETCore.App version 2.0.0, but with current settings, version 2.0.6 would be used instead.</span></span> <span data-ttu-id="3f584-117">この問題を解決するには、復元およびこれ以降の操作 (ビルドや発行など) で同じ設定を使用していることをご確認ください。</span><span class="sxs-lookup"><span data-stu-id="3f584-117">To resolve this issue, make sure the same settings are used for restore and for subsequent operations such as build or publish.</span></span> <span data-ttu-id="3f584-118">通常、この問題は、RuntimeIdentifier プロパティが復元時ではなく、ビルドや発行時に設定された場合に発生します。"</span><span class="sxs-lookup"><span data-stu-id="3f584-118">Typically this issue can occur if the RuntimeIdentifier property is set during build or publish but not during restore."</span></span>

> [!NOTE]
> <span data-ttu-id="3f584-119">`restore` と `build` は、`publish` などの別のコマンドの一部として暗黙的に実行できます。</span><span class="sxs-lookup"><span data-stu-id="3f584-119">`restore` and `build` can be run implicitly as part of another command, like `publish`.</span></span> <span data-ttu-id="3f584-120">別のコマンドの一部として暗黙的に実行すると、追加のコンテキストと共に提供されるため、適切な成果物が生成されます。</span><span class="sxs-lookup"><span data-stu-id="3f584-120">When run implicitly as part of another command, they are provided with additional context so that the right artifacts are produced.</span></span> <span data-ttu-id="3f584-121">ランタイム (例: `dotnet publish -r linux-x64`) で `publish` を行う場合、暗黙的な `restore` では linux-x64 ランタイムのパッケージを復元します。</span><span class="sxs-lookup"><span data-stu-id="3f584-121">When you `publish` with a runtime (for example, `dotnet publish -r linux-x64`), the implicit `restore` restores packages for the linux-x64 runtime.</span></span> <span data-ttu-id="3f584-122">明示的に `restore` を呼び出す場合、そのコンテキストが含まれないため、既定でランタイム パッケージは復元されません。</span><span class="sxs-lookup"><span data-stu-id="3f584-122">If you call `restore` explicitly, it does not restore runtime packages by default, because it doesn't have that context.</span></span>

## <a name="how-to-avoid-restore-during-publish"></a><span data-ttu-id="3f584-123">発行時に復元を回避する方法</span><span class="sxs-lookup"><span data-stu-id="3f584-123">How to avoid restore during publish</span></span>

<span data-ttu-id="3f584-124">`publish` 操作の一部として `restore` を実行することは、お客様のシナリオにとって望ましくない場合があります。</span><span class="sxs-lookup"><span data-stu-id="3f584-124">Running `restore` as part of the `publish` operation may be undesirable for your scenario.</span></span> <span data-ttu-id="3f584-125">自己完結型のアプリケーションを作成しているときの `publish` 時に `restore` を回避するには、次の操作を行います。</span><span class="sxs-lookup"><span data-stu-id="3f584-125">To avoid `restore` during `publish` while creating self-contained applications, do the following:</span></span>

- <span data-ttu-id="3f584-126">`RuntimeIdentifiers` プロパティに、発行されるすべての [RID](../rid-catalog.md) をセミコロンで区切って設定します。</span><span class="sxs-lookup"><span data-stu-id="3f584-126">Set the `RuntimeIdentifiers` property to a semicolon-separated list of all the [RIDs](../rid-catalog.md) to be published.</span></span>
- <span data-ttu-id="3f584-127">`TargetLatestRuntimePatch` プロパティを `true` に設定します。</span><span class="sxs-lookup"><span data-stu-id="3f584-127">Set the `TargetLatestRuntimePatch` property to `true`.</span></span>

## <a name="no-restore-argument-with-dotnet-publish-options"></a><span data-ttu-id="3f584-128">dotnet publish オプションでの no-restore 引数</span><span class="sxs-lookup"><span data-stu-id="3f584-128">No-restore argument with dotnet publish options</span></span>

<span data-ttu-id="3f584-129">同じプロジェクト ファイルで自己完結型のアプリケーションと[フレームワークに依存するアプリケーション](index.md)の両方を作成する場合、`dotnet publish` で `--no-restore` 引数を使用する場合は、次のいずれかを選択します。</span><span class="sxs-lookup"><span data-stu-id="3f584-129">If you want to create both self-contained applications and [framework-dependent applications](index.md) with the same project file, and you want to use the `--no-restore` argument with `dotnet publish`, then choose one of the following:</span></span>

1. <span data-ttu-id="3f584-130">フレームワークに依存する動作を優先します。</span><span class="sxs-lookup"><span data-stu-id="3f584-130">Prefer the framework-dependent behavior.</span></span> <span data-ttu-id="3f584-131">アプリケーションがフレームワークに依存する場合、これが既定の動作になります。</span><span class="sxs-lookup"><span data-stu-id="3f584-131">If the application is framework-dependent, this is the default behavior.</span></span> <span data-ttu-id="3f584-132">アプリケーションが自己完結型で、修正プログラムが適用されていない 2.1.0 のローカル ランタイムを使用できる場合、プロジェクト ファイルで `TargetLatestRuntimePatch` を `false` に設定します。</span><span class="sxs-lookup"><span data-stu-id="3f584-132">If the application is self-contained, and can use an unpatched 2.1.0 local runtime, set the `TargetLatestRuntimePatch` to `false` in the project file.</span></span>

2. <span data-ttu-id="3f584-133">自己完結型の動作を優先します。</span><span class="sxs-lookup"><span data-stu-id="3f584-133">Prefer the self-contained behavior.</span></span> <span data-ttu-id="3f584-134">アプリケーションが自己完結型の場合、これが既定の動作になります。</span><span class="sxs-lookup"><span data-stu-id="3f584-134">If the application is self-contained, this is the default behavior.</span></span> <span data-ttu-id="3f584-135">アプリケーションがフレームワークに依存し、最新の修正プログラムがインストールされている必要がある場合、プロジェクト ファイルで `TargetLatestRuntimePatch` を `true` に設定します。</span><span class="sxs-lookup"><span data-stu-id="3f584-135">If the application is framework-dependent, and requires the latest patch installed, set `TargetLatestRuntimePatch` to `true` in the project file.</span></span>

3. <span data-ttu-id="3f584-136">プロジェクト ファイルで `RuntimeFrameworkVersion` に特定の修正プログラムのバージョンを設定して、ランタイム フレームワークのバージョンの明示的なコントロールを取得します。</span><span class="sxs-lookup"><span data-stu-id="3f584-136">Take explicit control of the runtime framework version by setting `RuntimeFrameworkVersion` to the specific patch version in the project file.</span></span>
