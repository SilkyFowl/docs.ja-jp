---
title: 監視パターン
description: クラウドネイティブアプリケーションの可観測性パターン
ms.date: 01/19/2021
ms.openlocfilehash: acb1dc5c62787e9487c0e95c7e86a8f9a1967951
ms.sourcegitcommit: f2ab02d9a780819ca2e5310bbcf5cfe5b7993041
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/03/2021
ms.locfileid: "99506020"
---
# <a name="observability-patterns"></a><span data-ttu-id="71bd1-103">監視パターン</span><span class="sxs-lookup"><span data-stu-id="71bd1-103">Observability patterns</span></span>

<span data-ttu-id="71bd1-104">アプリケーションのコードのレイアウトを支援するために開発されたパターンと同じように、信頼性の高い方法でアプリケーションを運用するためのパターンがあります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-104">Just as patterns have been developed to aid in the layout of code in applications, there are patterns for operating applications in a reliable way.</span></span> <span data-ttu-id="71bd1-105">アプリケーションの管理において、 **ログ記録**、 **監視**、 **アラート** という3つの便利なパターンが登場しました。</span><span class="sxs-lookup"><span data-stu-id="71bd1-105">Three useful patterns in maintaining applications have emerged: **logging**, **monitoring**, and **alerts**.</span></span>

## <a name="when-to-use-logging"></a><span data-ttu-id="71bd1-106">ログ記録を使用する場合</span><span class="sxs-lookup"><span data-stu-id="71bd1-106">When to use logging</span></span>

<span data-ttu-id="71bd1-107">どのように注意しても、アプリケーションはほとんどの場合、実稼働環境では予期しない方法で動作します。</span><span class="sxs-lookup"><span data-stu-id="71bd1-107">No matter how careful we are, applications almost always behave in unexpected ways in production.</span></span> <span data-ttu-id="71bd1-108">ユーザーがアプリケーションに関する問題を報告する場合は、問題が発生したときにアプリの状況を確認できるようにすると便利です。</span><span class="sxs-lookup"><span data-stu-id="71bd1-108">When users report problems with an application, it's useful to be able to see what was going on with the app when the problem occurred.</span></span> <span data-ttu-id="71bd1-109">アプリケーションが実行されているときの動作に関する情報をキャプチャする方法として最もよく見られるものの1つは、アプリケーションが実行している内容を書き留めておくことです。</span><span class="sxs-lookup"><span data-stu-id="71bd1-109">One of the most tried and true ways of capturing information about what an application is doing while it's running is to have the application write down what it's doing.</span></span> <span data-ttu-id="71bd1-110">このプロセスはログ記録と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-110">This process is known as logging.</span></span> <span data-ttu-id="71bd1-111">運用環境で障害や問題が発生した場合は、非運用環境で障害が発生した状況を再現することが目標となります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-111">Anytime failures or problems occur in production, the goal should be to reproduce the conditions under which the failures occurred, in a non-production environment.</span></span> <span data-ttu-id="71bd1-112">適切なログ記録を使用することにより、開発者はテストと実験が可能な環境で問題を再現するためのロードマップが得られます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-112">Having good logging in place provides a roadmap for developers to follow in order to duplicate problems in an environment that can be tested and experimented with.</span></span>

### <a name="challenges-when-logging-with-cloud-native-applications"></a><span data-ttu-id="71bd1-113">クラウドネイティブアプリケーションでのログ記録に関する課題</span><span class="sxs-lookup"><span data-stu-id="71bd1-113">Challenges when logging with cloud-native applications</span></span>

<span data-ttu-id="71bd1-114">従来のアプリケーションでは、通常、ログファイルはローカルコンピューターに格納されます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-114">In traditional applications, log files are typically stored on the local machine.</span></span> <span data-ttu-id="71bd1-115">実際、Unix のようなオペレーティングシステムでは、すべてのログを保持するために定義されたフォルダー構造があります (通常は) `/var/log` 。</span><span class="sxs-lookup"><span data-stu-id="71bd1-115">In fact, on Unix-like operating systems, there's a folder structure defined to hold any logs, typically under `/var/log`.</span></span>

<span data-ttu-id="71bd1-116">![モノリシックアプリ内のファイルにログを記録する。 ](./media/single-monolith-logging.png)
**図 7-1**.</span><span class="sxs-lookup"><span data-stu-id="71bd1-116">![Logging to a file in a monolithic app.](./media/single-monolith-logging.png)
**Figure 7-1**.</span></span> <span data-ttu-id="71bd1-117">モノリシックアプリ内のファイルにログを記録する。</span><span class="sxs-lookup"><span data-stu-id="71bd1-117">Logging to a file in a monolithic app.</span></span>

<span data-ttu-id="71bd1-118">1台のコンピューター上のフラットファイルへのログ記録の有用性は、クラウド環境で大幅に削減されます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-118">The usefulness of logging to a flat file on a single machine is vastly reduced in a cloud environment.</span></span> <span data-ttu-id="71bd1-119">ログを生成するアプリケーションはローカルディスクにアクセスできない場合があります。また、コンテナーは物理マシンに対してシャッフルされるため、ローカルディスクが非常に一時的なものである可能性があります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-119">Applications producing logs may not have access to the local disk or the local disk may be highly transient as containers are shuffled around physical machines.</span></span> <span data-ttu-id="71bd1-120">複数のノード間でモノリシックアプリケーションを簡単にスケールアップすると、適切なファイルベースのログファイルを見つけることが困難になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-120">Even simple scaling up of monolithic applications across multiple nodes can make it challenging to locate the appropriate file-based log file.</span></span>

<span data-ttu-id="71bd1-121">![スケーリングされたモノリシックアプリ内のファイルにログを記録する。 ](./media/multiple-node-monolith-logging.png)
**図 7-2**.</span><span class="sxs-lookup"><span data-stu-id="71bd1-121">![Logging to files in a scaled monolithic app.](./media/multiple-node-monolith-logging.png)
**Figure 7-2**.</span></span> <span data-ttu-id="71bd1-122">スケーリングされたモノリシックアプリ内のファイルにログを記録する。</span><span class="sxs-lookup"><span data-stu-id="71bd1-122">Logging to files in a scaled monolithic app.</span></span>

<span data-ttu-id="71bd1-123">マイクロサービスアーキテクチャを使用して開発されたクラウドネイティブアプリケーションにも、ファイルベースの logger に関するいくつかの課題があります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-123">Cloud-native applications developed using a microservices architecture also pose some challenges for file-based loggers.</span></span> <span data-ttu-id="71bd1-124">ユーザーの要求が、異なるコンピューター上で実行される複数のサービスにまたがることができるようになりました。また、ローカルファイルシステムへのアクセスをまったく持たないサーバーレス機能を含めることもできます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-124">User requests may now span multiple services that are run on different machines and may include serverless functions with no access to a local file system at all.</span></span> <span data-ttu-id="71bd1-125">このような多くのサービスやコンピューターで、ユーザーまたはセッションのログを相互に関連付けることは、非常に困難です。</span><span class="sxs-lookup"><span data-stu-id="71bd1-125">It would be very challenging to correlate the logs from a user or a session across these many services and machines.</span></span>

<span data-ttu-id="71bd1-126">![マイクロサービスアプリのローカルファイルにログを記録する。 ](./media/local-log-file-per-service.png)
**図 7-3**.</span><span class="sxs-lookup"><span data-stu-id="71bd1-126">![Logging to local files in a microservices app.](./media/local-log-file-per-service.png)
**Figure 7-3**.</span></span> <span data-ttu-id="71bd1-127">マイクロサービスアプリのローカルファイルにログを記録する。</span><span class="sxs-lookup"><span data-stu-id="71bd1-127">Logging to local files in a microservices app.</span></span>

<span data-ttu-id="71bd1-128">最後に、一部のクラウドネイティブアプリケーションのユーザー数が多くなっています。</span><span class="sxs-lookup"><span data-stu-id="71bd1-128">Finally, the number of users in some cloud-native applications is high.</span></span> <span data-ttu-id="71bd1-129">各ユーザーがアプリケーションにログインすると、500行のログメッセージが生成されると想像してください。</span><span class="sxs-lookup"><span data-stu-id="71bd1-129">Imagine that each user generates a hundred lines of log messages when they log into an application.</span></span> <span data-ttu-id="71bd1-130">分離では、管理は容易ですが、10万ユーザーとログの量を超えると、ログの効果的な使用をサポートするために特別なツールが必要になります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-130">In isolation, that is manageable, but multiply that over 100,000 users and the volume of logs becomes large enough that specialized tools are needed to support effective use of the logs.</span></span>

### <a name="logging-in-cloud-native-applications"></a><span data-ttu-id="71bd1-131">クラウドネイティブアプリケーションでのログ記録</span><span class="sxs-lookup"><span data-stu-id="71bd1-131">Logging in cloud-native applications</span></span>

<span data-ttu-id="71bd1-132">すべてのプログラミング言語には、ログの書き込みを可能にするツールが用意されています。通常、これらのログを書き込むためのオーバーヘッドは低くなります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-132">Every programming language has tooling that permits writing logs, and typically the overhead for writing these logs is low.</span></span> <span data-ttu-id="71bd1-133">ログ記録ライブラリの多くは、実行時にチューニングできるさまざまな種類の criticalities のログ記録を提供しています。</span><span class="sxs-lookup"><span data-stu-id="71bd1-133">Many of the logging libraries provide logging different kinds of criticalities, which can be tuned at run time.</span></span> <span data-ttu-id="71bd1-134">たとえば、 [Serilog ライブラリ](https://serilog.net/) は、次のログレベルを提供する .net 用の一般的な構造化ログライブラリです。</span><span class="sxs-lookup"><span data-stu-id="71bd1-134">For instance, the [Serilog library](https://serilog.net/) is a popular structured logging library for .NET that provides the following logging levels:</span></span>

* <span data-ttu-id="71bd1-135">"詳細"</span><span class="sxs-lookup"><span data-stu-id="71bd1-135">Verbose</span></span>
* <span data-ttu-id="71bd1-136">デバッグ</span><span class="sxs-lookup"><span data-stu-id="71bd1-136">Debug</span></span>
* <span data-ttu-id="71bd1-137">Information</span><span class="sxs-lookup"><span data-stu-id="71bd1-137">Information</span></span>
* <span data-ttu-id="71bd1-138">警告</span><span class="sxs-lookup"><span data-stu-id="71bd1-138">Warning</span></span>
* <span data-ttu-id="71bd1-139">エラー</span><span class="sxs-lookup"><span data-stu-id="71bd1-139">Error</span></span>
* <span data-ttu-id="71bd1-140">致命的</span><span class="sxs-lookup"><span data-stu-id="71bd1-140">Fatal</span></span>

<span data-ttu-id="71bd1-141">これらのさまざまなログレベルにより、ログの粒度が向上します。</span><span class="sxs-lookup"><span data-stu-id="71bd1-141">These different log levels provide granularity in logging.</span></span> <span data-ttu-id="71bd1-142">アプリケーションが運用環境で正常に機能している場合は、重要なメッセージのみをログに記録するように構成できます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-142">When the application is functioning properly in production, it may be configured to only log important messages.</span></span> <span data-ttu-id="71bd1-143">アプリケーションの動作が不適切な場合は、より詳細なログが収集されるようにログレベルを上げることができます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-143">When the application is misbehaving, then the log level can be increased so more verbose logs are gathered.</span></span> <span data-ttu-id="71bd1-144">これにより、デバッグが容易になるというバランスでパフォーマンスが低下します。</span><span class="sxs-lookup"><span data-stu-id="71bd1-144">This balances performance against ease of debugging.</span></span>

<span data-ttu-id="71bd1-145">ログツールの高パフォーマンスと、詳細レベルのチューニング機能により、開発者は頻繁にログを記録することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="71bd1-145">The high performance of logging tools and the tunability of verbosity should encourage developers to log frequently.</span></span> <span data-ttu-id="71bd1-146">多くの場合、各メソッドのエントリと終了をログに記録するパターンを優先します。</span><span class="sxs-lookup"><span data-stu-id="71bd1-146">Many favor a pattern of logging the entry and exit of each method.</span></span> <span data-ttu-id="71bd1-147">このアプローチは過剰な場合があるかもしれませんが、開発者がログ記録の量を少なくすることはあまりありません。</span><span class="sxs-lookup"><span data-stu-id="71bd1-147">This approach may sound like overkill, but it's infrequent that developers will wish for less logging.</span></span> <span data-ttu-id="71bd1-148">実際には、問題のあるメソッドのログ記録を追加することだけを目的としてデプロイを実行することは珍しくありません。</span><span class="sxs-lookup"><span data-stu-id="71bd1-148">In fact, it's not uncommon to perform deployments for the sole purpose of adding logging around a problematic method.</span></span> <span data-ttu-id="71bd1-149">ログ記録が過剰になっていますが、それほど多くはありません。</span><span class="sxs-lookup"><span data-stu-id="71bd1-149">Err on the side of too much logging and not on too little.</span></span> <span data-ttu-id="71bd1-150">この種のログを自動的に提供するために使用できるツールもあります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-150">Some tools can be used to automatically provide this kind of logging.</span></span>

<span data-ttu-id="71bd1-151">クラウドネイティブアプリでファイルベースのログを使用することには問題があるため、一元化されたログを使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="71bd1-151">Because of the challenges associated with using file-based logs in cloud-native apps, centralized logs are preferred.</span></span> <span data-ttu-id="71bd1-152">ログは、アプリケーションによって収集され、ログのインデックスを作成して格納する中央ログアプリケーションに付属しています。</span><span class="sxs-lookup"><span data-stu-id="71bd1-152">Logs are collected by the applications and shipped to a central logging application which indexes and stores the logs.</span></span> <span data-ttu-id="71bd1-153">このクラスのシステムは、毎日数万のログを取り込むことができます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-153">This class of system can ingest tens of gigabytes of logs every day.</span></span>

<span data-ttu-id="71bd1-154">また、多くのサービスにまたがるログ記録を作成する際には、いくつかの標準的なプラクティスに従うことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="71bd1-154">It's also helpful to follow some standard practices when building logging that spans many services.</span></span> <span data-ttu-id="71bd1-155">たとえば、時間のかかる相互作用の開始時に [相関 ID](https://blog.rapid7.com/2016/12/23/the-value-of-correlation-ids/) を生成し、その相互作用に関連するメッセージごとにログを記録すると、関連するすべてのメッセージを検索しやすくなります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-155">For instance, generating a [correlation ID](https://blog.rapid7.com/2016/12/23/the-value-of-correlation-ids/) at the start of a lengthy interaction, and then logging it in each message that is related to that interaction, makes it easier to search for all related messages.</span></span> <span data-ttu-id="71bd1-156">1つのメッセージだけを検索し、相関 ID を抽出して、関連するすべてのメッセージを検索する必要があります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-156">One need only find a single message and extract the correlation ID to find all the related messages.</span></span> <span data-ttu-id="71bd1-157">別の例として、使用する言語やログライブラリにかかわらず、すべてのサービスでログ形式が同じであることを確認します。</span><span class="sxs-lookup"><span data-stu-id="71bd1-157">Another example is ensuring that the log format is the same for every service, whatever the language or logging library it uses.</span></span> <span data-ttu-id="71bd1-158">この標準化により、ログの読み取りがはるかに簡単になります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-158">This standardization makes reading logs much easier.</span></span> <span data-ttu-id="71bd1-159">図7-4 は、マイクロサービスアーキテクチャがワークフローの一部として集中ログを活用する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="71bd1-159">Figure 7-4 demonstrates how a microservices architecture can leverage centralized logging as part of its workflow.</span></span>

<span data-ttu-id="71bd1-160">![さまざまなソースからのログは、一元化されたログストアに取り込まれたます。 ](./media/centralized-logging.png)
**図 7-4**.</span><span class="sxs-lookup"><span data-stu-id="71bd1-160">![Logs from various sources are ingested into a centralized log store.](./media/centralized-logging.png)
**Figure 7-4**.</span></span> <span data-ttu-id="71bd1-161">さまざまなソースからのログは、一元化されたログストアに取り込まれたます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-161">Logs from various sources are ingested into a centralized log store.</span></span>

## <a name="challenges-with-detecting-and-responding-to-potential-app-health-issues"></a><span data-ttu-id="71bd1-162">アプリの正常性に関する問題の検出と対応に関する課題</span><span class="sxs-lookup"><span data-stu-id="71bd1-162">Challenges with detecting and responding to potential app health issues</span></span>

<span data-ttu-id="71bd1-163">アプリケーションによっては、ミッションクリティカルではないものもあります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-163">Some applications aren't mission critical.</span></span> <span data-ttu-id="71bd1-164">これらは内部的にのみ使用され、問題が発生した場合、ユーザーはチームに連絡して、アプリケーションを再起動できる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-164">Maybe they're only used internally, and when a problem occurs, the user can contact the team responsible and the application can be restarted.</span></span> <span data-ttu-id="71bd1-165">しかし、多くの場合、顧客は使用するアプリケーションに対して高い期待をしています。</span><span class="sxs-lookup"><span data-stu-id="71bd1-165">However, customers often have higher expectations for the applications they consume.</span></span> <span data-ttu-id="71bd1-166">ユーザーがアプリケーションを使用 *する前* 、またはユーザーに通知する前に、問題が発生したことを把握しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-166">You should know when problems occur with your application *before* users do, or before users notify you.</span></span> <span data-ttu-id="71bd1-167">それ以外の場合、最初に問題が発生したのは、アプリケーションまたは組織に deriding たソーシャルメディアの投稿が発生した場合です。</span><span class="sxs-lookup"><span data-stu-id="71bd1-167">Otherwise, the first you know about a problem may be when you notice an angry deluge of social media posts deriding your application or even your organization.</span></span>

<span data-ttu-id="71bd1-168">次のようなシナリオが考えられます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-168">Some scenarios you may need to consider include:</span></span>

- <span data-ttu-id="71bd1-169">アプリケーションの1つのサービスで障害が発生して再起動し続けるため、応答が断続的に遅くなります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-169">One service in your application keeps failing and restarting, resulting in intermittent slow responses.</span></span>
- <span data-ttu-id="71bd1-170">1日のうちに、アプリケーションの応答時間が遅くなることがあります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-170">At some times of the day, your application's response time is slow.</span></span>
- <span data-ttu-id="71bd1-171">最近の配置の後、データベースに対する負荷は tripled しています。</span><span class="sxs-lookup"><span data-stu-id="71bd1-171">After a recent deployment, load on the database has tripled.</span></span>

<span data-ttu-id="71bd1-172">適切に実装すると、問題の原因となる条件についての監視が可能になり、ユーザーが大きな影響を与える前に基になる条件に対処できます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-172">Implemented properly, monitoring can let you know about conditions that will lead to problems, letting you address underlying conditions before they result in any significant user impact.</span></span>

### <a name="monitoring-cloud-native-apps"></a><span data-ttu-id="71bd1-173">クラウドネイティブアプリの監視</span><span class="sxs-lookup"><span data-stu-id="71bd1-173">Monitoring cloud-native apps</span></span>

<span data-ttu-id="71bd1-174">一元化されたログ記録システムには、純粋なログ以外でテレメトリを収集するための追加の役割があります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-174">Some centralized logging systems take on an additional role of collecting telemetry outside of pure logs.</span></span> <span data-ttu-id="71bd1-175">データベースクエリの実行時間、web サーバーからの平均応答時間、オペレーティングシステムによって報告された CPU 負荷の平均とメモリの負荷など、メトリックを収集できます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-175">They can collect metrics, such as time to run a database query, average response time from a web server, and even CPU load averages and memory pressure as reported by the operating system.</span></span> <span data-ttu-id="71bd1-176">これらのシステムでは、ログと組み合わせて、システム内のノードとアプリケーション全体の正常性を総合的に把握することができます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-176">In conjunction with the logs, these systems can provide a holistic view of the health of nodes in the system and the application as a whole.</span></span>

<span data-ttu-id="71bd1-177">監視ツールのメトリック収集機能は、アプリケーション内から手動で行うこともできます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-177">The metric-gathering capabilities of the monitoring tools can also be fed manually from within the application.</span></span> <span data-ttu-id="71bd1-178">新規ユーザーのサインアップや注文の発注など、特に関心のあるビジネスフローは、中央監視システムのカウンターをインクリメントするようにインストルメント化することができます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-178">Business flows that are of particular interest such as new users signing up or orders being placed, may be instrumented such that they increment a counter in the central monitoring system.</span></span> <span data-ttu-id="71bd1-179">この側面では、アプリケーションの正常性を監視するだけでなく、ビジネスの正常性を監視するために、監視ツールのロックを解除します。</span><span class="sxs-lookup"><span data-stu-id="71bd1-179">This aspect unlocks the monitoring tools to not only monitor the health of the application but the health of the business.</span></span>

<span data-ttu-id="71bd1-180">クエリは、特定の統計またはパターンを検索するために、ログ集計ツールで作成できます。これは、カスタムダッシュボードにグラフィカルな形式で表示できます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-180">Queries can be constructed in the log aggregation tools to look for certain statistics or patterns, which can then be displayed in graphical form, on custom dashboards.</span></span> <span data-ttu-id="71bd1-181">多くの場合、チームは、アプリケーションに関連する統計情報をローテーションする、大きな壁にマウントされたディスプレイに投資します。</span><span class="sxs-lookup"><span data-stu-id="71bd1-181">Frequently, teams will invest in large, wall-mounted displays that rotate through the statistics related to an application.</span></span> <span data-ttu-id="71bd1-182">これにより、発生した問題を簡単に確認できます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-182">This way, it's simple to see the problems as they occur.</span></span>

<span data-ttu-id="71bd1-183">クラウドネイティブの監視ツールは、シングルプロセスのモノリシックアプリケーションであるか、分散マイクロサービスアーキテクチャであるかに関係なく、アプリに対してリアルタイムのテレメトリと洞察を提供します。</span><span class="sxs-lookup"><span data-stu-id="71bd1-183">Cloud-native monitoring tools provide real-time telemetry and insight into apps regardless of whether they're single-process monolithic applications or distributed microservice architectures.</span></span> <span data-ttu-id="71bd1-184">これには、アプリからのデータ収集を可能にするツールと、アプリの正常性に関する情報を照会して表示するためのツールが含まれます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-184">They include tools that allow collection of data from the app as well as tools for querying and displaying information about the app's health.</span></span>

## <a name="challenges-with-reacting-to-critical-problems-in-cloud-native-apps"></a><span data-ttu-id="71bd1-185">クラウドネイティブアプリにおける重大な問題への対応に関する課題</span><span class="sxs-lookup"><span data-stu-id="71bd1-185">Challenges with reacting to critical problems in cloud-native apps</span></span>

<span data-ttu-id="71bd1-186">アプリケーションの問題に対処する必要がある場合は、適切な担当者に通知する何らかの方法が必要です。</span><span class="sxs-lookup"><span data-stu-id="71bd1-186">If you need to react to problems with your application, you need some way to alert the right personnel.</span></span> <span data-ttu-id="71bd1-187">これは、3番目のクラウドネイティブアプリケーション可観測性パターンであり、ログ記録と監視に依存します。</span><span class="sxs-lookup"><span data-stu-id="71bd1-187">This is the third cloud-native application observability pattern and depends on logging and monitoring.</span></span> <span data-ttu-id="71bd1-188">アプリケーションでは、問題の診断を可能にするためにログを記録し、場合によっては監視ツールにフィードする必要があります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-188">Your application needs to have logging in place to allow problems to be diagnosed, and in some cases to feed into monitoring tools.</span></span> <span data-ttu-id="71bd1-189">アプリケーションメトリックと正常性データを1か所で集計するには、監視が必要です。</span><span class="sxs-lookup"><span data-stu-id="71bd1-189">It needs monitoring to aggregate application metrics and health data in one place.</span></span> <span data-ttu-id="71bd1-190">この設定が完了すると、特定のメトリックが許容可能なレベルを超えたときにアラートをトリガーするルールを作成できます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-190">Once this has been established, rules can be created that will trigger alerts when certain metrics fall outside of acceptable levels.</span></span>

<span data-ttu-id="71bd1-191">一般に、アラートは、特定の条件によって緊急の問題をチームメンバーに通知する適切なアラートがトリガーされるように、監視の上位に階層化されます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-191">Generally, alerts are layered on top of monitoring such that certain conditions trigger appropriate alerts to notify team members of urgent problems.</span></span> <span data-ttu-id="71bd1-192">アラートが必要になるシナリオとしては、次のようなものがあります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-192">Some scenarios that may require alerts include:</span></span>

- <span data-ttu-id="71bd1-193">1分間のダウンタイムが発生しても、アプリケーションのサービスの1つが応答していません。</span><span class="sxs-lookup"><span data-stu-id="71bd1-193">One of your application's services is not responding after 1 minute of downtime.</span></span>
- <span data-ttu-id="71bd1-194">アプリケーションが、1% を超える要求に対して失敗した HTTP 応答を返しています。</span><span class="sxs-lookup"><span data-stu-id="71bd1-194">Your application is returning unsuccessful HTTP responses to more than 1% of requests.</span></span>
- <span data-ttu-id="71bd1-195">アプリケーションのキーエンドポイントの平均応答時間が2000ミリ秒を超えています。</span><span class="sxs-lookup"><span data-stu-id="71bd1-195">Your application's average response time for key endpoints exceeds 2000 ms.</span></span>

### <a name="alerts-in-cloud-native-apps"></a><span data-ttu-id="71bd1-196">クラウドネイティブアプリのアラート</span><span class="sxs-lookup"><span data-stu-id="71bd1-196">Alerts in cloud-native apps</span></span>

<span data-ttu-id="71bd1-197">監視ツールに対するクエリを作成して、既知のエラー状態を調べることができます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-197">You can craft queries against the monitoring tools to look for known failure conditions.</span></span> <span data-ttu-id="71bd1-198">たとえば、クエリで受信ログを検索して、web サーバー上の問題を示す HTTP 状態コード500を検出することができます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-198">For instance, queries could search through the incoming logs for indications of HTTP status code 500, which indicates a problem on a web server.</span></span> <span data-ttu-id="71bd1-199">これらのうちの1つが検出されるとすぐに、調査を開始できる送信元サービスの所有者に電子メールまたは SMS を送信することができます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-199">As soon as one of these is detected, then an e-mail or an SMS could be sent to the owner of the originating service who can begin to investigate.</span></span>

<span data-ttu-id="71bd1-200">ただし、通常、1つの500エラーでは、問題が発生したことを特定するのに十分ではありません。</span><span class="sxs-lookup"><span data-stu-id="71bd1-200">Typically, though, a single 500 error isn't enough to determine that a problem has occurred.</span></span> <span data-ttu-id="71bd1-201">これは、ユーザーがパスワードを入力したか、形式が正しくないデータを入力したことを意味します。</span><span class="sxs-lookup"><span data-stu-id="71bd1-201">It could mean that a user mistyped their password or entered some malformed data.</span></span> <span data-ttu-id="71bd1-202">警告クエリは、500エラーの平均値を超えた場合にのみ発生するように細工できます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-202">The alert queries can be crafted to only fire when a larger than average number of 500 errors are detected.</span></span>

<span data-ttu-id="71bd1-203">アラートに含まれる最も損傷のあるパターンの1つは、人が調査するアラートの数が多すぎることです。</span><span class="sxs-lookup"><span data-stu-id="71bd1-203">One of the most damaging patterns in alerting is to fire too many alerts for humans to investigate.</span></span> <span data-ttu-id="71bd1-204">サービスの所有者は、前に調査したエラーや問題が発生していないことがすぐに desensitized になります。</span><span class="sxs-lookup"><span data-stu-id="71bd1-204">Service owners will rapidly become desensitized to errors that they've previously investigated and found to be benign.</span></span> <span data-ttu-id="71bd1-205">これにより、真のエラーが発生したときに、何百も偽陽性が発生した場合のノイズが失われます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-205">Then, when true errors occur, they'll be lost in the noise of hundreds of false positives.</span></span> <span data-ttu-id="71bd1-206">[かわいくウルフの人](https://en.wikipedia.org/wiki/The_Boy_Who_Cried_Wolf)は、この非常に危険なことを警告するために、多くの場合、子供に伝えます。</span><span class="sxs-lookup"><span data-stu-id="71bd1-206">The parable of the [Boy Who Cried Wolf](https://en.wikipedia.org/wiki/The_Boy_Who_Cried_Wolf) is frequently told to children to warn them of this very danger.</span></span> <span data-ttu-id="71bd1-207">発生するアラートが実際の問題を示すものであることを確認することが重要です。</span><span class="sxs-lookup"><span data-stu-id="71bd1-207">It's important to ensure that the alerts that do fire are indicative of a real problem.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="71bd1-208">[前へ](monitoring-health.md)
>[次へ](logging-with-elastic-stack.md)</span><span class="sxs-lookup"><span data-stu-id="71bd1-208">[Previous](monitoring-health.md)
[Next](logging-with-elastic-stack.md)</span></span>
