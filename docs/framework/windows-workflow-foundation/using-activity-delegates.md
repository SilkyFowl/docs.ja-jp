---
description: 詳細については、「アクティビティデリゲートの使用」を参照してください。
title: アクティビティ デリゲートの使用
ms.date: 03/30/2017
ms.assetid: e33cf876-8979-440b-9b23-4a12d1139960
ms.openlocfilehash: 2570d32c275975b8bda34fab2ffd79a49b6a9c73
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99755084"
---
# <a name="using-activity-delegates"></a><span data-ttu-id="046c5-103">アクティビティ デリゲートの使用</span><span class="sxs-lookup"><span data-stu-id="046c5-103">Using Activity Delegates</span></span>

<span data-ttu-id="046c5-104">アクティビティ デリゲートを使用すると、アクティビティの作成者は、特定の署名を持つコールバックを公開できます。アクティビティのユーザーは、この署名用のアクティビティベースのハンドラーを提供できます。</span><span class="sxs-lookup"><span data-stu-id="046c5-104">Activity delegates enable activity authors to expose callbacks with specific signatures, for which users of the activity can provide activity-based handlers.</span></span> <span data-ttu-id="046c5-105">2 種類のアクティビティ デリゲートを使用できます。<xref:System.Activities.ActivityAction%601> は、戻り値を持たないアクティビティ デリゲートを定義する場合に使用され、<xref:System.Activities.ActivityFunc%601> は戻り値を持つアクティビティ デリゲートを定義する場合に使用されます。</span><span class="sxs-lookup"><span data-stu-id="046c5-105">Two types of activity delegates are available: <xref:System.Activities.ActivityAction%601> is used to define activity delegates that do not have a return value, and <xref:System.Activities.ActivityFunc%601> is used to define activity delegates that do have a return value.</span></span>

<span data-ttu-id="046c5-106">アクティビティ デリゲートは、子アクティビティが特定の署名を持つように制限する必要がある場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="046c5-106">Activity delegates are useful in scenarios where a child activity must be constrained to having a certain signature.</span></span> <span data-ttu-id="046c5-107">たとえば、<xref:System.Activities.Statements.While> アクティビティは制約のないあらゆる型のアクティビティを含めることができますが、<xref:System.Activities.Statements.ForEach%601> アクティビティの本体は <xref:System.Activities.ActivityAction%601> であるため、最終的には <xref:System.Activities.Statements.ForEach%601> によって実行されるその子アクティビティは、<xref:System.Activities.InArgument%601> が列挙するコレクションのメンバーと同じ型である <xref:System.Activities.Statements.ForEach%601> を持つ必要があります。</span><span class="sxs-lookup"><span data-stu-id="046c5-107">For example, a <xref:System.Activities.Statements.While> activity can contain any type of child activity with no constraints, but the body of a <xref:System.Activities.Statements.ForEach%601> activity is an <xref:System.Activities.ActivityAction%601>, and the child activity that is ultimately executed by <xref:System.Activities.Statements.ForEach%601> must have an <xref:System.Activities.InArgument%601> that is the same type of the members of the collection that the <xref:System.Activities.Statements.ForEach%601> enumerates.</span></span>

## <a name="using-activityaction"></a><span data-ttu-id="046c5-108">ActivityAction の使用</span><span class="sxs-lookup"><span data-stu-id="046c5-108">Using ActivityAction</span></span>

<span data-ttu-id="046c5-109">いくつかの [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] アクティビティ (<xref:System.Activities.Statements.Catch> アクティビティや <xref:System.Activities.Statements.ForEach%601> アクティビティなど) では、アクティビティ アクションが使用されます。</span><span class="sxs-lookup"><span data-stu-id="046c5-109">Several [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] activities use activity actions, such as the <xref:System.Activities.Statements.Catch> activity and the <xref:System.Activities.Statements.ForEach%601> activity.</span></span> <span data-ttu-id="046c5-110">それぞれの場合において、アクティビティ アクションは、これらのアクティビティのいずれかを使用してワークフローを作成するときに、ワークフローの作成者が目的の動作を提供するアクティビティを指定する場所を表します。</span><span class="sxs-lookup"><span data-stu-id="046c5-110">In each case, the activity action represents a location where the workflow author specifies an activity to provide the desired behavior when composing a workflow using one of these activities.</span></span> <span data-ttu-id="046c5-111">次の例では、<xref:System.Activities.Statements.ForEach%601> アクティビティを使用してコンソール ウィンドウにテキストを表示します。</span><span class="sxs-lookup"><span data-stu-id="046c5-111">In the following example, a <xref:System.Activities.Statements.ForEach%601> activity is used to display text to the console window.</span></span> <span data-ttu-id="046c5-112"><xref:System.Activities.Statements.ForEach%601> の本体は、<xref:System.Activities.ActivityAction%601> の型 (文字列) に一致する <xref:System.Activities.Statements.ForEach%601> を使用して指定します。</span><span class="sxs-lookup"><span data-stu-id="046c5-112">The body of the <xref:System.Activities.Statements.ForEach%601> is specified by using an <xref:System.Activities.ActivityAction%601> that matches the type of the <xref:System.Activities.Statements.ForEach%601> which is string.</span></span> <span data-ttu-id="046c5-113"><xref:System.Activities.ActivityDelegate.Handler%2A> で指定された <xref:System.Activities.Statements.WriteLine> アクティビティには、<xref:System.Activities.Statements.ForEach%601> アクティビティによって反復処理されるコレクションの文字列値にバインドされる <xref:System.Activities.Statements.WriteLine.Text%2A> 引数があります。</span><span class="sxs-lookup"><span data-stu-id="046c5-113">The <xref:System.Activities.Statements.WriteLine> activity specified in the <xref:System.Activities.ActivityDelegate.Handler%2A> has its <xref:System.Activities.Statements.WriteLine.Text%2A> argument bound to the string values in the collection that the <xref:System.Activities.Statements.ForEach%601> activity iterates.</span></span>

[!code-csharp[CFX_ActivityExample#6](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#6)]

<span data-ttu-id="046c5-114">actionArgument は、コレクション内の各項目を WriteLine にフローするために使用されます。</span><span class="sxs-lookup"><span data-stu-id="046c5-114">The actionArgument is used to flow the individual items in the collection to the WriteLine.</span></span> <span data-ttu-id="046c5-115">このワークフローが呼び出されると、次の出力がコンソールに表示されます。</span><span class="sxs-lookup"><span data-stu-id="046c5-115">When the workflow is invoked, the following output is displayed to the console.</span></span>

```console
HelloWorld.
```

<span data-ttu-id="046c5-116">このトピックの例では、オブジェクトの初期化の構文を使用します。</span><span class="sxs-lookup"><span data-stu-id="046c5-116">The examples in this topic use object initialization syntax.</span></span> <span data-ttu-id="046c5-117">オブジェクトの初期化の構文は、コードでワークフロー定義を作成する場合に便利な方法です。これは、ワークフローのアクティビティの階層ビューが提供され、アクティビティ間の関係が示されるためです。</span><span class="sxs-lookup"><span data-stu-id="046c5-117">Object initialization syntax can be a useful way to create workflow definitions in code because it provides a hierarchical view of the activities in the workflow and shows the relationship between the activities.</span></span> <span data-ttu-id="046c5-118">プログラムからワークフローを作成する場合に、オブジェクトの初期化の構文を使用しなければならないという要件はありません。</span><span class="sxs-lookup"><span data-stu-id="046c5-118">There is no requirement to use object initialization syntax when you programmatically create workflows.</span></span> <span data-ttu-id="046c5-119">次の例は、機能的には前のサンプルと同じです。</span><span class="sxs-lookup"><span data-stu-id="046c5-119">The following example is functionally equivalent to the previous example.</span></span>

[!code-csharp[CFX_ActivityExample#7](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#7)]

<span data-ttu-id="046c5-120">オブジェクト初期化子の詳細については、「 [方法: コンストラクターを呼び出さずにオブジェクトを初期化する (C# プログラミングガイド)](../../csharp/programming-guide/classes-and-structs/how-to-initialize-objects-by-using-an-object-initializer.md) 」および「 [方法: オブジェクト初期化子を使用してオブジェクトを宣言する (Visual Basic)](../../visual-basic/programming-guide/language-features/objects-and-classes/how-to-declare-an-object-by-using-an-object-initializer.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="046c5-120">For more information about object initializers, see [How to: Initialize Objects without Calling a Constructor (C# Programming Guide)](../../csharp/programming-guide/classes-and-structs/how-to-initialize-objects-by-using-an-object-initializer.md) and [How to: Declare an Object by Using an Object Initializer (Visual Basic)](../../visual-basic/programming-guide/language-features/objects-and-classes/how-to-declare-an-object-by-using-an-object-initializer.md).</span></span>

<span data-ttu-id="046c5-121">次の例では、ワークフローで <xref:System.Activities.Statements.TryCatch> アクティビティを使用します。</span><span class="sxs-lookup"><span data-stu-id="046c5-121">In the following example, a <xref:System.Activities.Statements.TryCatch> activity is used in a workflow.</span></span> <span data-ttu-id="046c5-122">ワークフローによって <xref:System.ApplicationException> がスローされ、<xref:System.Activities.Statements.Catch%601> アクティビティによってこの例外が処理されます。</span><span class="sxs-lookup"><span data-stu-id="046c5-122">An <xref:System.ApplicationException> is thrown by the workflow, and is handled by a <xref:System.Activities.Statements.Catch%601> activity.</span></span> <span data-ttu-id="046c5-123">アクティビティ <xref:System.Activities.Statements.Catch%601> のアクティビティアクションのハンドラーは <xref:System.Activities.Statements.WriteLine> アクティビティであり、例外の詳細はを使用してそれにフローされ `ex` <xref:System.Activities.DelegateInArgument%601> ます。</span><span class="sxs-lookup"><span data-stu-id="046c5-123">The handler for the <xref:System.Activities.Statements.Catch%601> activity's activity action is a <xref:System.Activities.Statements.WriteLine> activity, and the exception detail is flowed through to it using the `ex` <xref:System.Activities.DelegateInArgument%601>.</span></span>

[!code-csharp[CFX_WorkflowApplicationExample#33](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#33)]

<span data-ttu-id="046c5-124"><xref:System.Activities.ActivityAction%601> を定義するカスタム アクティビティを作成する場合は、<xref:System.Activities.Statements.InvokeAction%601> を使用して <xref:System.Activities.ActivityAction%601> の呼び出しをモデル化します。</span><span class="sxs-lookup"><span data-stu-id="046c5-124">When creating a custom activity that defines an <xref:System.Activities.ActivityAction%601>, use an <xref:System.Activities.Statements.InvokeAction%601> to model the invocation of that <xref:System.Activities.ActivityAction%601>.</span></span> <span data-ttu-id="046c5-125">次の例では、カスタムの `WriteLineWithNotification` アクティビティを定義します。</span><span class="sxs-lookup"><span data-stu-id="046c5-125">In this example, a custom `WriteLineWithNotification` activity is defined.</span></span> <span data-ttu-id="046c5-126">このアクティビティは、<xref:System.Activities.Statements.Sequence> アクティビティが含まれ、その後に 1 つの文字列引数を取る <xref:System.Activities.Statements.WriteLine> を呼び出す <xref:System.Activities.Statements.InvokeAction%601> が続く <xref:System.Activities.ActivityAction%601> で構成されます。</span><span class="sxs-lookup"><span data-stu-id="046c5-126">This activity is composed of a <xref:System.Activities.Statements.Sequence> that contains a <xref:System.Activities.Statements.WriteLine> activity followed by an <xref:System.Activities.Statements.InvokeAction%601> that invokes an <xref:System.Activities.ActivityAction%601> that takes one string argument.</span></span>

[!code-csharp[CFX_ActivityExample#1](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#1)]

<span data-ttu-id="046c5-127">`WriteLineWithNotification` アクティビティを使用してワークフローを作成する場合、ワークフローの作成者は、アクティビティ アクションの <xref:System.Activities.ActivityDelegate.Handler%2A> で必要なカスタム ロジックを指定します。</span><span class="sxs-lookup"><span data-stu-id="046c5-127">When a workflow is created by using the `WriteLineWithNotification` activity, the workflow author specifies the desired custom logic in the activity action’s <xref:System.Activities.ActivityDelegate.Handler%2A>.</span></span> <span data-ttu-id="046c5-128">次の例では、`WriteLineWithNotification` アクティビティを使用してワークフローを作成し、<xref:System.Activities.Statements.WriteLine> として <xref:System.Activities.ActivityDelegate.Handler%2A> アクティビティを使用します。</span><span class="sxs-lookup"><span data-stu-id="046c5-128">In this example, a workflow is created that use the `WriteLineWithNotification` activity, and a <xref:System.Activities.Statements.WriteLine> activity is used as the <xref:System.Activities.ActivityDelegate.Handler%2A>.</span></span>

[!code-csharp[CFX_ActivityExample#2](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#2)]

<span data-ttu-id="046c5-129">1 つ以上の引数を渡すために <xref:System.Activities.Statements.InvokeAction%601> および <xref:System.Activities.ActivityAction%601> のジェネリック バージョンが複数用意されています。</span><span class="sxs-lookup"><span data-stu-id="046c5-129">There are multiple generic versions of <xref:System.Activities.Statements.InvokeAction%601> and <xref:System.Activities.ActivityAction%601> provided for passing one or more arguments.</span></span>

## <a name="using-activityfunc"></a><span data-ttu-id="046c5-130">ActivityFunc の使用</span><span class="sxs-lookup"><span data-stu-id="046c5-130">Using ActivityFunc</span></span>

<span data-ttu-id="046c5-131"><xref:System.Activities.ActivityAction%601> はアクティビティから結果値が返されない場合に役立ち、<xref:System.Activities.ActivityFunc%601> は結果値が返される場合に使用されます。</span><span class="sxs-lookup"><span data-stu-id="046c5-131"><xref:System.Activities.ActivityAction%601> is useful when there is no result value from the activity, and <xref:System.Activities.ActivityFunc%601> is used when a result value is returned.</span></span> <span data-ttu-id="046c5-132"><xref:System.Activities.ActivityFunc%601> を定義するカスタム アクティビティを作成する場合は、<xref:System.Activities.Expressions.InvokeFunc%601> を使用して <xref:System.Activities.ActivityFunc%601> の呼び出しをモデル化します。</span><span class="sxs-lookup"><span data-stu-id="046c5-132">When creating a custom activity that defines an <xref:System.Activities.ActivityFunc%601>, use an <xref:System.Activities.Expressions.InvokeFunc%601> to model the invocation of that <xref:System.Activities.ActivityFunc%601>.</span></span> <span data-ttu-id="046c5-133">次の例では、 `WriteFillerText` アクティビティを定義します。</span><span class="sxs-lookup"><span data-stu-id="046c5-133">In the following example, a `WriteFillerText` activity is defined.</span></span> <span data-ttu-id="046c5-134">充てんテキストを提供するために、整数の引数を取って文字列の結果を持つ <xref:System.Activities.Expressions.InvokeFunc%601> を指定します。</span><span class="sxs-lookup"><span data-stu-id="046c5-134">To supply the filler text, an <xref:System.Activities.Expressions.InvokeFunc%601> is specified that takes an integer argument and has a string result.</span></span> <span data-ttu-id="046c5-135">充てんテキストが取得されると、<xref:System.Activities.Statements.WriteLine> アクティビティを使用してコンソールに表示されます。</span><span class="sxs-lookup"><span data-stu-id="046c5-135">Once the filler text is retrieved, it is displayed to the console using a <xref:System.Activities.Statements.WriteLine> activity.</span></span>

[!code-csharp[CFX_ActivityExample#3](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#3)]

<span data-ttu-id="046c5-136">テキストを提供するには、`int` の引数を 1 つ取って文字列の結果を持つアクティビティを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="046c5-136">To supply the text, an activity must be used that takes one `int` argument and has a string result.</span></span> <span data-ttu-id="046c5-137">次の例では、これらの要件を満たす `TextGenerator` アクティビティを示します。</span><span class="sxs-lookup"><span data-stu-id="046c5-137">This example shows a `TextGenerator` activity that meets these requirements.</span></span>

[!code-csharp[CFX_ActivityExample#4](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#4)]

<span data-ttu-id="046c5-138">`TextGenerator` アクティビティと `WriteFillerText` アクティビティを一緒に使用するには、<xref:System.Activities.ActivityDelegate.Handler%2A> として指定します。</span><span class="sxs-lookup"><span data-stu-id="046c5-138">To use the `TextGenerator` activity with the `WriteFillerText` activity, specify it as the <xref:System.Activities.ActivityDelegate.Handler%2A>.</span></span>

[!code-csharp[CFX_ActivityExample#5](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#5)]
