---
description: '詳細情報: 永続化のベストプラクティス'
title: 永続化のベスト プラクティス
ms.date: 03/30/2017
ms.assetid: 6974c5a4-1af8-4732-ab53-7d694608a3a0
ms.openlocfilehash: 788c025d52e504e7a767a4aa0841ae01a7d3327c
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99787878"
---
# <a name="persistence-best-practices"></a><span data-ttu-id="93511-103">永続化のベスト プラクティス</span><span class="sxs-lookup"><span data-stu-id="93511-103">Persistence Best Practices</span></span>

<span data-ttu-id="93511-104">このドキュメントでは、ワークフローの永続化に関するワークフローのデザインと構成のベスト プラクティスについて説明します。</span><span class="sxs-lookup"><span data-stu-id="93511-104">This document covers best practices for workflow design and configuration related to workflow persistence.</span></span>  
  
## <a name="design-and-implementation-of-durable-workflows"></a><span data-ttu-id="93511-105">永続的ワークフローのデザインと実装</span><span class="sxs-lookup"><span data-stu-id="93511-105">Design and Implementation of Durable Workflows</span></span>  

 <span data-ttu-id="93511-106">一般的に、ワークフローは短く分割された期間に作業を行い、その合間にイベント待機中のアイドル時間がインタリーブされています。</span><span class="sxs-lookup"><span data-stu-id="93511-106">In general, workflows perform work in short periods that are interleaved with times during which the workflow is idle because it is waiting for an event.</span></span> <span data-ttu-id="93511-107">このイベントには、メッセージや期限付きタイマーなどがあります。</span><span class="sxs-lookup"><span data-stu-id="93511-107">This event can be such things as a message or an expiring timer.</span></span> <span data-ttu-id="93511-108">ワークフロー インスタンスがアイドルになったときにこのインスタンスをアンロードするには、サービス ホストがワークフロー インスタンスを永続化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="93511-108">To be able to unload the workflow instance when it becomes idle, the service host must persist the workflow instance.</span></span> <span data-ttu-id="93511-109">これは、ワークフロー インスタンスが非永続化ゾーン (たとえばトランザクションの完了を待機していたり、非同期コールバックを待機している場合) にない場合にのみ可能です。</span><span class="sxs-lookup"><span data-stu-id="93511-109">This is possible only if the workflow instance is not in a no-persist zone (for example, waiting for a transaction to complete, or waiting for an asynchronous callback).</span></span> <span data-ttu-id="93511-110">アイドル状態のワークフロー インスタンスのアンロードを可能にするために、ワークフローの作成者は短時間のアクションに対してのみトランザクション スコープと非同期アクティビティを使用するようにしてください。</span><span class="sxs-lookup"><span data-stu-id="93511-110">To allow an idle workflow instance to unload, the workflow author should use transaction scopes and asynchronous activities for short-lived actions only.</span></span> <span data-ttu-id="93511-111">特に、これらの非永続化ゾーン内での遅延アクティビティはできるだけ短くしてください。</span><span class="sxs-lookup"><span data-stu-id="93511-111">In particular, the author should keep delay activities within these no-persist zones as short as possible.</span></span>  
  
 <span data-ttu-id="93511-112">ワークフローは、ワークフローが使用するすべてのデータ型がシリアル化可能である場合にのみ永続化できます。</span><span class="sxs-lookup"><span data-stu-id="93511-112">A workflow can only be persisted if all of the data types used by the workflow are serializable.</span></span> <span data-ttu-id="93511-113">また、永続化されたワークフローで使用されるカスタム型は、<xref:System.Runtime.Serialization.NetDataContractSerializer> を使用してシリアル化可能である必要があります。そうしないと、<xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> を使用してワークフローを永続化することはできません。</span><span class="sxs-lookup"><span data-stu-id="93511-113">In addition, custom types used in persisted workflows must be serializable with <xref:System.Runtime.Serialization.NetDataContractSerializer> in order to be persisted by <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore>.</span></span>  
  
 <span data-ttu-id="93511-114">永続化されていないワークフロー インスタンスは、ホストまたはコンピューターに障害が発生した場合、復元できません。</span><span class="sxs-lookup"><span data-stu-id="93511-114">A workflow instance cannot be recovered in case of a host or computer failure if it has not been persisted.</span></span> <span data-ttu-id="93511-115">通常は、ワークフローのライフ サイクルの早い時期にワークフロー インスタンスを永続化することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="93511-115">In general, we recommend that you persist a workflow instance early in the workflow’s life cycle.</span></span>  
  
 <span data-ttu-id="93511-116">ワークフローが長時間ビジー状態になっている場合は、ビジー期間中、定期的にワークフロー インスタンスを永続化することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="93511-116">If your workflow is busy for a long time, we recommend that you persist the workflow instance regularly throughout its busy period.</span></span> <span data-ttu-id="93511-117">永続化するには、ワークフロー インスタンスをビジー状態にする一連のアクティビティに <xref:System.Activities.Statements.Persist> アクティビティを追加します。</span><span class="sxs-lookup"><span data-stu-id="93511-117">You can do this by adding <xref:System.Activities.Statements.Persist> activities throughout the sequence of activities that keep the workflow instance busy.</span></span> <span data-ttu-id="93511-118">こうすると、アプリケーション ドメインのリサイクル、ホストの障害、またはコンピューターの障害が原因でシステムがビジー期間の始めにロールバックするのを避けることができます。</span><span class="sxs-lookup"><span data-stu-id="93511-118">In this manner, application domain recycling, host failures, or computer failures do not cause the system to be rolled back to the start of the busy period.</span></span> <span data-ttu-id="93511-119"><xref:System.Activities.Statements.Persist> アクティビティをワークフローに追加すると、パフォーマンスが低下する場合があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="93511-119">Be aware that adding <xref:System.Activities.Statements.Persist> activities to your workflow could lead to a degradation of performance.</span></span>  
  
 <span data-ttu-id="93511-120">Windows Server App Fabric を使用すると、永続化の構成と使用を大幅に簡潔化できます。</span><span class="sxs-lookup"><span data-stu-id="93511-120">Windows Server App Fabric greatly simplifies the configuration and use of persistence.</span></span> <span data-ttu-id="93511-121">詳細については、「 [Windows Server App Fabric の永続](/previous-versions/appfabric/ee677272(v=azure.10))化」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="93511-121">For more information, see [Windows Server App Fabric Persistence](/previous-versions/appfabric/ee677272(v=azure.10))</span></span>  
  
## <a name="configuration-of-scalability-parameters"></a><span data-ttu-id="93511-122">スケーラビリティ パラメーターの構成</span><span class="sxs-lookup"><span data-stu-id="93511-122">Configuration of Scalability Parameters</span></span>  

 <span data-ttu-id="93511-123">スケーラビリティとパフォーマンスの要件により、次のパラメーターの設定が決定されます。</span><span class="sxs-lookup"><span data-stu-id="93511-123">Scalability and performance requirements determine the settings of the following parameters:</span></span>  
  
- <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>  
  
- <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A>  
  
- <xref:System.ServiceModel.Activities.Description.SqlWorkflowInstanceStoreBehavior.InstanceLockedExceptionAction%2A>  
  
 <span data-ttu-id="93511-124">これらのパラメーターは、現在のシナリオに応じて次のように設定してください。</span><span class="sxs-lookup"><span data-stu-id="93511-124">These parameters should be set as follows, according to the current scenario.</span></span>  
  
### <a name="scenario-a-small-number-of-workflow-instances-that-require-optimal-response-time"></a><span data-ttu-id="93511-125">シナリオ: 最適な応答時間が要求される少数のワークフロー インスタンスが存在する場合</span><span class="sxs-lookup"><span data-stu-id="93511-125">Scenario: A Small Number of Workflow Instances That Require Optimal Response Time</span></span>  

 <span data-ttu-id="93511-126">このシナリオでは、ワークフロー インスタンスがアイドル状態になったときに、これらのインスタンスすべてを読み込んだ状態のまま保持する必要があります。</span><span class="sxs-lookup"><span data-stu-id="93511-126">In this scenario, all workflow instances should remain loaded when they become idle.</span></span> <span data-ttu-id="93511-127"><xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> を大きな値に設定します。</span><span class="sxs-lookup"><span data-stu-id="93511-127">Set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> to a large value.</span></span> <span data-ttu-id="93511-128">この設定を使用すると、ワークフロー インスタンスがコンピューター間で移動するのを回避できます。</span><span class="sxs-lookup"><span data-stu-id="93511-128">The use of this setting prevents a workflow instance from moving between computers.</span></span> <span data-ttu-id="93511-129">この設定は、次の 1 つ以上の条件が真である場合にのみ使用してください。</span><span class="sxs-lookup"><span data-stu-id="93511-129">Use this setting only if one or more of the following are true:</span></span>  
  
- <span data-ttu-id="93511-130">ワークフロー インスタンスが有効期間中に 1 つのメッセージを受信する。</span><span class="sxs-lookup"><span data-stu-id="93511-130">A workflow instance receives a single message throughout its lifetime.</span></span>  
  
- <span data-ttu-id="93511-131">すべてのワークフロー インスタンスが 1 台のコンピューター上で実行される。</span><span class="sxs-lookup"><span data-stu-id="93511-131">All workflow instances run on a single computer</span></span>  
  
- <span data-ttu-id="93511-132">ワークフロー インスタンスがすべてのメッセージを同じコンピューターで受信する。</span><span class="sxs-lookup"><span data-stu-id="93511-132">All messages that are received by a workflow instance are received by the same computer.</span></span>  
  
 <span data-ttu-id="93511-133"><xref:System.Activities.Statements.Persist> アクティビティを使用するか、<xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A> を 0 に設定し、サービス ホストまたはコンピューターに障害が発生した場合にワークフロー インスタンスを回復できるようにします。</span><span class="sxs-lookup"><span data-stu-id="93511-133">Use <xref:System.Activities.Statements.Persist> activities or set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A> to 0 to enable recovery of your workflow instance after service host or computer failures.</span></span>  
  
### <a name="scenario-workflow-instances-are-idle-for-long-periods-of-time"></a><span data-ttu-id="93511-134">シナリオ: ワークフロー インタンスが長期間アイドル状態になる場合</span><span class="sxs-lookup"><span data-stu-id="93511-134">Scenario: Workflow Instances Are Idle for Long Periods of Time</span></span>  

 <span data-ttu-id="93511-135">このシナリオでは、<xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> を 0 に設定してリソースをできるだけ早く解放します。</span><span class="sxs-lookup"><span data-stu-id="93511-135">In this scenario, set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> to 0 to release resources as soon as possible.</span></span>  
  
### <a name="scenario-workflow-instances-receive-multiple-messages-in-a-short-period-of-time"></a><span data-ttu-id="93511-136">シナリオ: ワークフロー インスタンスが短期間に複数のメッセージを受信する場合</span><span class="sxs-lookup"><span data-stu-id="93511-136">Scenario: Workflow Instances Receive Multiple Messages in a Short Period of Time</span></span>  

 <span data-ttu-id="93511-137">このシナリオでは、同じコンピューターでこれらのメッセージを受信する場合、<xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> を 60 秒に設定します。</span><span class="sxs-lookup"><span data-stu-id="93511-137">In this scenario, set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> to 60 seconds if these messages are received by the same computer.</span></span> <span data-ttu-id="93511-138">これにより、ワークフロー インスタンスのアンロードと読み込みが頻繁に繰り返される状態を回避できます。</span><span class="sxs-lookup"><span data-stu-id="93511-138">This prevents a rapid sequence of unloading and loading of a workflow instance.</span></span> <span data-ttu-id="93511-139">また、インスタンスがメモリ内に長く留まることを避けることもできます。</span><span class="sxs-lookup"><span data-stu-id="93511-139">This also does not keep the instance in memory for too long.</span></span>  
  
 <span data-ttu-id="93511-140">これらのメッセージを異なるコンピューターで受信する場合は、<xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> を 0 に設定し、<xref:System.ServiceModel.Activities.Description.SqlWorkflowInstanceStoreBehavior.InstanceLockedExceptionAction%2A> を BasicRetry または AggressiveRetry に設定します。</span><span class="sxs-lookup"><span data-stu-id="93511-140">Set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> to 0, and set <xref:System.ServiceModel.Activities.Description.SqlWorkflowInstanceStoreBehavior.InstanceLockedExceptionAction%2A> to BasicRetry or AggressiveRetry if these messages may be received by different computers.</span></span> <span data-ttu-id="93511-141">これにより、別のコンピューターがワークフロー インスタンスを読み込むことができるようになります。</span><span class="sxs-lookup"><span data-stu-id="93511-141">This allows the workflow instance to be loaded by another computer.</span></span>  
  
### <a name="scenario-workflow-uses-delay-activities-with-short-durations"></a><span data-ttu-id="93511-142">シナリオ: ワークフローが短期間の遅延アクティビティを使用する場合</span><span class="sxs-lookup"><span data-stu-id="93511-142">Scenario: Workflow Uses Delay Activities with Short Durations</span></span>  

 <span data-ttu-id="93511-143">このシナリオでは、読み込む必要のあるインスタンスに対して <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> が定期的に永続性データベースをポーリングします。その理由は、<xref:System.Activities.Statements.Delay> アクティビティが期限切れになるためです。</span><span class="sxs-lookup"><span data-stu-id="93511-143">In this scenario, the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> regularly polls the persistence database for instances that should be loaded because of an expired <xref:System.Activities.Statements.Delay> activity.</span></span> <span data-ttu-id="93511-144"><xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> が次のポーリング間隔で期限切れになるタイマーを見つけた場合は、SQL Workflow Instance Store によってポーリング間隔が短縮されます。</span><span class="sxs-lookup"><span data-stu-id="93511-144">If the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> finds a timer that will expire in the next polling interval, the SQL Workflow Instance Store shortens the polling interval.</span></span> <span data-ttu-id="93511-145">次のポーリングは、タイマーが期限切れになった直後に発生します。</span><span class="sxs-lookup"><span data-stu-id="93511-145">The next poll will then occur right after the timer has expired.</span></span> <span data-ttu-id="93511-146">このようにして、SQL Workflow Instance Store はポーリング間隔よりも長く実行されるタイマーの精度を保持します。タイマーは <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> によって設定されます。</span><span class="sxs-lookup"><span data-stu-id="93511-146">This way, the SQL Workflow Instance Store achieves a high accuracy of timers that run longer than the polling interval, which is set by <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>.</span></span> <span data-ttu-id="93511-147">より短い遅延で迅速な処理を実行するために、ワークフロー インスタンスは少なくとも 1 つのポーリング間隔中、メモリに留まる必要があります。</span><span class="sxs-lookup"><span data-stu-id="93511-147">To enable timely processing of shorter delays, the workflow instance must remain in memory for at least one polling interval.</span></span>  
  
 <span data-ttu-id="93511-148"><xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A> を 0 に設定し、有効期限を永続性データベースに書き込みます。</span><span class="sxs-lookup"><span data-stu-id="93511-148">Set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A> to 0 to write the expiration time to the persistence database.</span></span>  
  
 <span data-ttu-id="93511-149"><xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> を <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> 以上に設定し、少なくとも 1 つのポーリング間隔中、インスタンスをメモリに保持します。</span><span class="sxs-lookup"><span data-stu-id="93511-149">Set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> to longer than or equal to <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> to keep the instance in memory for at least one polling interval.</span></span>  
  
 <span data-ttu-id="93511-150"><xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> の値を小さくすることはお勧めできません。それによって永続性データベースへの読み込みが増加するためです。</span><span class="sxs-lookup"><span data-stu-id="93511-150">We do not recommend reducing the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> because this leads to an increased load on the persistence database.</span></span> <span data-ttu-id="93511-151"><xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> を使用する各サービス ホストは、検出期間ごとにデータベースを 1 回ポーリングします。</span><span class="sxs-lookup"><span data-stu-id="93511-151">Each service host that uses the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> polls the database one time per detection period.</span></span> <span data-ttu-id="93511-152"><xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> に設定した間隔が小さすぎると、サービス ホストの数が大きい場合にシステムのパフォーマンスが低下することがあります。</span><span class="sxs-lookup"><span data-stu-id="93511-152">Setting <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> to too small a time interval may cause your system's performance to decrease if the number of service hosts is large.</span></span>  
  
## <a name="configuring-the-sql-workflow-instance-store"></a><span data-ttu-id="93511-153">SQL Workflow Instance Store の構成</span><span class="sxs-lookup"><span data-stu-id="93511-153">Configuring the SQL Workflow Instance Store</span></span>  

 <span data-ttu-id="93511-154">SQL Workflow Instance Store には、次の構成パラメーターがあります。</span><span class="sxs-lookup"><span data-stu-id="93511-154">The SQL Workflow Instance Store has the following configuration parameters:</span></span>  
  
 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceEncodingOption%2A>  
 <span data-ttu-id="93511-155">このパラメーターは、<xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> に対してワークフロー インスタンス状態を圧縮するように指示します。</span><span class="sxs-lookup"><span data-stu-id="93511-155">This parameter instructs the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> to compress the workflow instance state.</span></span> <span data-ttu-id="93511-156">圧縮により、永続性データベースに保存されるデータの量が削減され、永続性データベースが専用のデータベース サーバーに常駐している場合のネットワーク トラフィックが緩和されます。</span><span class="sxs-lookup"><span data-stu-id="93511-156">Compression reduces the amount of data that is stored in the persistence database and reduces network traffic in case the persistence database resides on a dedicated database server.</span></span> <span data-ttu-id="93511-157">圧縮を使用する場合は、インスタンス状態を圧縮および抽出するための計算リソースが必要になります。</span><span class="sxs-lookup"><span data-stu-id="93511-157">If compression is used, it requires computational resources to compress and extract the instance state.</span></span> <span data-ttu-id="93511-158">ほとんどの場合は圧縮によってパフォーマンスが向上します。</span><span class="sxs-lookup"><span data-stu-id="93511-158">In most cases, compression yields increased performance.</span></span>  
  
 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceCompletionAction%2A>  
 <span data-ttu-id="93511-159">このパラメーターは、完了したインスタンスを保持または削除するように <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> に指示します。</span><span class="sxs-lookup"><span data-stu-id="93511-159">This parameter instructs the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> to either keep or delete completed instances.</span></span> <span data-ttu-id="93511-160">完了したインスタンスを保持しておくと、永続性データベースにより多くのストレージが必要となり、テーブルのサイズが増加するため、テーブルの検索時間が長くなります。</span><span class="sxs-lookup"><span data-stu-id="93511-160">Keeping completed instances increases the persistence database storage requirements and leads to larger tables, which increases table lookup times.</span></span> <span data-ttu-id="93511-161">完了したインスタンスがデバックまたは監査の目的で必要とならない限り、完了したインスタンスは削除するように <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> に指示するのが最適です。</span><span class="sxs-lookup"><span data-stu-id="93511-161">Unless completed instances are required for debugging or auditing, it is best to instruct the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> to delete completed instances.</span></span> <span data-ttu-id="93511-162">削除したインスタンスは、ユーザーが後でこれらを取り除くプロセスを確立する場合にのみ保持してください。</span><span class="sxs-lookup"><span data-stu-id="93511-162">Deleted instances should be kept only if the user establishes a process for eventually removing them.</span></span> <span data-ttu-id="93511-163">完了したワークフロー インスタンスがインスタンス ストアに残っている限り、相関関係キーを再利用することはできないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="93511-163">Note that correlation keys cannot be reused as long as the completed workflow instance resides in the instance store.</span></span>  
  
 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>  
 <span data-ttu-id="93511-164">このパラメーターは、<xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> アクティビティが期限切れになったときに読み込む必要のあるインスタンスに対して <xref:System.Activities.Statements.Delay> が永続性データベースをポーリングする最大間隔を定義します。</span><span class="sxs-lookup"><span data-stu-id="93511-164">This parameter defines the maximum interval with which the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> polls the persistence database for instances that should be loaded when a <xref:System.Activities.Statements.Delay> activity expires.</span></span> <span data-ttu-id="93511-165"><xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> が次のポーリング間隔で期限切れになるタイマーを見つけた場合は、ポーリング間隔を短縮し、タイマーの期限切れ直後に次のポーリングが発生するようにします。</span><span class="sxs-lookup"><span data-stu-id="93511-165">If the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> finds a timer that will expire in the next polling interval, it shortens the polling interval so that the next poll will occur right after the timer has expired.</span></span> <span data-ttu-id="93511-166">このようにして、SQL Workflow Instance Store は <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> よりも長く実行されるタイマーの精度を保持します。</span><span class="sxs-lookup"><span data-stu-id="93511-166">This way, the SQL Workflow Instance Store achieves a high accuracy of timers that run longer than <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>.</span></span>  
  
 <span data-ttu-id="93511-167"><xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> の値を小さくすることはお勧めできません。それによって永続性データベースへの読み込みが増加するためです。</span><span class="sxs-lookup"><span data-stu-id="93511-167">We do not recommend reducing the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>, because this leads to an increased load on the persistence database.</span></span> <span data-ttu-id="93511-168"><xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> を使用する各サービス ホストは、検出期間ごとにデータベースを 1 回ポーリングします。</span><span class="sxs-lookup"><span data-stu-id="93511-168">Each service host that uses the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> polls the database one time per detection period.</span></span> <span data-ttu-id="93511-169"><xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> に設定した間隔が小さすぎると、サービス ホストの数が大きい場合にシステムのパフォーマンスが低下することがあります。</span><span class="sxs-lookup"><span data-stu-id="93511-169">Setting <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> to too small an interval may cause your system's performance to decrease if the number of service hosts is large.</span></span>  
  
 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.HostLockRenewalPeriod%2A>  
 <span data-ttu-id="93511-170">このパラメーターは、ホストが永続性データベース内のロックを更新する間隔を定義します。</span><span class="sxs-lookup"><span data-stu-id="93511-170">This parameter defines the interval with which the host renews its lock in the persistence database.</span></span> <span data-ttu-id="93511-171">この間隔を短縮すると、ホストまたはコンピューターに障害が発生した場合にワークフロー インスタンスをよりすばやく回復できるようになります。</span><span class="sxs-lookup"><span data-stu-id="93511-171">Shortening this interval will enable a quicker recovery of the workflow instances in case a host or computer fails.</span></span> <span data-ttu-id="93511-172">一方、ロックの更新間隔を短くすると、永続性データベースへの読み込みが増えます。</span><span class="sxs-lookup"><span data-stu-id="93511-172">On the other hand, a short lock renewal period increases the load on the persistence database.</span></span> <span data-ttu-id="93511-173"><xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> を使用する各サービス ホストは、1 つの更新間隔ごとにデータベース内のロックを 1 回更新します。</span><span class="sxs-lookup"><span data-stu-id="93511-173">Each service host that uses the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> will update its locks in the database one time per renewal period.</span></span> <span data-ttu-id="93511-174">コンピューターが多くのサービス ホストを実行する場合は、ロックの更新によって発生する読み込みがシステム パフォーマンスの低下をもたらさないようにしてください。</span><span class="sxs-lookup"><span data-stu-id="93511-174">If a computer runs many service hosts, make sure that the load caused by lock renewal does not decrease your system's performance.</span></span> <span data-ttu-id="93511-175">パフォーマンスが低下する場合は、<xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.HostLockRenewalPeriod%2A> を大きくしてください。</span><span class="sxs-lookup"><span data-stu-id="93511-175">If it does, consider increasing the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.HostLockRenewalPeriod%2A>.</span></span>  
  
 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A>  
 <span data-ttu-id="93511-176">有効にした場合、<xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> はロック済みインスタンスの読み込みを次の 30 秒間再試行します。</span><span class="sxs-lookup"><span data-stu-id="93511-176">If enabled, the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> retries to load a locked instance for the next 30 seconds.</span></span> <span data-ttu-id="93511-177">ワークフローが短期間に複数のメッセージを受信し、これらのメッセージを異なるコンピューターで受信する場合は、<xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> を BasicRetry または AggressiveRetry に設定してください。</span><span class="sxs-lookup"><span data-stu-id="93511-177">Set <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> to BasicRetry or AggressiveRetry if the workflow receives multiple messages in a short time, and these messages are received by different computers.</span></span>  
  
 <span data-ttu-id="93511-178">読み込みが再試行されない限り、再試行メカニズムによってパフォーマンスのオーバーヘッドが発生することはないので、<xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> は常に有効にしてください。</span><span class="sxs-lookup"><span data-stu-id="93511-178">Because the load retry mechanism does not introduce any performance overhead as long as load retries are not tried, <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> should always be enabled.</span></span>
