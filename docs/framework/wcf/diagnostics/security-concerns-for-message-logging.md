---
description: 詳細については、「メッセージログのセキュリティに関する考慮事項」を参照してください。
title: メッセージ ログ記録のセキュリティの考慮事項
ms.date: 03/30/2017
ms.assetid: 21f513f2-815b-47f3-85a6-03c008510038
ms.openlocfilehash: 88adc4eb772ad8c39ace23f2771ee68fa2288c3c
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99771016"
---
# <a name="security-concerns-for-message-logging"></a><span data-ttu-id="3969b-103">メッセージ ログ記録のセキュリティの考慮事項</span><span class="sxs-lookup"><span data-stu-id="3969b-103">Security Concerns for Message Logging</span></span>

<span data-ttu-id="3969b-104">ここでは、メッセージ ログに表示される機密データだけでなく、メッセージ ログによって生成されるイベントを保護する方法についても説明します。</span><span class="sxs-lookup"><span data-stu-id="3969b-104">This topic describes how you can protect sensitive data from being exposed in message logs, as well as events generated by message logging.</span></span>  
  
## <a name="security-concerns"></a><span data-ttu-id="3969b-105">セキュリティに関する注意事項</span><span class="sxs-lookup"><span data-stu-id="3969b-105">Security Concerns</span></span>  
  
### <a name="logging-sensitive-information"></a><span data-ttu-id="3969b-106">機密情報のログ記録</span><span class="sxs-lookup"><span data-stu-id="3969b-106">Logging Sensitive Information</span></span>  

 <span data-ttu-id="3969b-107">Windows Communication Foundation (WCF) では、アプリケーション固有のヘッダーと本文のデータは一切変更されません。</span><span class="sxs-lookup"><span data-stu-id="3969b-107">Windows Communication Foundation (WCF) does not modify any data in application-specific headers and body.</span></span> <span data-ttu-id="3969b-108">また、WCF は、アプリケーション固有のヘッダーまたは本文データにある個人情報を追跡しません。</span><span class="sxs-lookup"><span data-stu-id="3969b-108">WCF also does not track personal information in application-specific headers or body data.</span></span>  
  
 <span data-ttu-id="3969b-109">メッセージのログ記録が有効になっていると、アプリケーション固有ヘッダー内にある個人情報 (クエリ文字列など)、および本文情報 (クレジット カード番号) がログ内で確認できるようになります。</span><span class="sxs-lookup"><span data-stu-id="3969b-109">When message logging is enabled, personal information in application-specific headers, such as, a query string; and body information, such as, a credit card number, can become visible in the logs.</span></span> <span data-ttu-id="3969b-110">アプリケーションを配置するユーザーは、構成ファイルとログ ファイルに対するアクセス制御を実施する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3969b-110">The application deployer is responsible for enforcing access control on the configuration and log files.</span></span> <span data-ttu-id="3969b-111">この種の情報を表示しないようにするには、ログ記録を無効にするか、ログを共有する場合にこの種のデータにフィルターをかけて除外します。</span><span class="sxs-lookup"><span data-stu-id="3969b-111">If you do not want this kind of information to be visible, you should disable logging, or filter out part of the data if you want to share the logs.</span></span>  
  
 <span data-ttu-id="3969b-112">ログ ファイルの内容が意図せず公開されることを防ぐためには、次のヒントに従います。</span><span class="sxs-lookup"><span data-stu-id="3969b-112">The following tips can help you to prevent the content of a log file from being exposed unintentionally:</span></span>  
  
- <span data-ttu-id="3969b-113">Web ホストおよび自己ホストの両方のシナリオにおいて、ログ ファイルがアクセス制御リスト (ACL) によって保護されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="3969b-113">Ensure that the log files are protected by Access Control Lists (ACL) both in Web-host and self-host scenarios.</span></span>  
  
- <span data-ttu-id="3969b-114">Web 要求を使用して簡単に処理できないファイル拡張子を選択します。</span><span class="sxs-lookup"><span data-stu-id="3969b-114">Choose a file extension that cannot be easily served using a Web request.</span></span> <span data-ttu-id="3969b-115">たとえば、.xml ファイルの拡張子を選ぶのは安全ではありません。</span><span class="sxs-lookup"><span data-stu-id="3969b-115">For example, the .xml file extension is not a safe choice.</span></span> <span data-ttu-id="3969b-116">インターネット インフォメーション サービス (IIS) の管理ガイドを参照して、処理できる拡張子のリストを確認します。</span><span class="sxs-lookup"><span data-stu-id="3969b-116">You can check the Internet Information Services (IIS) administration guide to see a list of extensions that can be served.</span></span>  
  
- <span data-ttu-id="3969b-117">ログ ファイルのある場所への絶対パスを指定します。この場所は、部外者が Web ブラウザーを使用してアクセスできないように、Web ホストの vroot パブリック ディレクトリの外にします。</span><span class="sxs-lookup"><span data-stu-id="3969b-117">Specify an absolute path for the log file location, which should be outside of the Web host vroot public directory to prevent it from being accessed by an external party using a Web browser.</span></span>  
  
 <span data-ttu-id="3969b-118">既定では、キーおよびユーザー名やパスワードなどの個人を特定できる情報 (PII) は、トレースおよびログに記録するメッセージではありません。</span><span class="sxs-lookup"><span data-stu-id="3969b-118">By default, keys and personally identifiable information (PII) such as username and password are not logged in traces and logged messages.</span></span> <span data-ttu-id="3969b-119">しかし、コンピューターの管理者は、Machine.config ファイルの `enableLoggingKnownPII` 要素にある `machineSettings` 属性を使用して、コンピューター上で実行されているアプリケーションに対し、既知の PII (個人を特定できる情報) のログ記録を許可できます。</span><span class="sxs-lookup"><span data-stu-id="3969b-119">A machine administrator, however, can use the `enableLoggingKnownPII` attribute in the `machineSettings` element of the Machine.config file to permit applications running on the machine to log known personally identifiable information (PII).</span></span> <span data-ttu-id="3969b-120">次の構成では、この設定方法について示します。</span><span class="sxs-lookup"><span data-stu-id="3969b-120">The following configuration demonstrates how to do this:</span></span>  
  
```xml  
<configuration>  
   <system.serviceModel>  
      <machineSettings enableLoggingKnownPii="true"/>  
   </system.serviceModel>  
</configuration>
```  
  
 <span data-ttu-id="3969b-121">アプリケーションを配置するユーザーが App.config ファイルか Web.config ファイルのいずれかで `logKnownPii` 属性を使用することで 、PII ログを可能にする方法を次に示します。</span><span class="sxs-lookup"><span data-stu-id="3969b-121">An application deployer can then use the `logKnownPii` attribute in either the App.config or Web.config file to enable PII logging as follows:</span></span>  
  
```xml  
<system.diagnostics>  
  <sources>  
      <source name="System.ServiceModel.MessageLogging"  
        logKnownPii="true">  
        <listeners>  
                 <add name="messages"  
                 type="System.Diagnostics.XmlWriterTraceListener"  
                 initializeData="c:\logs\messages.svclog" />  
          </listeners>  
      </source>  
    </sources>  
</system.diagnostics>  
```  
  
 <span data-ttu-id="3969b-122">両方の設定が `true` の場合にのみ、PII はログに記録されます。</span><span class="sxs-lookup"><span data-stu-id="3969b-122">Only when both settings are `true` is PII logging enabled.</span></span> <span data-ttu-id="3969b-123">2 種類のスイッチを組み合わせることで、各アプリケーションで既知の PII のログを柔軟に記録できるようになります。</span><span class="sxs-lookup"><span data-stu-id="3969b-123">The combination of two switches allows the flexibility to log known PII for each application.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="3969b-124">[!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] では、PII ログ記録を有効にするには、Web.config ファイルまたは App.config ファイルで `logEntireMessage` フラグと `logKnownPii` フラグを `true` に設定する必要があります。`<system.serviceModel><messageLogging logEntireMessage="true" logKnownPii="true" …` のように設定します。</span><span class="sxs-lookup"><span data-stu-id="3969b-124">In [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] the `logEntireMessage` and `logKnownPii` flags must also be set to `true` in the Web.config file or the App.config file to enable PII logging, as show in the following example `<system.serviceModel><messageLogging logEntireMessage="true" logKnownPii="true" …`.</span></span>  
  
 <span data-ttu-id="3969b-125">構成ファイルで 2 種類以上のカスタム ソースを指定しても、最初のソースの属性のみが読み込まれることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="3969b-125">You should be aware that if you specify two or more custom sources in a configuration file, only the attributes of the first source are read.</span></span> <span data-ttu-id="3969b-126">他の属性は無視されます。</span><span class="sxs-lookup"><span data-stu-id="3969b-126">The others are ignored.</span></span> <span data-ttu-id="3969b-127">つまり、2 番目以降の App.config ファイルでは、PII はいずれのソースでもログに記録されなくなります。これは 2 番目のソースで PII のログ記録を明示的に有効にした場合でも同様です。</span><span class="sxs-lookup"><span data-stu-id="3969b-127">This means that, for the following App.config, file, PII is not logged for both sources even though PII logging is explicitly enabled for the second source.</span></span>  
  
```xml  
<system.diagnostics>  
   <sources>  
      <source name="System.ServiceModel.MessageLogging"  
              logKnownPii="false">  
              <listeners>  
                 <add name="messages"  
                      type="System.Diagnostics.XmlWriterTraceListener"  
                      initializeData="c:\logs\messages.svclog" />  
              </listeners>  
            </source>  
      <source name="System.ServiceModel"
              logKnownPii="true">  
              <listeners>  
                 <add name="traces"  
                      type="System.Diagnostics.XmlWriterTraceListener"  
                      initializeData="c:\logs\traces.svclog" />  
              </listeners>  
      </source>  
   </sources>  
</system.diagnostics>  
```  
  
 <span data-ttu-id="3969b-128">`<machineSettings enableLoggingKnownPii="Boolean"/>` の要素が Machine.config ファイルに含まれていない場合、システムは <xref:System.Configuration.ConfigurationErrorsException> をスローします。</span><span class="sxs-lookup"><span data-stu-id="3969b-128">If the `<machineSettings enableLoggingKnownPii="Boolean"/>` element exists outside the Machine.config file, the system throws a <xref:System.Configuration.ConfigurationErrorsException>.</span></span>  
  
 <span data-ttu-id="3969b-129">変更点はアプリケーションが開始されるか、再起動されるまで、反映されません。</span><span class="sxs-lookup"><span data-stu-id="3969b-129">The changes are effective only when the application starts or restarts.</span></span> <span data-ttu-id="3969b-130">両方の属性も `true` に設定されている場合は、イベントは開始時にログに記録されます。</span><span class="sxs-lookup"><span data-stu-id="3969b-130">An event is logged at startup when both attributes are set to `true`.</span></span> <span data-ttu-id="3969b-131">また、`logKnownPii` が `true` に設定され、`enableLoggingKnownPii` が `false` に設定されている場合にも、イベントはログに記録されます。</span><span class="sxs-lookup"><span data-stu-id="3969b-131">An event is also logged if `logKnownPii` is set to `true` but `enableLoggingKnownPii` is `false`.</span></span>  
  
 <span data-ttu-id="3969b-132">コンピューターの管理者およびアプリケーションを配置するユーザーは、これらの 2 種類のスイッチを使用する場合に注意する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3969b-132">The machine administrator and application deployer should exercise extreme caution when using these two switches.</span></span> <span data-ttu-id="3969b-133">PII のログ記録が有効になっている場合は、セキュリティ キーと PII がログに記録されます。</span><span class="sxs-lookup"><span data-stu-id="3969b-133">If PII logging is enabled, security keys and PII are logged.</span></span> <span data-ttu-id="3969b-134">ログ記録を無効にしても、機密情報およびアプリケーション固有のデータは、依然としてメッセージのヘッダーと本体に記録されています。</span><span class="sxs-lookup"><span data-stu-id="3969b-134">If it is disabled, sensitive and application-specific data is still logged in message headers and bodies.</span></span> <span data-ttu-id="3969b-135">プライバシーの詳細および PII の公開を防止する方法については、「 [ユーザーのプライバシー](/previous-versions/dotnet/articles/aa480490(v=msdn.10))」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3969b-135">For a more thorough discussion about privacy and protecting PII from being exposed, see [User Privacy](/previous-versions/dotnet/articles/aa480490(v=msdn.10)).</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="3969b-136">PII は無効なメッセージでは非表示になりません。</span><span class="sxs-lookup"><span data-stu-id="3969b-136">PII is not hidden in malformed messages.</span></span> <span data-ttu-id="3969b-137">このようなメッセージは、変更されずにそのままログに記録されます。</span><span class="sxs-lookup"><span data-stu-id="3969b-137">Such messaged are logged as-is without any modification.</span></span> <span data-ttu-id="3969b-138">上に示した属性は、このことに影響を与えません。</span><span class="sxs-lookup"><span data-stu-id="3969b-138">Attributes mentioned previously have no effect on this.</span></span>  
  
### <a name="custom-trace-listener"></a><span data-ttu-id="3969b-139">カスタム トレース リスナー</span><span class="sxs-lookup"><span data-stu-id="3969b-139">Custom Trace Listener</span></span>  

 <span data-ttu-id="3969b-140">カスタム トレース リスナーをメッセージ ログのトレース ソースに追加する権限は、管理者だけに付与する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3969b-140">Adding a custom trace listener on the Message Logging trace source is a privilege that should be restricted to the administrator.</span></span> <span data-ttu-id="3969b-141">これは、機密情報の漏洩につながるメッセージをリモートで送信するように、悪意のあるカスタム リスナーを構成することが可能なためです。</span><span class="sxs-lookup"><span data-stu-id="3969b-141">This is because malicious custom listeners can be configured to send messages remotely, which leads to sensitive information disclosure.</span></span> <span data-ttu-id="3969b-142">また、ネットワークを介してリモート データベースなどにメッセージを送信するようにカスタム リスナーを構成している場合は、リモート コンピューター上のメッセージ ログに対する適切なアクセス制御を実施する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3969b-142">In addition, if you configure a custom listener to send messages on the wire, such as, to a remote database, you should enforce proper access control on the message logs in the remote machine.</span></span>  
  
## <a name="events-triggered-by-message-logging"></a><span data-ttu-id="3969b-143">メッセージ ログ記録でトリガーされるイベント</span><span class="sxs-lookup"><span data-stu-id="3969b-143">Events Triggered by Message Logging</span></span>  

 <span data-ttu-id="3969b-144">メッセージ ログ記録で発生するすべてのイベントを以下に示します。</span><span class="sxs-lookup"><span data-stu-id="3969b-144">The following lists all the events emitted by message logging.</span></span>  
  
- <span data-ttu-id="3969b-145">Message logging on : このイベントは、メッセージ ログ記録が構成内で、または WMI を介して有効になっている場合に発生します。</span><span class="sxs-lookup"><span data-stu-id="3969b-145">Message logging on: This event is emitted when message logging is enabled in configuration, or through WMI.</span></span> <span data-ttu-id="3969b-146">イベントの内容は "メッセージのログ記録が有効になりました。</span><span class="sxs-lookup"><span data-stu-id="3969b-146">The content of the event is "Message logging has been turned on.</span></span> <span data-ttu-id="3969b-147">機密情報は、通信回線上で暗号化されていた場合でも平文で記録される可能性があります (メッセージ本文など)" となります。</span><span class="sxs-lookup"><span data-stu-id="3969b-147">Sensitive information may be logged in clear text, even if they were encrypted on the wire, for example, message bodies."</span></span>  
  
- <span data-ttu-id="3969b-148">Message logging off : このイベントは、メッセージ ログ記録が WMI を介して無効になっている場合に発生します。</span><span class="sxs-lookup"><span data-stu-id="3969b-148">Message logging off: This event is emitted when message logging is disabled through WMI.</span></span> <span data-ttu-id="3969b-149">イベントの内容は "メッセージのログ記録が無効になりました" となります。</span><span class="sxs-lookup"><span data-stu-id="3969b-149">The content of the event is "Message logging has been turned off."</span></span>  
  
- <span data-ttu-id="3969b-150">Log Known PII On : このイベントは、既知の PII のログ記録が有効になっている場合に発生します。</span><span class="sxs-lookup"><span data-stu-id="3969b-150">Log Known PII On: This event is emitted when logging of known PII is enabled.</span></span> <span data-ttu-id="3969b-151">このエラーは、 `enableLoggingKnownPii` `machineSettings` Machine.config ファイルの要素の属性がに設定され、 `true` `logKnownPii` `source` App.config または Web.config ファイルの要素の属性がに設定さ `true` れている場合に発生します。</span><span class="sxs-lookup"><span data-stu-id="3969b-151">This happens when the `enableLoggingKnownPii` attribute in the `machineSettings` element of the Machine.config file is set to `true`, and the `logKnownPii` attribute of the `source` element in either the App.config or Web.config file is set to `true`.</span></span>  
  
- <span data-ttu-id="3969b-152">Log Known PII Not Allowed : このイベントは既知の PII のログ記録が許可されていない場合に発生します。</span><span class="sxs-lookup"><span data-stu-id="3969b-152">Log Known PII Not Allowed: This event is emitted when logging of known PII is not allowed.</span></span> <span data-ttu-id="3969b-153">このエラーは、 `logKnownPii` `source` App.config または Web.config ファイルの要素の属性がに設定されて `true` いても、 `enableLoggingKnownPii` `machineSettings` Machine.config ファイルの要素の属性がに設定さ `false` れている場合に発生します。</span><span class="sxs-lookup"><span data-stu-id="3969b-153">This happens when the `logKnownPii` attribute of the `source` element in either the App.config or Web.config file is set to `true`, but the `enableLoggingKnownPii` attribute in the `machineSettings` element of the Machine.config file is set to `false`.</span></span> <span data-ttu-id="3969b-154">例外はスローされません。</span><span class="sxs-lookup"><span data-stu-id="3969b-154">No exception is thrown.</span></span>  
  
 <span data-ttu-id="3969b-155">これらのイベントは、Windows に付属するイベント ビューアー ツールを使用して表示できます。</span><span class="sxs-lookup"><span data-stu-id="3969b-155">These events can be viewed in the Event Viewer tool that comes with Windows.</span></span> <span data-ttu-id="3969b-156">詳細については、「 [イベントログ](./event-logging/index.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3969b-156">For more information on this, see [Event Logging](./event-logging/index.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3969b-157">関連項目</span><span class="sxs-lookup"><span data-stu-id="3969b-157">See also</span></span>

- [<span data-ttu-id="3969b-158">メッセージ ログ</span><span class="sxs-lookup"><span data-stu-id="3969b-158">Message Logging</span></span>](message-logging.md)
- [<span data-ttu-id="3969b-159">トレースに関するセキュリティの考慮事項と役立つヒント</span><span class="sxs-lookup"><span data-stu-id="3969b-159">Security Concerns and Useful Tips for Tracing</span></span>](./tracing/security-concerns-and-useful-tips-for-tracing.md)
