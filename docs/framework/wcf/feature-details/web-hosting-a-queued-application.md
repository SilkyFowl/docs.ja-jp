---
description: '詳細情報: キューに登録されたアプリケーションをホストする Web'
title: キューに置かれたアプリケーションの Web ホスト
ms.date: 03/30/2017
ms.assetid: c7a539fa-e442-4c08-a7f1-17b7f5a03e88
ms.openlocfilehash: 5fb056a75598523554869f0089689979986dba7f
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99752562"
---
# <a name="web-hosting-a-queued-application"></a><span data-ttu-id="401ea-103">キューに置かれたアプリケーションの Web ホスト</span><span class="sxs-lookup"><span data-stu-id="401ea-103">Web Hosting a Queued Application</span></span>

<span data-ttu-id="401ea-104">Windows プロセス アクティブ化サービス (WAS) は、Windows Communication Foundation (WCF) サービスをホストするアプリケーションが含まれているワーカー プロセスのアクティブ化と有効期間を管理します。</span><span class="sxs-lookup"><span data-stu-id="401ea-104">The Windows Process Activation Service (WAS) manages the activation and lifetime of the worker processes that contain applications that host Windows Communication Foundation (WCF) services.</span></span> <span data-ttu-id="401ea-105">WAS プロセス モデルは、HTTP への依存性を取り除くことで、HTTP サーバーの IIS 6.0 プロセス モデルを一般化します。</span><span class="sxs-lookup"><span data-stu-id="401ea-105">The WAS process model generalizes the IIS 6.0 process model for the HTTP server by removing the dependency on HTTP.</span></span> <span data-ttu-id="401ea-106">これにより、WCF サービスは、メッセージベースのアクティブ化をサポートし、特定のコンピューターで多数のアプリケーションをホストする機能を提供するホスティング環境で、HTTP プロトコルと非 HTTP プロトコルの両方を使用できます。</span><span class="sxs-lookup"><span data-stu-id="401ea-106">This allows WCF services to use both HTTP and non-HTTP protocols, such as net.msmq and msmq.formatname, in a hosting environment that supports message-based activation and offers the ability to host a large number of applications on a given computer.</span></span>  
  
 <span data-ttu-id="401ea-107">WAS にはメッセージ キュー (MSMQ) アクティブ化サービスが含まれており、アプリケーションで使用されるキューのいずれかに 1 つ以上のメッセージが置かれると、キュー アプリケーションがアクティブ化されます。</span><span class="sxs-lookup"><span data-stu-id="401ea-107">WAS includes a Message Queuing (MSMQ) activation service that activates a queued application when one or more messages are placed in one of the queues used by the application.</span></span> <span data-ttu-id="401ea-108">MSMQ アクティブ化サービスは、既定で自動的に開始される NT サービスです。</span><span class="sxs-lookup"><span data-stu-id="401ea-108">The MSMQ activation service is an NT service that is automatically started by default.</span></span>  
  
 <span data-ttu-id="401ea-109">WAS とその利点の詳細については、「 [Windows プロセスアクティブ化サービスでのホスト](hosting-in-windows-process-activation-service.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="401ea-109">For more information about WAS and its benefits, see [Hosting in Windows Process Activation Service](hosting-in-windows-process-activation-service.md).</span></span> <span data-ttu-id="401ea-110">MSMQ の詳細については、「 [キューの概要](queues-overview.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="401ea-110">For more information about MSMQ, see [Queues Overview](queues-overview.md).</span></span>
  
## <a name="queue-addressing-in-was"></a><span data-ttu-id="401ea-111">WAS でのキュー アドレス指定</span><span class="sxs-lookup"><span data-stu-id="401ea-111">Queue Addressing in WAS</span></span>  

 <span data-ttu-id="401ea-112">WAS アプリケーションには URI (Uniform Resource Identifier) アドレスがあります。</span><span class="sxs-lookup"><span data-stu-id="401ea-112">WAS applications have Uniform Resource Identifier (URI) addresses.</span></span> <span data-ttu-id="401ea-113">アプリケーション アドレスは、ベース URI プレフィックスとアプリケーション固有の相対アドレス (パス) の 2 つの部分に分かれます。</span><span class="sxs-lookup"><span data-stu-id="401ea-113">Application addresses have two parts: a base URI prefix and an application-specific, relative address (path).</span></span> <span data-ttu-id="401ea-114">この 2 つの部分を結合すると、アプリケーションの外部アドレスになります。</span><span class="sxs-lookup"><span data-stu-id="401ea-114">These two parts provide the external address for an application when joined together.</span></span> <span data-ttu-id="401ea-115">ベース URI プレフィックスはサイトバインドから構築され、サイトのすべてのアプリケーションに使用されます。たとえば、"net.tcp:/localhost"、"msmq. formatname:/localhost"、"net.tcp:/localhost" などです。</span><span class="sxs-lookup"><span data-stu-id="401ea-115">The base URI prefix is constructed from the site binding and is used for all the applications under the site, for example, "net.msmq://localhost", "msmq.formatname://localhost", or "net.tcp://localhost".</span></span> <span data-ttu-id="401ea-116">アプリケーションアドレスは、アプリケーション固有のパスフラグメント ("/applicationone" など) を取得し、それをベース URI プレフィックスに付加して、完全なアプリケーション URI (例: "net.tcp://") に追加することによって作成されます。</span><span class="sxs-lookup"><span data-stu-id="401ea-116">Application addresses are then constructed by taking application-specific path fragments (such as "/applicationOne") and appending them to the base URI prefix to arrive at the full application URI, for example, "net.msmq://localhost/applicationOne".</span></span>  
  
 <span data-ttu-id="401ea-117">MSMQ アクティブ化サービスは、アプリケーション URI を使用して、MSMQ アクティブ化サービスでメッセージを監視する必要のあるキューを照会します。</span><span class="sxs-lookup"><span data-stu-id="401ea-117">The MSMQ activation service uses the application URI to match the queue that the MSMQ activation service must monitor for messages.</span></span> <span data-ttu-id="401ea-118">MSMQ アクティブ化サービスを起動すると、受信するように設定したコンピューターのすべてのパブリック キューとプライベート キューが列挙され、そのキューのメッセージが監視されます。</span><span class="sxs-lookup"><span data-stu-id="401ea-118">When the MSMQ activation service starts, it enumerates all public and private queues on the computer it is configured to receive from and monitors them for messages.</span></span> <span data-ttu-id="401ea-119">MSMQ アクティブ化サービスは、10 分おきに監視対象のキュー リストを更新します。</span><span class="sxs-lookup"><span data-stu-id="401ea-119">Every 10 minutes, the MSMQ activation service refreshes the list of queues to monitor.</span></span> <span data-ttu-id="401ea-120">キューでメッセージが検出されると、アクティブ化サービスは、キュー名を net.msmq バインディングで一致する最長のアプリケーション URI と一致させ、アプリケーションをアクティブ化します。</span><span class="sxs-lookup"><span data-stu-id="401ea-120">When a message is found in a queue, the activation service matches the queue name to the longest matching application URI for the net.msmq binding and activates the application.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="401ea-121">アクティブ化するアプリケーションは、キュー名のプレフィックスに一致 (最長一致) する必要があります。</span><span class="sxs-lookup"><span data-stu-id="401ea-121">The application being activated must match (longest match) the prefix of the queue name.</span></span>  
  
 <span data-ttu-id="401ea-122">たとえば、msmqWebHost/orderProcessing/service.svc という名前のキューがあるとします。</span><span class="sxs-lookup"><span data-stu-id="401ea-122">For example, a queue name is: msmqWebHost/orderProcessing/service.svc.</span></span> <span data-ttu-id="401ea-123">アプリケーション 1 に仮想ディレクトリ /msmqWebHost/orderProcessing がありその下に service.svc が格納されており、アプリケーション 2 に仮想ディレクトリ /msmqWebHost がありその下に orderProcessing.svc が格納されている場合、アプリケーション 1 がアクティブ化されます。</span><span class="sxs-lookup"><span data-stu-id="401ea-123">If Application 1 has a virtual directory /msmqWebHost/orderProcessing with a service.svc under it, and Application 2 has a virtual directory /msmqWebHost with an orderProcessing.svc under it, Application 1 is activated.</span></span> <span data-ttu-id="401ea-124">アプリケーション 1 が削除されると、アプリケーション 2 がアクティブ化されます。</span><span class="sxs-lookup"><span data-stu-id="401ea-124">If Application 1 is deleted, Application 2 is activated.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="401ea-125">キューが作成され、メッセージがそのキューに送信されても、MSMQ アクティブ化サービスがそのキュー リストを更新するまで、アプリケーションはアクティブ化されません。キュー リストが更新されるまでの時間は、キューが作成されてから最大で 10 分です。</span><span class="sxs-lookup"><span data-stu-id="401ea-125">When a queue is created, any messages sent to it do not activate an application until the MSMQ activation service refreshes the queue list, which is, at most, 10 minutes from the time the queue was created.</span></span> <span data-ttu-id="401ea-126">アクティブ化サービスを再起動した場合も、キュー リストは更新されます。</span><span class="sxs-lookup"><span data-stu-id="401ea-126">Restarting the activation service refreshes the queue list as well.</span></span>  
  
### <a name="the-effect-of-private-and-public-queues-on-addressing"></a><span data-ttu-id="401ea-127">アドレスに対するプライベート キューとパブリック キューの影響</span><span class="sxs-lookup"><span data-stu-id="401ea-127">The Effect of Private and Public Queues on Addressing</span></span>  

 <span data-ttu-id="401ea-128">MSMQ アクティブ化サービスでは、プライベート キューの監視とパブリック キューの監視が区別されません。</span><span class="sxs-lookup"><span data-stu-id="401ea-128">The MSMQ activation service does not distinguish between private and public queue monitoring.</span></span> <span data-ttu-id="401ea-129">したがって、パブリック キューとプライベート キューを同じ名前にすることはできません。</span><span class="sxs-lookup"><span data-stu-id="401ea-129">As such, you cannot have public and private queues with the same name.</span></span> <span data-ttu-id="401ea-130">同じ名前の場合、いずれかのキューを読み込んで、Web ホスト アプリケーションがアクティブ化される場合があります。</span><span class="sxs-lookup"><span data-stu-id="401ea-130">If you do, a Web-hosted application may get activated reading from either of the queues.</span></span>  
  
### <a name="queue-configuration-for-activation"></a><span data-ttu-id="401ea-131">アクティブ化のためのキュー構成</span><span class="sxs-lookup"><span data-stu-id="401ea-131">Queue Configuration for Activation</span></span>  

 <span data-ttu-id="401ea-132">MSMQ アクティブ化サービスは、NETWORK SERVICE として動作します。</span><span class="sxs-lookup"><span data-stu-id="401ea-132">The MSMQ activation service runs as NETWORK SERVICE.</span></span> <span data-ttu-id="401ea-133">これは、アプリケーションをアクティブ化するキューを監視するサービスです。</span><span class="sxs-lookup"><span data-stu-id="401ea-133">It is the service that monitors queues to activate applications.</span></span> <span data-ttu-id="401ea-134">キューからアプリケーションをアクティブ化するようにするには、アクセス制御リスト (ACL) に NETWORK SERVICE アクセス用のキューを指定し、メッセージをピークする必要があります。</span><span class="sxs-lookup"><span data-stu-id="401ea-134">For it to activate applications from the queue, the queue must provide for NETWORK SERVICE access to peek for messages in its access control list (ACL).</span></span>  
  
### <a name="poison-messaging"></a><span data-ttu-id="401ea-135">有害メッセージ処理</span><span class="sxs-lookup"><span data-stu-id="401ea-135">Poison Messaging</span></span>  

 <span data-ttu-id="401ea-136">WCF での有害メッセージの処理は、チャネルによって処理されます。これは、メッセージが有害であることを検出するだけでなく、ユーザーの構成に基づいてディスポジションを選択します。</span><span class="sxs-lookup"><span data-stu-id="401ea-136">Poison message handling in WCF is handled by the channel, which not only detects that a message is poisoned but selects a disposition based on user configuration.</span></span> <span data-ttu-id="401ea-137">そのため、キューには 1 つのメッセージが存在します。</span><span class="sxs-lookup"><span data-stu-id="401ea-137">As a result, there is a single message in the queue.</span></span> <span data-ttu-id="401ea-138">Web ホスト アプリケーションが連続的に中断されると、このメッセージは再試行キューに移動されます。</span><span class="sxs-lookup"><span data-stu-id="401ea-138">The Web-hosted application aborts successive times and the message is moved to a retry queue.</span></span> <span data-ttu-id="401ea-139">再試行サイクル遅延により指定された時点で、メッセージは再試行キューからメイン キューに移動されて再試行されます。</span><span class="sxs-lookup"><span data-stu-id="401ea-139">At a point dictated by the retry cycle delay, the message is moved from the retry queue to the main queue to try again.</span></span> <span data-ttu-id="401ea-140">ただし、この場合、キューに置かれたチャネルがアクティブである必要があります。</span><span class="sxs-lookup"><span data-stu-id="401ea-140">But this requires the queued channel to be active.</span></span> <span data-ttu-id="401ea-141">アプリケーションが WAS により再利用される場合、メッセージは、別のメッセージがメイン キューに到着してキューに置かれたアプリケーションがアクティブ化されるまで再試行キューに残ります。</span><span class="sxs-lookup"><span data-stu-id="401ea-141">If the application is recycled by WAS, then the message remains in the retry queue until another message arrives in the main queue to activate the queued application.</span></span> <span data-ttu-id="401ea-142">この場合の回避策は、メッセージを再試行キューからメイン キューに手動で戻し、アプリケーションを再アクティブ化することです。</span><span class="sxs-lookup"><span data-stu-id="401ea-142">The workaround in this case is to move the message manually from the retry queue back to the main queue to reactivate the application.</span></span>  
  
### <a name="subqueue-and-system-queue-caveat"></a><span data-ttu-id="401ea-143">サブキューとシステム キューに関する注意</span><span class="sxs-lookup"><span data-stu-id="401ea-143">Subqueue and System Queue Caveat</span></span>  

 <span data-ttu-id="401ea-144">WAS によりホストされるアプリケーションを、システム キュー (システム全体の配信不能キューなど) 内や、サブキュー (有害サブキューなど) 内のメッセージに基づいてアクティブ化することはできません。</span><span class="sxs-lookup"><span data-stu-id="401ea-144">A WAS-hosted application cannot be activated based on messages in a system queue, such as the system-wide dead-letter queue, or sub-queues, such as poison sub-queues.</span></span> <span data-ttu-id="401ea-145">これはこのバージョンの製品の制限です。</span><span class="sxs-lookup"><span data-stu-id="401ea-145">This is a limitation for this version of the product.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="401ea-146">関連項目</span><span class="sxs-lookup"><span data-stu-id="401ea-146">See also</span></span>

- [<span data-ttu-id="401ea-147">有害メッセージ処理</span><span class="sxs-lookup"><span data-stu-id="401ea-147">Poison Message Handling</span></span>](poison-message-handling.md)
- [<span data-ttu-id="401ea-148">サービス エンドポイントとキューのアドレス指定</span><span class="sxs-lookup"><span data-stu-id="401ea-148">Service Endpoints and Queue Addressing</span></span>](service-endpoints-and-queue-addressing.md)
