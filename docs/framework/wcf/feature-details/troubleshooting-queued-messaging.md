---
description: '詳細情報: キューに置かれたメッセージングのトラブルシューティング'
title: キューに置かれたメッセージングのトラブルシューティング
ms.date: 03/30/2017
ms.assetid: a5f2836f-018d-42f5-a571-1e97e64ea5b0
ms.openlocfilehash: e7cf2706e7c0853f14bad449b6ecaa8dd5983755
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99733087"
---
# <a name="troubleshooting-queued-messaging"></a><span data-ttu-id="5ad8b-103">キューに置かれたメッセージングのトラブルシューティング</span><span class="sxs-lookup"><span data-stu-id="5ad8b-103">Troubleshooting Queued Messaging</span></span>

<span data-ttu-id="5ad8b-104">ここでは、Windows Communication Foundation (WCF) でキューを使用する際の一般的な質問とトラブルシューティングのヘルプについて説明します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-104">This section contains common questions and troubleshooting help for using queues in Windows Communication Foundation (WCF).</span></span>

## <a name="common-questions"></a><span data-ttu-id="5ad8b-105">一般的な質問</span><span class="sxs-lookup"><span data-stu-id="5ad8b-105">Common Questions</span></span>

<span data-ttu-id="5ad8b-106">**Q:** WCF Beta 1 を使用し、MSMQ 修正プログラムをインストールしました。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-106">**Q:** I used WCF Beta 1 and I installed the MSMQ hotfix.</span></span> <span data-ttu-id="5ad8b-107">この修正プログラムを削除する必要がありますか。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-107">Do I need to remove the hotfix?</span></span>

<span data-ttu-id="5ad8b-108">**A:** はい。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-108">**A:** Yes.</span></span> <span data-ttu-id="5ad8b-109">この修正プログラムのサポートは終了しています。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-109">This hotfix is no longer supported.</span></span> <span data-ttu-id="5ad8b-110">WCF は、修正プログラムの要件を伴わずに MSMQ で動作するようになりました。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-110">WCF now works on MSMQ without a hotfix requirement.</span></span>

<span data-ttu-id="5ad8b-111">**Q:** MSMQ には、との2つのバインドがあり <xref:System.ServiceModel.NetMsmqBinding> <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> ます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-111">**Q:** There are two bindings for MSMQ: <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>.</span></span> <span data-ttu-id="5ad8b-112">それぞれの用途を教えてください。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-112">What should I use and when?</span></span>

<span data-ttu-id="5ad8b-113">**A:**<xref:System.ServiceModel.NetMsmqBinding>2 つの WCF アプリケーション間でキューに置かれた通信のトランスポートとして MSMQ を使用する場合は、を使用します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-113">**A:** Use the <xref:System.ServiceModel.NetMsmqBinding> when you want to use MSMQ as a transport for queued communication between two WCF applications.</span></span> <span data-ttu-id="5ad8b-114">既存の <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> MSMQ アプリケーションを使用して新しい WCF アプリケーションと通信する場合は、を使用します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-114">Use the <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> when you want to use existing MSMQ applications to communicate with new WCF applications.</span></span>

<span data-ttu-id="5ad8b-115">**Q:** バインドとバインドを使用するには、MSMQ をアップグレードする必要があり <xref:System.ServiceModel.NetMsmqBinding> `MsmqIntegration` ますか。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-115">**Q:** Do I have to upgrade MSMQ to use the <xref:System.ServiceModel.NetMsmqBinding> and `MsmqIntegration` bindings?</span></span>

<span data-ttu-id="5ad8b-116">**A:** いいえ。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-116">**A:** No.</span></span> <span data-ttu-id="5ad8b-117">どちらのバインドも、Windows XP と Windows Server 2003 の MSMQ 3.0 で動作します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-117">Both bindings work with MSMQ 3.0 on Windows XP and Windows Server 2003.</span></span> <span data-ttu-id="5ad8b-118">Windows Vista で MSMQ 4.0 にアップグレードすると、バインドの特定の機能が使用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-118">Certain features of the bindings become available when you upgrade to MSMQ 4.0 in Windows Vista.</span></span>

<span data-ttu-id="5ad8b-119">**Q:** Msmq 4.0 では、およびバインドのどの機能を <xref:System.ServiceModel.NetMsmqBinding> <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> 使用できますが、msmq 3.0 では使用できませんか。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-119">**Q:** What features of the <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> bindings are available in MSMQ 4.0 but not in MSMQ 3.0?</span></span>

<span data-ttu-id="5ad8b-120">**A:** Msmq 4.0 では、次の機能は使用できますが、MSMQ 3.0 では使用できません。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-120">**A:** The following features are available in MSMQ 4.0 but not in MSMQ 3.0:</span></span>

- <span data-ttu-id="5ad8b-121">カスタム配信不能キューは、MSMQ 4.0 でのみサポートされます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-121">Custom dead-letter queue is supported only on MSMQ 4.0.</span></span>

- <span data-ttu-id="5ad8b-122">MSMQ 3.0 と 4.0 では、有害メッセージの処理方法が異なります。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-122">MSMQ 3.0 and 4.0 handle poison messages differently.</span></span>

- <span data-ttu-id="5ad8b-123">MSMQ 4.0 のみが、リモート トランザクション読み取りをサポートします。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-123">Only MSMQ 4.0 supports remote transacted read.</span></span>

<span data-ttu-id="5ad8b-124">詳細については、「 [Windows Vista、Windows Server 2003、および WINDOWS XP のキュー機能の相違点](diff-in-queue-in-vista-server-2003-windows-xp.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-124">For more information, see [Differences in Queuing Features in Windows Vista, Windows Server 2003, and Windows XP](diff-in-queue-in-vista-server-2003-windows-xp.md).</span></span>

<span data-ttu-id="5ad8b-125">**Q:** キューに置かれた通信の片側で MSMQ 3.0 を使用し、もう一方の側で MSMQ 4.0 を使用できますか。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-125">**Q:** Can I use MSMQ 3.0 on one side of a queued communication and MSMQ 4.0 on the other side?</span></span>

<span data-ttu-id="5ad8b-126">**A:** はい。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-126">**A:** Yes.</span></span>

<span data-ttu-id="5ad8b-127">**Q:** 既存の MSMQ アプリケーションを新しい WCF クライアントまたはサーバーに統合します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-127">**Q:** I want to integrate existing MSMQ applications with new WCF clients or servers.</span></span> <span data-ttu-id="5ad8b-128">使用している MSMQ インフラストラクチャの両方の側をアップグレードする必要がありますか。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-128">Do I need to upgrade both sides of my MSMQ infrastructure?</span></span>

<span data-ttu-id="5ad8b-129">**A:** いいえ。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-129">**A:** No.</span></span> <span data-ttu-id="5ad8b-130">どちら側も MSMQ 4.0 にアップグレードする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-130">You do not have to upgrade to MSMQ 4.0 on either side.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="5ad8b-131">トラブルシューティング</span><span class="sxs-lookup"><span data-stu-id="5ad8b-131">Troubleshooting</span></span>

<span data-ttu-id="5ad8b-132">ここでは、一般的なトラブルシューティングの問題に対する解答を示します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-132">This section contains answers to most common troubleshooting issues.</span></span> <span data-ttu-id="5ad8b-133">既知の制限である一部の問題は、リリース ノートにも記載されています。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-133">Some issues that are known limitations are also described in the release notes.</span></span>

<span data-ttu-id="5ad8b-134">**Q:** プライベートキューを使用しようとしていますが、次の例外が発生しました: `System.InvalidOperationException` : URL が無効です。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-134">**Q:** I am trying to use a private queue and I get the following exception: `System.InvalidOperationException`: The URL is invalid.</span></span> <span data-ttu-id="5ad8b-135">キューの URL に '$' 文字を使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-135">The URL for the queue cannot contain the '$' character.</span></span> <span data-ttu-id="5ad8b-136">net.msmq://machine/private/queueName の構文を使用して、プライベート キューをアドレス指定してください。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-136">Use the syntax in net.msmq://machine/private/queueName to address a private queue.</span></span>

<span data-ttu-id="5ad8b-137">**A:** 構成とコードでキュー Uniform Resource Identifier (URI) を確認します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-137">**A:** Check the queue Uniform Resource Identifier (URI) in your configuration and code.</span></span> <span data-ttu-id="5ad8b-138">URI では、"$" 文字を使用できません。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-138">Do not use the "$" character in the URI.</span></span> <span data-ttu-id="5ad8b-139">たとえば、OrdersQueue という名前のプライベートキューをアドレス指定するには、URI としてを指定し `net.msmq://localhost/private/ordersQueue` ます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-139">For example, to address a private queue named OrdersQueue, specify the URI as `net.msmq://localhost/private/ordersQueue`.</span></span>

<span data-ttu-id="5ad8b-140">**Q:**`ServiceHost.Open()`キューに置かれたアプリケーションでを呼び出すと、次の例外がスローされます: `System.ArgumentException` : ベースアドレスに URI クエリ文字列を含めることはできません。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-140">**Q:** Calling `ServiceHost.Open()` on my queued application throws the following exception: `System.ArgumentException`: A base address cannot contain a URI query string.</span></span> <span data-ttu-id="5ad8b-141">なぜですか?</span><span class="sxs-lookup"><span data-stu-id="5ad8b-141">Why?</span></span>

<span data-ttu-id="5ad8b-142">**A:** 構成ファイルとコード内のキューの URI を確認します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-142">**A:** Check the queue URI in your configuration file and in your code.</span></span> <span data-ttu-id="5ad8b-143">MSMQ のキューでは '?' 文字の使用がサポートされていますが、URI はこれを文字列クエリの開始と解釈します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-143">While MSMQ queues support the use of the '?' character, URIs interpret this character as the beginning of a string query.</span></span> <span data-ttu-id="5ad8b-144">この問題を回避するには、'?' 文字を含まないキュー名を使用してください。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-144">To avoid this issue, use queue names that do not contain '?' characters.</span></span>

<span data-ttu-id="5ad8b-145">**Q:** 送信は成功しましたが、受信側でサービス操作が呼び出されていません。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-145">**Q:** My send succeeded but no service operation is invoked on the receiver.</span></span> <span data-ttu-id="5ad8b-146">なぜですか?</span><span class="sxs-lookup"><span data-stu-id="5ad8b-146">Why?</span></span>

<span data-ttu-id="5ad8b-147">**A:** 回答を確認するには、次のチェックリストを使用します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-147">**A:** To determine the answer, work through the following check list:</span></span>

- <span data-ttu-id="5ad8b-148">トランザクション キューの要件と指定済みの保証が適合することを確認します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-148">Check that the transactional queue requirements are compatible with the assurances specified.</span></span> <span data-ttu-id="5ad8b-149">次の原則に注意してください。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-149">Note the following principles:</span></span>

  - <span data-ttu-id="5ad8b-150">"厳密に1回" 保証 () を使用して <xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A>  =  `true` 、トランザクションキューにのみ永続的なメッセージ (データグラムとセッション) を送信できます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-150">You can send durable messages (datagrams and sessions) with "exactly once" assurances (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`) only to a transactional queue.</span></span>

  - <span data-ttu-id="5ad8b-151">"1 回限りの" 配信の保証付きのセッションのみを送信できます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-151">You can send sessions only with "exactly once" assurances.</span></span>

  - <span data-ttu-id="5ad8b-152">セッションでトランザクション キューからメッセージを受け取るには、1 つのトランザクションが必要です。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-152">A transaction is required to receive messages in a session from a transactional queue.</span></span>

  - <span data-ttu-id="5ad8b-153">保証なし () では <xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A>  =  `false` 、非トランザクションキューに対してのみ、揮発性または永続的なメッセージ (データグラムのみ) を送信または受信できます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-153">You can send or receive volatile or durable messages (datagrams only) with no assurances (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`) only to a non-transactional queue.</span></span>

- <span data-ttu-id="5ad8b-154">配信不能キューを確認します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-154">Check the dead-letter queue.</span></span> <span data-ttu-id="5ad8b-155">このキューにメッセージが置かれている場合は、メッセージが配信されなかった理由を特定してください。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-155">If you find the messages there, determine why they were not delivered.</span></span>

- <span data-ttu-id="5ad8b-156">送信キューを確認して、接続性またはアドレス指定の問題を特定します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-156">Check the outgoing queues for connectivity or addressing problems.</span></span>

<span data-ttu-id="5ad8b-157">**Q:** カスタム配信不能キューを指定しましたが、送信側アプリケーションを開始すると、配信不能キューが見つからないか、送信元アプリケーションに配信不能キューへのアクセス許可がないという例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-157">**Q:** I have specified a custom dead-letter queue, but when I start the sender application, I get an exception that either the dead-letter queue is not found, or the sending application has no permission to the dead-letter queue.</span></span> <span data-ttu-id="5ad8b-158">パフォーマンスが低下しているのはなぜですか。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-158">Why is this happening?</span></span>

<span data-ttu-id="5ad8b-159">**A:** カスタム配信不能キューの URI には、最初のセグメント (例://localhost/private/myAppdead-letter queue) に "localhost" またはコンピューター名が含まれている必要があります。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-159">**A:** The custom dead-letter queue URI must include a "localhost" or the computer name in the first segment, for example, net.msmq://localhost/private/myAppdead-letter queue.</span></span>

<span data-ttu-id="5ad8b-160">**Q:** カスタム配信不能キューを定義する必要があるか、既定の配信不能キューがあるか。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-160">**Q:** Is it always necessary to define a custom dead-letter queue, or is there a default dead-letter queue?</span></span>

<span data-ttu-id="5ad8b-161">**A:** 保証が "厳密に1回" ( <xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A>  =  `true` ) であり、カスタム配信不能キューを指定しない場合、既定値はシステム全体のトランザクション配信不能キューになります。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-161">**A:** If assurances are "exactly once" (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`), and if you do not specify a custom dead-letter queue, the default is a system-wide transactional dead-letter queue.</span></span>

<span data-ttu-id="5ad8b-162">保証が none () の場合 <xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A>  =  `false` 、既定値は配信不能キュー機能になりません。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-162">If assurances are none (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`), then the default is no dead-letter queue functionality.</span></span>

<span data-ttu-id="5ad8b-163">**Q:** サービスが Svchost.exe でスローします。 "EndpointListener の要件を ListenerFactory が満たすことができません" というメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-163">**Q:** My service throws on SvcHost.Open with a message "EndpointListener requirements cannot be met by the ListenerFactory".</span></span> <span data-ttu-id="5ad8b-164">なぜでしょうか。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-164">Why?</span></span>

<span data-ttu-id="5ad8b-165">A.</span><span class="sxs-lookup"><span data-stu-id="5ad8b-165">A.</span></span> <span data-ttu-id="5ad8b-166">サービス コントラクトを確認してください。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-166">Check your service contract.</span></span> <span data-ttu-id="5ad8b-167">すべてのサービス操作に "IsOneWay =" を配置し忘れた可能性があり `true` ます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-167">You may have forgotten to put "IsOneWay=`true`" on all the service operations.</span></span> <span data-ttu-id="5ad8b-168">キューは、一方向のサービス操作しかサポートしません。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-168">Queues support only one-way service operations.</span></span>

<span data-ttu-id="5ad8b-169">**Q:** キューにメッセージがありますが、サービス操作が呼び出されていません。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-169">**Q:** There are messages in the queue but no service operation is invoked.</span></span> <span data-ttu-id="5ad8b-170">問題は何ですか?</span><span class="sxs-lookup"><span data-stu-id="5ad8b-170">What is the problem?</span></span>

<span data-ttu-id="5ad8b-171">**A:** サービスホストに障害が発生していないかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-171">**A:** Determine if your service host is faulted.</span></span> <span data-ttu-id="5ad8b-172">確認するには、トレースを調べるか、`IErrorHandler` を実装します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-172">You can check by looking at the trace or implementing `IErrorHandler`.</span></span> <span data-ttu-id="5ad8b-173">既定では、有害メッセージが検出された場合、サービス ホストはエラーになります。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-173">Service host faults, by default, if a poison message is detected.</span></span>

<span data-ttu-id="5ad8b-174">**Q:** キューにメッセージがありますが、Web でホストされているキューに登録されたサービスがアクティブ化されていません。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-174">**Q:** There are messages in the queue but my Web-hosted queued service is not getting activated.</span></span> <span data-ttu-id="5ad8b-175">なぜですか?</span><span class="sxs-lookup"><span data-stu-id="5ad8b-175">Why?</span></span>

<span data-ttu-id="5ad8b-176">**A:** 最も一般的な理由はアクセス許可です。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-176">**A:** The most common reason is permissions.</span></span>

1. <span data-ttu-id="5ad8b-177">`NetMsmqActivator` プロセスが実行され、そのキューで、`NetMsmqActivator` の ID に読み取りおよびシーク アクセス許可が割り当てられていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-177">Ensure that the `NetMsmqActivator` process is running and the identity of the `NetMsmqActivator` process is given read and seek permission on the queue.</span></span>

2. <span data-ttu-id="5ad8b-178">`NetMsmqActivator` がリモート コンピューター上のキューを監視している場合は、`NetMsmqActivator` が制限付きトークンの下で実行されていないことを確認してください。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-178">If the `NetMsmqActivator` is monitoring queues on a remote machine, ensure that `NetMsmqActivator` does not run under a restricted token.</span></span> <span data-ttu-id="5ad8b-179">無制限のトークンを使用して `NetMsmqActivator` を実行するには、以下を実行します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-179">To run the `NetMsmqActivator` with an unrestricted token:</span></span>

    ```console
    sc sidtype NetMsmqActivator unrestricted
    ```

<span data-ttu-id="5ad8b-180">セキュリティに関連しない Web ホストの問題については、「キューに登録され [たアプリケーションを web でホスト](web-hosting-a-queued-application.md)する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-180">For non-security related Web host issues refer to: [Web Hosting a Queued Application](web-hosting-a-queued-application.md).</span></span>

<span data-ttu-id="5ad8b-181">**Q:** セッションにアクセスする最も簡単な方法は何ですか。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-181">**Q:** What is the easiest way to access sessions?</span></span>

<span data-ttu-id="5ad8b-182">**A:**`true`セッションの最後のメッセージに対応する操作で autocomplete = を設定し、 `false` 残りのすべてのサービス操作で autocomplete = を設定します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-182">**A:** Set AutoComplete=`true` on the operation that corresponds to the last message in the session, and set AutoComplete=`false` on all remaining service operations.</span></span>

<span data-ttu-id="5ad8b-183">**Q:** キュー `ProtocolException` に登録されたセッションメッセージとキューに置かれたデータグラムメッセージの両方を含むキューから読み取るときに、サービスがをスローするのはなぜですか。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-183">**Q:** Why does my service throw a `ProtocolException` when reading from a queue that contains both queued session messages and queued datagram messages?</span></span>

<span data-ttu-id="5ad8b-184">**A:** キューに登録されたセッションメッセージとキューに置かれたデータグラムメッセージの構成方法には、基本的な違いがあります。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-184">**A:** There is a fundamental difference in the way queued session messages and queued datagram messages are composed.</span></span> <span data-ttu-id="5ad8b-185">このため、キューを使用するセッション メッセージを読み取ろうとするサービスは、キューを使用するデータグラム メッセージを受信できず、キューを使用するデータグラム メッセージを読み取ろうとするサービスは、セッション メッセージを受信できません。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-185">Because of this, a service that is expecting to read a queued session message cannot receive a queued datagram message and a service expecting to read a queued datagram message cannot receive a session message.</span></span> <span data-ttu-id="5ad8b-186">これら両方の種類のメッセージを同じキューから読み取ろうとすると、次の例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-186">Attempting to read both types of messages from the same queue throws the following exception:</span></span>

```console
System.ServiceModel.MsmqPoisonMessageException: The transport channel detected a poison message. This occurred because the message exceeded the maximum number of delivery attempts or because the channel detected a fundamental problem with the message. The inner exception may contain additional information.
---> System.ServiceModel.ProtocolException: An incoming MSMQ message contained invalid or unexpected .NET Message Framing information in its body. The message cannot be received. Ensure that the sender is using a compatible service contract with a matching SessionMode.
```

<span data-ttu-id="5ad8b-187">アプリケーションが同じコンピューターからキューを使用するセッション メッセージとキューを使用するデータグラム メッセージの両方を送信する場合は、任意のカスタム配信不能キューだけでなくシステム配信不能キューで特にこの問題が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-187">The system dead-letter queue, as well as any custom dead-letter queue, is particularly susceptible to this issue if an application sends both queued session messages and queued datagram messages from the same computer.</span></span> <span data-ttu-id="5ad8b-188">メッセージを正常に送信できない場合、メッセージは配信不能キューに移されます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-188">If a message cannot be sent successfully, it is moved to the dead-letter queue.</span></span> <span data-ttu-id="5ad8b-189">このような場合は、セッション メッセージとデータグラム メッセージの両方が配信不能キューに置かれる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-189">Under these circumstances, it is possible to have both session and datagram messages in the dead-letter queue.</span></span> <span data-ttu-id="5ad8b-190">実行時にキューから読み取るときに両方の種類のメッセージを分離することはできません。そのため、アプリケーションでは、キューを使用するセッション メッセージとキューを使用するデータグラム メッセージの両方を同じコンピューターから送信しないでください。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-190">There is no way to separate both types of messages at runtime when reading from a queue, therefore, applications should not send both queued session messages and queued datagram messages from the same computer.</span></span>

### <a name="msmq-integration-specific-troubleshooting"></a><span data-ttu-id="5ad8b-191">MSMQ 統合 : 固有のトラブルシューティング</span><span class="sxs-lookup"><span data-stu-id="5ad8b-191">MSMQ Integration: Specific Troubleshooting</span></span>

<span data-ttu-id="5ad8b-192">**Q:** メッセージを送信したとき、またはサービスホストを開いたときに、スキームが間違っていることを示すエラーが表示されます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-192">**Q:** When I send a message, or when I open the service host, I get an error that indicates the scheme is wrong.</span></span> <span data-ttu-id="5ad8b-193">なぜですか?</span><span class="sxs-lookup"><span data-stu-id="5ad8b-193">Why?</span></span>

<span data-ttu-id="5ad8b-194">**A:** MSMQ 統合バインドを使用する場合は、msmq-mqseries スキームを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-194">**A:** When you use the MSMQ integration binding, you must use the msmq.formatname scheme.</span></span> <span data-ttu-id="5ad8b-195">たとえば、msmq.formatname:DIRECT=OS:.\private$\OrdersQueue などです。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-195">For example, msmq.formatname:DIRECT=OS:.\private$\OrdersQueue.</span></span> <span data-ttu-id="5ad8b-196">ただし、カスタム配信不能キューを指定するときは、net.msmq スキームを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-196">But when you specify the custom dead-letter queue, you must use the net.msmq scheme.</span></span>

<span data-ttu-id="5ad8b-197">**Q:** パブリックまたはプライベート形式名を使用して Windows Vista でサービスホストを開くと、エラーが表示されます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-197">**Q:** When I use a public or private format name and open the service host on Windows Vista, I get an error.</span></span> <span data-ttu-id="5ad8b-198">なぜですか?</span><span class="sxs-lookup"><span data-stu-id="5ad8b-198">Why?</span></span>

<span data-ttu-id="5ad8b-199">**A:** Windows Vista の WCF 統合チャネルは、有害なメッセージを処理するためにメインアプリケーションキューのサブキューを開くことができるかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-199">**A:** The WCF integration channel on Windows Vista checks to see if a subqueue can be opened for the main application queue for handling poison messages.</span></span> <span data-ttu-id="5ad8b-200">サブキュー名は、リスナーに渡された、formatname URI から派生します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-200">The subqueue name is derived from an msmq.formatname URI passed to the listener.</span></span> <span data-ttu-id="5ad8b-201">MSMQ のサブキュー名に使用できるのは、直接形式名のみです。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-201">The subqueue name in MSMQ can only be a direct format name.</span></span> <span data-ttu-id="5ad8b-202">そのためにエラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-202">So you see the error.</span></span> <span data-ttu-id="5ad8b-203">キュー URI を直接形式名に変更してください。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-203">Change the queue URI to a direct format name.</span></span>

<span data-ttu-id="5ad8b-204">**Q:** MSMQ アプリケーションからメッセージを受信すると、メッセージはキューに置かれ、受信側の WCF アプリケーションによって読み取られることはありません。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-204">**Q:** When receiving a message from an MSMQ application, the message sits in the queue and is not read by the receiving WCF application.</span></span> <span data-ttu-id="5ad8b-205">なぜですか?</span><span class="sxs-lookup"><span data-stu-id="5ad8b-205">Why?</span></span>

<span data-ttu-id="5ad8b-206">**A:** メッセージに本文があるかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-206">**A:** Check to see whether the message has a body.</span></span> <span data-ttu-id="5ad8b-207">メッセージに本文がない場合、MSMQ 統合チャネルはメッセージを無視します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-207">If the message has no body, the MSMQ integration channel ignores the message.</span></span> <span data-ttu-id="5ad8b-208">例外を通知する `IErrorHandler` を実装し、トレースを確認してください。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-208">Implement `IErrorHandler` to be notified of exceptions and check the traces.</span></span>

### <a name="security-related-troubleshooting"></a><span data-ttu-id="5ad8b-209">セキュリティ関連のトラブルシューティング</span><span class="sxs-lookup"><span data-stu-id="5ad8b-209">Security-Related Troubleshooting</span></span>

<span data-ttu-id="5ad8b-210">**Q:** ワークグループモードで既定のバインドを使用するサンプルを実行すると、メッセージは送信されたように見えますが、受信側で受信されることはありません。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-210">**Q:** When I run the sample that uses a default binding in workgroup mode, messages seem to get sent but are never received by the receiver.</span></span>

<span data-ttu-id="5ad8b-211">**A:** 既定では、メッセージは、Active Directory Directory サービスを必要とする MSMQ 内部証明書を使用して署名されます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-211">**A:** By default, messages are signed using an MSMQ internal certificate that requires the Active Directory directory service.</span></span> <span data-ttu-id="5ad8b-212">ワークグループ モードでは、Active Directory が使用できないため、メッセージに署名できません。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-212">In workgroup mode, because Active Directory is not available, signing the message fails.</span></span> <span data-ttu-id="5ad8b-213">このため、メッセージは配信不能キューにあり、"署名が正しくありません" などのエラーの原因が示されます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-213">So the message lands in the dead-letter queue and failure cause, such as "Bad signature", is indicated.</span></span>

<span data-ttu-id="5ad8b-214">この問題を回避するには、セキュリティを無効にします。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-214">The workaround is to turn off security.</span></span> <span data-ttu-id="5ad8b-215">これを行うには <xref:System.ServiceModel.NetMsmqSecurity.Mode%2A>  =  <xref:System.ServiceModel.NetMsmqSecurityMode.None> 、ワークグループモードで動作するようにを設定します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-215">This is done by setting <xref:System.ServiceModel.NetMsmqSecurity.Mode%2A> = <xref:System.ServiceModel.NetMsmqSecurityMode.None> to make it work in workgroup mode.</span></span>

<span data-ttu-id="5ad8b-216">また、<xref:System.ServiceModel.MsmqTransportSecurity> プロパティから <xref:System.ServiceModel.NetMsmqSecurity.Transport%2A> を取得し、それを <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate> に設定して、クライアント証明書を設定する方法もあります。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-216">Another workaround is to get the <xref:System.ServiceModel.MsmqTransportSecurity> from the <xref:System.ServiceModel.NetMsmqSecurity.Transport%2A> property and set it to <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate>, and set the client certificate.</span></span>

<span data-ttu-id="5ad8b-217">さらに、MSMQ と Active Directory 統合をインストールして回避することもできます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-217">Yet another workaround is to install MSMQ with Active Directory integration.</span></span>

<span data-ttu-id="5ad8b-218">**Q:** Active Directory で既定のバインド (トランスポートセキュリティが有効) を使用してメッセージをキューに送信すると、"内部証明書が見つかりません" というメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-218">**Q:** When I send a message with default binding (transport security turned on) in Active Directory to a queue, I get an "internal certificate not found" message.</span></span> <span data-ttu-id="5ad8b-219">これをどのように修正すればよいですか?</span><span class="sxs-lookup"><span data-stu-id="5ad8b-219">How do I fix this?</span></span>

<span data-ttu-id="5ad8b-220">**A:** これは、送信側の Active Directory の証明書を更新する必要があることを意味します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-220">**A:** This means that the certificate in Active Directory for the sender must be renewed.</span></span> <span data-ttu-id="5ad8b-221">これを行うには、[ **コントロールパネル**]、[ **管理ツール**]、[ **コンピューターの管理**] の順に開き、[ **MSMQ**] を右クリックして、[ **プロパティ**] を選択します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-221">To do so, open **Control Panel**, **Administrative Tools**, **Computer Management**, right-click **MSMQ**, and select **Properties**.</span></span> <span data-ttu-id="5ad8b-222">[ **ユーザー証明書** ] タブを選択し、[ **更新** ] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-222">Select the **User Certificate** tab and click the **Renew** button.</span></span>

<span data-ttu-id="5ad8b-223">**Q:** を使用してメッセージを送信 <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate> し、使用する証明書を指定すると、"証明書が無効です" というメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-223">**Q:** When I send a message using <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate> and specify the certificate to use, I get an "Invalid certificate" message.</span></span> <span data-ttu-id="5ad8b-224">これをどのように修正すればよいですか?</span><span class="sxs-lookup"><span data-stu-id="5ad8b-224">How do I fix this?</span></span>

<span data-ttu-id="5ad8b-225">**A:** 証明書モードでローカルコンピューターの証明書ストアを使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-225">**A:** You cannot use a local machine certificate store with certificate mode.</span></span> <span data-ttu-id="5ad8b-226">証明書スナップインを使用して、コンピューターの証明書ストアから現在のユーザー ストアに証明書をコピーする必要があります。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-226">You have to copy the certificate from the machine certificate store to the current user store using the Certificate snap-in.</span></span> <span data-ttu-id="5ad8b-227">証明書スナップインを開くには、以下を実行します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-227">To get the Certificate snap-in:</span></span>

1. <span data-ttu-id="5ad8b-228">[ **スタート**] をクリックし、[ **実行**] を選択して「」と入力し、 `mmc` [ **OK]** をクリックします</span><span class="sxs-lookup"><span data-stu-id="5ad8b-228">Click **Start**, select **Run**, type `mmc`, and click **OK**.</span></span>

2. <span data-ttu-id="5ad8b-229">**Microsoft 管理コンソール** で、[**ファイル**] メニューを開き、[**スナップインの追加と削除**] を選択します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-229">In the **Microsoft Management Console**, open the **File** menu and select **Add/Remove Snap-in**.</span></span>

3. <span data-ttu-id="5ad8b-230">[スナップインの **追加と削除** ] ダイアログボックスで、[ **追加** ] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-230">In the **Add/Remove Snap-in** dialog box, click the **Add** button.</span></span>

4. <span data-ttu-id="5ad8b-231">[ **スタンドアロンスナップ** インの追加] ダイアログボックスで、[証明書] を選択し、[ **追加**] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-231">In the **Add Standalone Snap-in** dialog box, select Certificates and click **Add**.</span></span>

5. <span data-ttu-id="5ad8b-232">[ **証明書** スナップイン] ダイアログボックスで、[ **ユーザーアカウント** ] を選択し、[ **完了**] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-232">In the **Certificates** snap-in dialog box, select **My user account,** and click **Finish**.</span></span>

6. <span data-ttu-id="5ad8b-233">次に、前の手順を使用して2番目の証明書スナップインを追加しますが、今度は [ **コンピューターアカウント** ] を選択し、[ **次へ**] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-233">Next, add a second Certificates snap-in using the previous steps, but this time select **Computer account** and click **Next**.</span></span>

7. <span data-ttu-id="5ad8b-234">**[ローカル コンピューター]** を選択して **[完了]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-234">Select **Local Computer** and click **Finish**.</span></span> <span data-ttu-id="5ad8b-235">これで、コンピューターの証明書ストアから現在のユーザー ストアに証明書をドラッグ アンド ドロップできます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-235">You can now drag and drop certificates from the machine certificate store to the current user store.</span></span>

<span data-ttu-id="5ad8b-236">**Q:** サービスがワークグループモードの別のコンピューターのキューから読み取りを行うと、"アクセスが拒否されました" という例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-236">**Q:** When my service reads from a queue on another computer in workgroup mode, I get an "access denied" exception.</span></span>

<span data-ttu-id="5ad8b-237">**A:** ワークグループモードでは、リモートアプリケーションがキューにアクセスできるようにするには、そのキューにアクセスする権限が必要です。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-237">**A:** In workgroup mode, for a remote application to gain access to the queue, the application must have permission to access the queue.</span></span> <span data-ttu-id="5ad8b-238">キューのアクセス制御リスト (ACL) に "Anonymous login" を追加し、読み取りアクセス許可を付与します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-238">Add "Anonymous login" to the queue's access control list (ACL) and give it read permission.</span></span>

<span data-ttu-id="5ad8b-239">**Q:** ネットワークサービスクライアント (またはドメインアカウントを持たないクライアント) がキューに置かれたメッセージを送信する場合、送信は無効な証明書で失敗します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-239">**Q:** When a network service client (or any client that does not have a domain account) sends a queued message, the send fails with an invalid certificate.</span></span> <span data-ttu-id="5ad8b-240">これをどのように修正すればよいですか?</span><span class="sxs-lookup"><span data-stu-id="5ad8b-240">How do I fix this?</span></span>

<span data-ttu-id="5ad8b-241">**A:** バインドの構成を確認します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-241">**A:** Check the binding configuration.</span></span> <span data-ttu-id="5ad8b-242">既定のバインディングでは、メッセージに署名するために MSMQ トランスポート セキュリティを有効にしています。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-242">The default binding has MSMQ transport security turned on to sign the message.</span></span> <span data-ttu-id="5ad8b-243">これを無効にしてください。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-243">Turn it off.</span></span>

### <a name="remote-transacted-receives"></a><span data-ttu-id="5ad8b-244">リモート トランザクション受信</span><span class="sxs-lookup"><span data-stu-id="5ad8b-244">Remote Transacted Receives</span></span>

<span data-ttu-id="5ad8b-245">**Q:** コンピューター A にキューがあり、コンピューター B のキューからメッセージを読み取る WCF サービス (リモートトランザクション受信シナリオ) がある場合、メッセージはキューから読み取られません。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-245">**Q:** When I have a queue on machine A, and a WCF service that reads messages from a queue on machine B (the remote transacted receive scenario), messages are not read from the queue.</span></span> <span data-ttu-id="5ad8b-246">トレース情報は、"トランザクションをインポートできません" というメッセージで受信が失敗したことを示します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-246">Tracing information indicates the receive failed with the message "Transaction cannot be imported."</span></span> <span data-ttu-id="5ad8b-247">修正するにはどうすればよいですか。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-247">What can I do to fix this?</span></span>

<span data-ttu-id="5ad8b-248">**A:** これには、次の3つの原因が考えられます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-248">**A:** There are three possible reasons for this:</span></span>

- <span data-ttu-id="5ad8b-249">ドメイン モードの場合、リモート トランザクション受信には、Microsoft 分散トランザクション コーディネーター (MSDTC) ネットワーク アクセスが必要です。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-249">If you are in domain mode, remote transacted receive requires Microsoft Distributed Transaction Coordinator (MSDTC) network access.</span></span> <span data-ttu-id="5ad8b-250">これは、[ **コンポーネントの追加と削除**] を使用して有効にすることができます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-250">You can enable this using **Add/Remove Components**.</span></span>

  ![ネットワーク DTC アクセスの有効化を示すスクリーンショット。](./media/troubleshooting-queued-messaging/enable-distributed-transaction-coordinator-access.jpg)

- <span data-ttu-id="5ad8b-252">トランザクション マネージャーと通信するための認証モードを確認します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-252">Check the authentication mode for communicating with the transaction manager.</span></span> <span data-ttu-id="5ad8b-253">ワークグループモードの場合は、[認証は必要ありません] を選択する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-253">If you are in workgroup mode, "No Authentication Required" must be selected.</span></span> <span data-ttu-id="5ad8b-254">ドメインモードの場合は、[相互認証が必要] を選択する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-254">If you are in domain mode, then "Mutual Authentication Required" must be selected.</span></span>

  <span data-ttu-id="5ad8b-255">![XA トランザクションの有効化](media/4f3695e0-fb0b-4c5b-afac-75f8860d2bb0.jpg "4f3695e0-fb0b-4c5b-afac-75f8860d2bb0")</span><span class="sxs-lookup"><span data-stu-id="5ad8b-255">![Enabling XA transactions](media/4f3695e0-fb0b-4c5b-afac-75f8860d2bb0.jpg "4f3695e0-fb0b-4c5b-afac-75f8860d2bb0")</span></span>

- <span data-ttu-id="5ad8b-256">[ **インターネット接続ファイアウォール** ] 設定で、MSDTC が例外の一覧に含まれていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-256">Make sure that MSDTC is in the list of exceptions in the **Internet Connection Firewall** settings.</span></span>

- <span data-ttu-id="5ad8b-257">Windows Vista を使用していることを確認します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-257">Ensure that you are using Windows Vista.</span></span> <span data-ttu-id="5ad8b-258">Windows Vista の MSMQ は、リモートトランザクション読み取りをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-258">MSMQ on Windows Vista supports remote transacted read.</span></span> <span data-ttu-id="5ad8b-259">以前の Windows リリース上の MSMQ は、リモート トランザクション読み取りをサポートしません。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-259">MSMQ on earlier Windows releases does not support remote transacted read.</span></span>

<span data-ttu-id="5ad8b-260">**Q:** キューから読み取るサービスがネットワークサービス (たとえば、Web ホスト) である場合、キューからの読み取り時にアクセス拒否例外が発生するのはなぜですか。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-260">**Q:** When the service reading from the queue is a network service, for example, in a Web host, why do I get an access-denied exception is raised when reading from the queue?</span></span>

<span data-ttu-id="5ad8b-261">**A:** ネットワークサービスがキューから読み取ることができるようにするには、ネットワークサービスの読み取りアクセスをキュー ACL に追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-261">**A:** Network service read access must be added to the queue ACL to ensure that a network service can read from the queue.</span></span>

<span data-ttu-id="5ad8b-262">**Q:** MSMQ アクティブ化サービスを使用して、リモートコンピューター上のキュー内のメッセージに基づいてアプリケーションをアクティブ化することはできますか。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-262">**Q:** Can I use the MSMQ activation service to activate applications based on messages in a queue on a remote machine?</span></span>

<span data-ttu-id="5ad8b-263">**A:** はい。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-263">**A:** Yes.</span></span> <span data-ttu-id="5ad8b-264">これには、ネットワーク サービスとして動作するように MSMQ アクティベーション サービスを構成し、リモート コンピューター上のキューへのネットワーク サービス アクセスを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-264">To do this, you must configure the MSMQ activation service to run as a network service, and add network service access to the queue on the remote machine.</span></span>

## <a name="using-custom-msmq-bindings-with-receivecontext-enabled"></a><span data-ttu-id="5ad8b-265">ReceiveContext を有効にしたカスタム MSMQ バインディングの使用</span><span class="sxs-lookup"><span data-stu-id="5ad8b-265">Using Custom MSMQ Bindings with ReceiveContext Enabled</span></span>

<span data-ttu-id="5ad8b-266">が有効なカスタム MSMQ バインディングを使用する場合 <xref:System.ServiceModel.Channels.ReceiveContext> 、ネイティブ MSMQ では非同期受信の i/o 完了がサポートされないため、受信メッセージの処理でスレッドプールスレッドが使用さ <xref:System.ServiceModel.Channels.ReceiveContext> れます。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-266">When using a custom MSMQ binding with <xref:System.ServiceModel.Channels.ReceiveContext> enabled, processing an incoming message uses a thread pool thread because native MSMQ doesn't support I/O completion for asynchronous <xref:System.ServiceModel.Channels.ReceiveContext> receives.</span></span> <span data-ttu-id="5ad8b-267">これは、このようなメッセージの処理では内部トランザクションが使用され、 <xref:System.ServiceModel.Channels.ReceiveContext> MSMQ は非同期処理をサポートしないためです。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-267">This is because processing such a message uses internal transactions for <xref:System.ServiceModel.Channels.ReceiveContext> and MSMQ doesn't support asynchronous processing.</span></span> <span data-ttu-id="5ad8b-268">この問題を回避するには、を <xref:System.ServiceModel.Description.SynchronousReceiveBehavior> エンドポイントに追加して、同期処理を強制的に実行するか、 <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.MaxPendingReceives%2A> を1に設定します。</span><span class="sxs-lookup"><span data-stu-id="5ad8b-268">To work around this issue, you can add a <xref:System.ServiceModel.Description.SynchronousReceiveBehavior> to the endpoint to force synchronous processing or set <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.MaxPendingReceives%2A> to 1.</span></span>
