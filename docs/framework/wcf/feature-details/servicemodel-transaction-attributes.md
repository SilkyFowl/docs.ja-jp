---
description: '詳細情報: ServiceModel トランザクション属性'
title: ServiceModel トランザクションの属性
ms.date: 03/30/2017
helpviewer_keywords:
- transactions [WCF], ServiceModel attributes
ms.assetid: 1e0d2436-6ae5-439b-9765-a448d6f60000
ms.openlocfilehash: 0b443fc6b9503007574608afe03c5e0508f666d9
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99793481"
---
# <a name="servicemodel-transaction-attributes"></a><span data-ttu-id="2d5b1-103">ServiceModel トランザクションの属性</span><span class="sxs-lookup"><span data-stu-id="2d5b1-103">ServiceModel Transaction Attributes</span></span>

<span data-ttu-id="2d5b1-104">Windows Communication Foundation (WCF) には、 <xref:System.ServiceModel> wcf サービスのトランザクションの動作を構成するための3つの標準属性のプロパティが用意されています。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-104">Windows Communication Foundation (WCF) provides properties on three standard <xref:System.ServiceModel> attributes that enable you to configure the behavior of transactions for a WCF service:</span></span>

- <xref:System.ServiceModel.TransactionFlowAttribute>

- <xref:System.ServiceModel.ServiceBehaviorAttribute>

- <xref:System.ServiceModel.OperationBehaviorAttribute>

## <a name="transactionflowattribute"></a><span data-ttu-id="2d5b1-105">TransactionFlowAttribute</span><span class="sxs-lookup"><span data-stu-id="2d5b1-105">TransactionFlowAttribute</span></span>

<span data-ttu-id="2d5b1-106"><xref:System.ServiceModel.TransactionFlowAttribute> 属性は、クライアントから受信トランザクションを受け入れるときのサービス コントラクトにおける操作の受け入れやすさを指定します。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-106">The <xref:System.ServiceModel.TransactionFlowAttribute> attribute specifies the willingness of an operation in a service contract to accept incoming transactions from a client.</span></span> <span data-ttu-id="2d5b1-107">この属性は、次のプロパティを使用してこの制御を行います。トランザクションは、<xref:System.ServiceModel.TransactionFlowOption> 列挙型を使用して、受信トランザクションが <xref:System.ServiceModel.TransactionFlowOption.Mandatory>、<xref:System.ServiceModel.TransactionFlowOption.Allowed>、<xref:System.ServiceModel.TransactionFlowOption.NotAllowed> のいずれであるかを指定します。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-107">The attribute provides this control with the following property: Transactions use the <xref:System.ServiceModel.TransactionFlowOption> enumeration to specify whether an incoming transaction is <xref:System.ServiceModel.TransactionFlowOption.Mandatory>, <xref:System.ServiceModel.TransactionFlowOption.Allowed>, or <xref:System.ServiceModel.TransactionFlowOption.NotAllowed>.</span></span>

<span data-ttu-id="2d5b1-108">これは、サービス操作をクライアントの外部とのやり取りに関連付ける唯一の属性です。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-108">This is the only attribute that relates service operations to external interactions with a client.</span></span> <span data-ttu-id="2d5b1-109">次のセクションで説明する属性は、操作の実行内部におけるトランザクションの使用と関連しています。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-109">The attributes described in the following sections relate to the use of transactions within the execution of the operation.</span></span>

## <a name="servicebehaviorattribute"></a><span data-ttu-id="2d5b1-110">ServiceBehaviorAttribute</span><span class="sxs-lookup"><span data-stu-id="2d5b1-110">ServiceBehaviorAttribute</span></span>

<span data-ttu-id="2d5b1-111"><xref:System.ServiceModel.ServiceBehaviorAttribute> 属性は、サービス コントラクト実装の内部実行動作を指定します。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-111">The <xref:System.ServiceModel.ServiceBehaviorAttribute> attribute specifies the internal execution behavior of a service contract implementation.</span></span> <span data-ttu-id="2d5b1-112">この属性のトランザクション固有のプロパティは次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-112">Transaction-specific properties of this attribute include:</span></span>

- <span data-ttu-id="2d5b1-113"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionAutoCompleteOnSessionClose%2A> は、セッションの終了時に、未完了のトランザクションを完了させるかどうかを指定します。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-113"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionAutoCompleteOnSessionClose%2A> specifies whether to complete an uncompleted transaction when the session closes.</span></span> <span data-ttu-id="2d5b1-114">このプロパティの既定値は `false` です。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-114">The default value for this property is `false`.</span></span> <span data-ttu-id="2d5b1-115">このプロパティが `true` で、ネットワークまたはクライアントの障害が原因で、入力セッションが終了せずにシャットダウンした場合は、すべての未完了のトランザクションが正常に完了します。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-115">If this property is `true`, and the incoming session was gracefully shut down instead of closing due to network or client faults, any uncompleted transaction is successfully completed.</span></span> <span data-ttu-id="2d5b1-116">このプロパティが `false` の場合、またはセッションが正常に終了しなかった場合は、セッションの終了時にすべての未完了のトランザクションがロールバックされます。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-116">Otherwise, if this property is `false` or if the session was not gracefully closed, any uncompleted transaction is rolled back when the session closes.</span></span> <span data-ttu-id="2d5b1-117">このプロパティを `true` に設定する場合、受信チャネルはセッション ベースである必要があります。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-117">If this property is `true`, the incoming channel must be session-based.</span></span>

- <span data-ttu-id="2d5b1-118"><xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A> は、トランザクションが完了したときに基になるサービス インスタンスを解放するかどうかを指定します。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-118"><xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A> specifies whether the underlying service instance is released when a transaction completes.</span></span> <span data-ttu-id="2d5b1-119">このプロパティの既定値は `true` です。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-119">The default value for this property is `true`.</span></span> <span data-ttu-id="2d5b1-120">次の受信メッセージによって、基になる新しいインスタンスが作成されると、以前のインスタンスが保持していたトランザクションごとの状態は破棄されます。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-120">The next inbound message causes a new underlying instance to be created, discarding any per-transaction state that the previous instance might have held.</span></span> <span data-ttu-id="2d5b1-121">サービス インスタンスの解放はサービスが実行する内部動作であるため、クライアントが確立した既存の接続またはセッションに影響を及ぼすことはありません。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-121">Releasing a service instance is an internal action the service takes and has no impact on any existing connections or sessions that clients might have established.</span></span> <span data-ttu-id="2d5b1-122">この機能は、COM+ に用意された Just-In-Time アクティベーション機能に相当します。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-122">This functionality is equivalent to the just-in-time activation feature COM+ provides.</span></span> <span data-ttu-id="2d5b1-123">このプロパティが `true` の場合は、<xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A> と <xref:System.ServiceModel.ConcurrencyMode.Single> を一致させる必要があります。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-123">If the property is `true`, <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A> must be equal to <xref:System.ServiceModel.ConcurrencyMode.Single>.</span></span> <span data-ttu-id="2d5b1-124">そうでない場合、サービスの起動中に無効な構成の検証例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-124">Otherwise, the service throws an invalid configuration validation exception during startup.</span></span>

- <span data-ttu-id="2d5b1-125"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionIsolationLevel%2A> は、サービスのトランザクションで使用する分離レベルを指定します。このプロパティは、<xref:System.Transactions.IsolationLevel> の値のいずれかに設定されます。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-125"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionIsolationLevel%2A> specifies the isolation level to use for transactions within the service; this property takes one of the <xref:System.Transactions.IsolationLevel> values.</span></span> <span data-ttu-id="2d5b1-126">ローカルの分離レベル プロパティが、<xref:System.Transactions.IsolationLevel.Unspecified> 以外に設定されている場合は、受信トランザクションの分離レベルをこのローカルのプロパティの設定に一致させる必要があります。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-126">If the local isolation level property is anything other than <xref:System.Transactions.IsolationLevel.Unspecified>, the isolation level of an incoming transaction must match the setting of this local property.</span></span> <span data-ttu-id="2d5b1-127">そうでない場合、受信トランザクションは拒否され、クライアントにエラーが返されます。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-127">Otherwise, the incoming transaction is rejected, and a fault is sent back to the client.</span></span> <span data-ttu-id="2d5b1-128"><xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> が `true` であり、トランザクションがフローしていない場合、このプロパティによって、ローカルで作成されるトランザクションに使用する <xref:System.Transactions.IsolationLevel> の値が決まります。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-128">If <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> is `true`, and no transaction is flowed, this property determines the <xref:System.Transactions.IsolationLevel> value to use for the locally created transaction.</span></span> <span data-ttu-id="2d5b1-129"><xref:System.Transactions.IsolationLevel> が <xref:System.Transactions.IsolationLevel.Unspecified> に設定されている場合は、<xref:System.Transactions.IsolationLevel><xref:System.Transactions.IsolationLevel.Serializable> が使用されます。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-129">If <xref:System.Transactions.IsolationLevel> is set to <xref:System.Transactions.IsolationLevel.Unspecified>, <xref:System.Transactions.IsolationLevel><xref:System.Transactions.IsolationLevel.Serializable> is used.</span></span>

- <span data-ttu-id="2d5b1-130"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A> は、サービスで作成された新しいトランザクションを完了させる期間を指定します。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-130"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A> specifies the time period within which a new transaction created at the service must complete.</span></span> <span data-ttu-id="2d5b1-131">この期間が過ぎてもトランザクションが完了しない場合は、トランザクションは中止されます。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-131">If this time is reached and the transaction has not been completed, it will abort.</span></span> <span data-ttu-id="2d5b1-132"><xref:System.TimeSpan> は、<xref:System.Transactions.TransactionScope> が <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> に設定された任意の操作、および新しいトランザクションが作成された任意の操作の `true` タイムアウトとして使用されます。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-132">The <xref:System.TimeSpan> is used as the <xref:System.Transactions.TransactionScope> time-out for any operations that have <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> set to `true` and for which a new transaction was created.</span></span> <span data-ttu-id="2d5b1-133">このタイムアウトは、2 フェーズ コミット プロトコルにおいて、トランザクションが作成されてからフェーズ 1 が完了するまでの最大許容時間です。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-133">The time-out is the maximum allowed duration from the creation of the transaction to the completion of phase 1 in the two-phase commit protocol.</span></span> <span data-ttu-id="2d5b1-134">使用されるタイムアウト値は、<xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A> プロパティと `transactionTimeout` 構成設定のうち、常に小さい方の値になります。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-134">The time-out value used is always the lower value between the <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A> property and the `transactionTimeout` configuration setting.</span></span>

## <a name="operationbehaviorattribute"></a><span data-ttu-id="2d5b1-135">OperationBehaviorAttribute</span><span class="sxs-lookup"><span data-stu-id="2d5b1-135">OperationBehaviorAttribute</span></span>

<span data-ttu-id="2d5b1-136"><xref:System.ServiceModel.OperationBehaviorAttribute> 属性は、サービス実装におけるメソッドの動作を指定します。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-136">The <xref:System.ServiceModel.OperationBehaviorAttribute> attribute specifies the behaviors of the methods in the service implementation.</span></span> <span data-ttu-id="2d5b1-137">この属性を使用して、操作の特定の実行動作を示すことができます。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-137">You can use it to indicate the operation's specific execution behavior.</span></span> <span data-ttu-id="2d5b1-138">この属性のプロパティは、サービスコントラクトの Web サービス記述言語 (WSDL) の説明には影響しません。また、開発者がそれ自体を実装する必要のある共通機能を有効にする WCF プログラミングモデルの純粋な要素です。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-138">Properties of this attribute do not affect the Web Service Description Language (WSDL) description of the service contract, and are purely elements of the WCF programming model that enable common features that developers otherwise have to implement themselves.</span></span>

<span data-ttu-id="2d5b1-139">この属性には、次のようなトランザクション固有のプロパティがあります。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-139">This attribute has the following transaction-specific properties:</span></span>

- <span data-ttu-id="2d5b1-140"><xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> は、メソッドをアクティブなトランザクション スコープ内で実行する必要があるかどうかを指定します。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-140"><xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> specifies whether a method must execute within an active transaction scope.</span></span> <span data-ttu-id="2d5b1-141">既定値は、`false` です。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-141">The default is `false`.</span></span> <span data-ttu-id="2d5b1-142"><xref:System.ServiceModel.OperationBehaviorAttribute> 属性がメソッドに対して設定されていない場合は、そのメソッドがトランザクション内で実行されないことを意味します。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-142">If the <xref:System.ServiceModel.OperationBehaviorAttribute> attribute is not set for a method, it also implies that the method will not execute in a transaction.</span></span> <span data-ttu-id="2d5b1-143">操作のトランザクション スコープが要求されない場合、メッセージ ヘッダーにあるトランザクションはアクティブ化されず、<xref:System.ServiceModel.OperationContext.IncomingMessageProperties%2A> の <xref:System.ServiceModel.OperationContext> の要素として残ります。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-143">If a transaction scope is not required for an operation, any transaction that is present within the message header is not activated and remains as an element of the <xref:System.ServiceModel.OperationContext.IncomingMessageProperties%2A> of the <xref:System.ServiceModel.OperationContext>.</span></span> <span data-ttu-id="2d5b1-144">操作のトランザクション スコープが必要な場合は、トランザクションのソースは次のいずれかから派生します。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-144">If a transaction scope is required for an operation, the source for the transaction is derived from one of the following:</span></span>

  - <span data-ttu-id="2d5b1-145">トランザクションがクライアントからフローされた場合、その分散トランザクションを使用して作成されたトランザクション スコープの下でメソッドが実行されます。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-145">If a transaction is flowed from the client, the method is executed under a transaction scope created using that distributed transaction.</span></span>

  - <span data-ttu-id="2d5b1-146">キューに置かれたトランスポートでは、メッセージをキューから削除するトランザクションが使用されます。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-146">With a queued transport, the transaction used to dequeue the message is used.</span></span> <span data-ttu-id="2d5b1-147">使用されるトランザクションはフローされたトランザクションではなく、したがってメッセージの送信元によって提供されたものではないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-147">Note that the transaction used is not a flowed transaction, in that it was not provided by the original sender of the message.</span></span>

  - <span data-ttu-id="2d5b1-148">カスタム トランスポートは、`TransportTransactionProperty` を使用することによってトランザクションを提供できます。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-148">A custom transport can provide a transaction through the use of the `TransportTransactionProperty`.</span></span>

  - <span data-ttu-id="2d5b1-149">上記のいずれもがトランザクションの外部ソースを提供しない場合は、メソッドの呼び出しの直前に新規の <xref:System.Transactions.Transaction> インスタンスが作成されます。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-149">If none of the above provides an external source for a transaction, a new <xref:System.Transactions.Transaction> instance is created immediately prior to calling the method.</span></span>

- <span data-ttu-id="2d5b1-150"><xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A> は、未処理の例外がスローされなかった場合に、メソッドが実行されているトランザクションが自動的に完了されるかどうかを指定します。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-150"><xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A> specifies whether the transaction in which the method executes is automatically completed if no unhandled exceptions are thrown.</span></span> <span data-ttu-id="2d5b1-151">このプロパティが `true` の場合は、ユーザー メソッドが例外をスローせずに復帰したときに、呼び出し側のインフラストラクチャが自動的にそのトランザクションを "完了" としてマークします。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-151">If this property is `true`, the calling infrastructure automatically marks the transaction as "completed" if the user method returns without throwing an exception.</span></span> <span data-ttu-id="2d5b1-152">このプロパティが `false` の場合、トランザクションはインスタンスにアタッチされ、このプロパティが `true` とマークされた後続のメソッドがクライアントによって呼び出されるか、または後続のメソッドから <xref:System.ServiceModel.OperationContext.SetTransactionComplete%2A> が明示的に呼び出された場合にのみ、"完了" とマークされます。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-152">If this property is `false`, the transaction is attached to the instance, and is only marked as "completed" if the client calls a subsequent method that is marked with this property equal to `true`, or if a subsequent method explicitly calls <xref:System.ServiceModel.OperationContext.SetTransactionComplete%2A>.</span></span> <span data-ttu-id="2d5b1-153"><xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionAutoCompleteOnSessionClose%2A> プロパティを `true` に設定しない限り、これらのどちらの実行に失敗しても、トランザクションは "完了" にならなくなり、格納されている作業はコミットされません。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-153">Failure to perform either of these results in the transaction never being "completed," and the contained work is not committed, unless the <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionAutoCompleteOnSessionClose%2A> property is set to `true`.</span></span> <span data-ttu-id="2d5b1-154">このプロパティが `true` に設定されている場合、セッションのあるチャネルを使用し、<xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> を <xref:System.ServiceModel.InstanceContextMode.PerSession> に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2d5b1-154">If this property is set to `true`, you must use a channel with a session, and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> must be set to <xref:System.ServiceModel.InstanceContextMode.PerSession>.</span></span>
