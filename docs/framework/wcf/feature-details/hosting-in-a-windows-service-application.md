---
description: 詳細については、「Windows サービスアプリケーションでのホスト」を参照してください。
title: Windows サービス アプリケーションのホスト
ms.date: 03/30/2017
ms.assetid: f4199998-27f3-4dd9-aee4-0a4addfa9f24
ms.openlocfilehash: 702fe95b14b9bce3ffaa774e17a9fc1293717e66
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99743123"
---
# <a name="hosting-in-a-windows-service-application"></a><span data-ttu-id="a0e77-103">Windows サービス アプリケーションのホスト</span><span class="sxs-lookup"><span data-stu-id="a0e77-103">Hosting in a Windows Service Application</span></span>

<span data-ttu-id="a0e77-104">Windows サービス (従来 Windows NT サービスと呼ばれていたもの) が提供するプロセス モデルが特に適しているのは、長い期間にわたって動作し続ける必要があり、どのような形式でもユーザー インターフェイスを表示することのないアプリケーションです。</span><span class="sxs-lookup"><span data-stu-id="a0e77-104">Windows services (formerly known as Windows NT services) provide a process model particularly suited to applications that must live in a long-running executable and do not display any form of user interface.</span></span> <span data-ttu-id="a0e77-105">Windows サービス アプリケーションのプロセスの有効期間を管理するのは、サービス コントロール マネージャー (SCM) です。SCM を使用して、Windows サービス アプリケーションを起動、停止、および一時停止できます。</span><span class="sxs-lookup"><span data-stu-id="a0e77-105">The process lifetime of a Windows service application is managed by the service control manager (SCM), which allows you to start, stop, and pause Windows service applications.</span></span> <span data-ttu-id="a0e77-106">コンピューターの起動時に自動的に開始するように Windows サービスプロセスを構成し、"always on" アプリケーション用の適切なホスティング環境にすることができます。</span><span class="sxs-lookup"><span data-stu-id="a0e77-106">You can configure a Windows service process to start automatically when the computer starts, making it a suitable hosting environment for "always on" applications.</span></span> <span data-ttu-id="a0e77-107">Windows サービスアプリケーションの詳細については、「 [Windows サービスアプリケーション](https://go.microsoft.com/fwlink/?LinkId=89450)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a0e77-107">For more information about Windows service applications, see [Windows Service Applications](https://go.microsoft.com/fwlink/?LinkId=89450).</span></span>  
  
 <span data-ttu-id="a0e77-108">長時間実行される Windows Communication Foundation (WCF) サービスをホストするアプリケーションは、Windows サービスと多くの特性を共有します。</span><span class="sxs-lookup"><span data-stu-id="a0e77-108">Applications that host long-running Windows Communication Foundation (WCF) services share many characteristics with Windows services.</span></span> <span data-ttu-id="a0e77-109">特に、WCF サービスは、ユーザーと直接やり取りしないため、ユーザーインターフェイスの形式を実装しない、実行時間の長いサーバー実行可能ファイルです。</span><span class="sxs-lookup"><span data-stu-id="a0e77-109">In particular, WCF services are long-running server executables that do not interact directly with the user and therefore do not implement any form of user interface.</span></span> <span data-ttu-id="a0e77-110">そのため、Windows サービスアプリケーション内で WCF サービスをホストすることは、堅牢で長時間実行される WCF アプリケーションを構築するための1つのオプションです。</span><span class="sxs-lookup"><span data-stu-id="a0e77-110">As such, hosting WCF services inside of a Windows service application is one option for building robust, long-running, WCF applications.</span></span>  
  
 <span data-ttu-id="a0e77-111">多くの場合、WCF 開発者は、WCF アプリケーションを Windows サービスアプリケーション内、またはインターネットインフォメーションサービス (IIS) または Windows プロセスアクティブ化サービス (WAS) ホスト環境の内部でホストするかどうかを決定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a0e77-111">Often, WCF developers must decide whether to host their WCF application inside of a Windows service application or inside of the Internet Information Services (IIS) or Windows Process Activation Service (WAS) hosting environment.</span></span> <span data-ttu-id="a0e77-112">次のような場合、Windows サービス上でホストする方法を使用できないか検討してください。</span><span class="sxs-lookup"><span data-stu-id="a0e77-112">You should consider using Windows service applications under the following conditions:</span></span>  
  
- <span data-ttu-id="a0e77-113">アプリケーションを明示的にアクティブ化する必要がある場合。</span><span class="sxs-lookup"><span data-stu-id="a0e77-113">Your application requires explicit activation.</span></span> <span data-ttu-id="a0e77-114">たとえば、サーバー起動時に自動的にアプリケーションも起動しなければならず、最初に届いたメッセージに応答して動的に起動するのでは困るような場合です。</span><span class="sxs-lookup"><span data-stu-id="a0e77-114">For example, you should use Windows services when your application must start automatically when the server starts instead of being dynamically started in response to the first incoming message.</span></span>  
  
- <span data-ttu-id="a0e77-115">アプリケーションをホストするプロセスが、起動されたらそのまま動作し続けなければならない場合。</span><span class="sxs-lookup"><span data-stu-id="a0e77-115">The process that hosts your application must remain running once started.</span></span> <span data-ttu-id="a0e77-116">一度起動した Windows サービスのプロセスは、サーバー管理者がサービス コントロール マネージャーで明示的にシャットダウンしない限り、そのまま動作し続けます。</span><span class="sxs-lookup"><span data-stu-id="a0e77-116">Once started, a Windows service process remains running unless explicitly shut down by a server administrator using the service control manager.</span></span> <span data-ttu-id="a0e77-117">IIS や WAS 上でホストするアプリケーションは、動的に起動および停止して、システム リソースを効率よく使うことができます。</span><span class="sxs-lookup"><span data-stu-id="a0e77-117">Applications hosted in IIS or WAS may be started and stopped dynamically to make optimal use of system resources.</span></span> <span data-ttu-id="a0e77-118">しかし、ホストするプロセスの有効期間にわたって明示的に制御しなければならない場合、IIS や WAS ではなく Windows サービスを使う必要があります。</span><span class="sxs-lookup"><span data-stu-id="a0e77-118">Applications that require explicit control over the lifetime of their hosting process should use Windows services instead of IIS or WAS.</span></span>  
  
- <span data-ttu-id="a0e77-119">WCF サービスは、Windows Server 2003 で実行し、HTTP 以外のトランスポートを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a0e77-119">Your WCF service must run on Windows Server 2003 and use transports other than HTTP.</span></span> <span data-ttu-id="a0e77-120">Windows Server 2003 では、IIS 6.0 ホスト環境は HTTP 通信のみに制限されています。</span><span class="sxs-lookup"><span data-stu-id="a0e77-120">On Windows Server 2003, the IIS 6.0 hosting environment is restricted to HTTP communication only.</span></span> <span data-ttu-id="a0e77-121">Windows サービスアプリケーションはこの制限の対象ではなく、net.tcp、net.pipe、および net.tcp を含む任意のトランスポート WCF サポートを使用できます。</span><span class="sxs-lookup"><span data-stu-id="a0e77-121">Windows service applications are not subject to this restriction and can use any transport WCF supports, including net.tcp, net.pipe, and net.msmq.</span></span>  
  
### <a name="to-host-wcf-inside-of-a-windows-service-application"></a><span data-ttu-id="a0e77-122">Windows サービス アプリケーションの内部で WCF をホストするには</span><span class="sxs-lookup"><span data-stu-id="a0e77-122">To host WCF inside of a Windows service application</span></span>  
  
1. <span data-ttu-id="a0e77-123">Windows サービス アプリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="a0e77-123">Create a Windows service application.</span></span> <span data-ttu-id="a0e77-124">Windows サービス アプリケーションは、<xref:System.ServiceProcess> 名前空間のクラスを使用して、マネージド コードとして記述することができます。</span><span class="sxs-lookup"><span data-stu-id="a0e77-124">You can write Windows service applications in managed code using the classes in the <xref:System.ServiceProcess> namespace.</span></span> <span data-ttu-id="a0e77-125">このアプリケーションには、<xref:System.ServiceProcess.ServiceBase> から派生したクラスを 1 つ含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="a0e77-125">This application must include one class that inherits from <xref:System.ServiceProcess.ServiceBase>.</span></span>  
  
2. <span data-ttu-id="a0e77-126">WCF サービスの有効期間を Windows サービスアプリケーションの有効期間にリンクします。</span><span class="sxs-lookup"><span data-stu-id="a0e77-126">Link the lifetime of the WCF services to the lifetime of the Windows service application.</span></span> <span data-ttu-id="a0e77-127">通常、Windows サービスアプリケーションでホストされている WCF サービスは、ホスティングサービスの開始時にアクティブになり、ホスティングサービスが停止したときにメッセージのリッスンを停止し、WCF サービスでエラーが発生したときにホストプロセスをシャットダウンする必要があります。</span><span class="sxs-lookup"><span data-stu-id="a0e77-127">Typically, you want WCF services hosted in a Windows service application to become active when the hosting service starts, stop listening for messages when the hosting service is stopped, and shut down the hosting process when the WCF service encounters an error.</span></span> <span data-ttu-id="a0e77-128">これは次のようにして実装します。</span><span class="sxs-lookup"><span data-stu-id="a0e77-128">This can be accomplished as follows:</span></span>  
  
    - <span data-ttu-id="a0e77-129"><xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> をオーバーライドして、<xref:System.ServiceModel.ServiceHost> のインスタンスを必要な個数開くようにします。</span><span class="sxs-lookup"><span data-stu-id="a0e77-129">Override <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> to open one or more instances of <xref:System.ServiceModel.ServiceHost>.</span></span> <span data-ttu-id="a0e77-130">1つの Windows サービスアプリケーションで、1つのグループとして開始および停止する複数の WCF サービスをホストできます。</span><span class="sxs-lookup"><span data-stu-id="a0e77-130">A single Windows service application can host multiple WCF services that start and stop as a group.</span></span>  
  
    - <span data-ttu-id="a0e77-131"><xref:System.ServiceProcess.ServiceBase.OnStop%2A>をオーバーライド <xref:System.ServiceModel.Channels.CommunicationObject.Closed> して、で <xref:System.ServiceModel.ServiceHost> 開始された実行中の WCF サービスでを呼び出し <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> ます。</span><span class="sxs-lookup"><span data-stu-id="a0e77-131">Override <xref:System.ServiceProcess.ServiceBase.OnStop%2A> to call <xref:System.ServiceModel.Channels.CommunicationObject.Closed> on the <xref:System.ServiceModel.ServiceHost> any running WCF services that were started during <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>.</span></span>  
  
    - <span data-ttu-id="a0e77-132"><xref:System.ServiceModel.Channels.CommunicationObject.Faulted> の <xref:System.ServiceModel.ServiceHost> イベントを定期受信し、エラー時には、<xref:System.ServiceProcess.ServiceController> クラスを使用して Windows サービス アプリケーションをシャットダウンします。</span><span class="sxs-lookup"><span data-stu-id="a0e77-132">Subscribe to the <xref:System.ServiceModel.Channels.CommunicationObject.Faulted> event of <xref:System.ServiceModel.ServiceHost> and use the <xref:System.ServiceProcess.ServiceController> class to shut down the Windows service application in case of error.</span></span>  
  
     <span data-ttu-id="a0e77-133">Wcf サービスをホストする windows サービスアプリケーションは、WCF を使用しない Windows サービスアプリケーションと同じ方法で展開および管理されます。</span><span class="sxs-lookup"><span data-stu-id="a0e77-133">Windows service applications that host WCF services are deployed and managed in the same way as Windows service applications that do not make use of WCF.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a0e77-134">関連項目</span><span class="sxs-lookup"><span data-stu-id="a0e77-134">See also</span></span>

- <xref:System.ServiceProcess>
- [<span data-ttu-id="a0e77-135">チュートリアル: コンポーネント デザイナーによる Windows サービス アプリケーションの作成</span><span class="sxs-lookup"><span data-stu-id="a0e77-135">Walkthrough: Creating a Windows Service Application in the Component Designer</span></span>](https://go.microsoft.com/fwlink/?LinkId=94875)
- [<span data-ttu-id="a0e77-136">方法: マネージド Windows サービスで WCF サービスをホストする</span><span class="sxs-lookup"><span data-stu-id="a0e77-136">How to: Host a WCF Service in a Managed Windows Service</span></span>](how-to-host-a-wcf-service-in-a-managed-windows-service.md)
- [<span data-ttu-id="a0e77-137">Windows サービス ホスト</span><span class="sxs-lookup"><span data-stu-id="a0e77-137">Windows Service Host</span></span>](../samples/windows-service-host.md)
- [<span data-ttu-id="a0e77-138">サービス アプリケーションのプログラミング アーキテクチャ</span><span class="sxs-lookup"><span data-stu-id="a0e77-138">Service Application Programming Architecture</span></span>](https://go.microsoft.com/fwlink/?LinkId=94876)
- <span data-ttu-id="a0e77-139">[AppFabric のホスティング機能](/previous-versions/appfabric/ee677189(v=azure.10))</span><span class="sxs-lookup"><span data-stu-id="a0e77-139">[Windows Server App Fabric Hosting Features](/previous-versions/appfabric/ee677189(v=azure.10))</span></span>
