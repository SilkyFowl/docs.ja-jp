---
description: '詳細については、「方法: フェデレーションサービスで資格情報を構成する」を参照してください。'
title: '方法: フェデレーション サービスで資格情報を設定する'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, federation
- federation
ms.assetid: 149ab165-0ef3-490a-83a9-4322a07bd98a
ms.openlocfilehash: 100012312b9b900f35753e1fa0761ba132fe0c06
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99780077"
---
# <a name="how-to-configure-credentials-on-a-federation-service"></a><span data-ttu-id="62726-103">方法: フェデレーション サービスで資格情報を設定する</span><span class="sxs-lookup"><span data-stu-id="62726-103">How to: Configure Credentials on a Federation Service</span></span>

<span data-ttu-id="62726-104">Windows Communication Foundation (WCF) では、フェデレーションサービスの作成は次の主要な手順で構成されています。</span><span class="sxs-lookup"><span data-stu-id="62726-104">In Windows Communication Foundation (WCF), creating a federated service consists of the following main procedures:</span></span>  
  
1. <span data-ttu-id="62726-105"><xref:System.ServiceModel.WSFederationHttpBinding> または同様のカスタム バインドの構成。</span><span class="sxs-lookup"><span data-stu-id="62726-105">Configuring a <xref:System.ServiceModel.WSFederationHttpBinding> or similar custom binding.</span></span> <span data-ttu-id="62726-106">適切なバインディングを作成する方法の詳細については、「 [How to: Create a WSFederationHttpBinding](how-to-create-a-wsfederationhttpbinding.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="62726-106">For more information about creating an appropriate binding, see [How to: Create a WSFederationHttpBinding](how-to-create-a-wsfederationhttpbinding.md).</span></span>  
  
2. <span data-ttu-id="62726-107">サービスに提示される発行済みトークンの認証方法を制御する <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> の構成。</span><span class="sxs-lookup"><span data-stu-id="62726-107">Configuring the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> that controls how issued tokens presented to the service are authenticated.</span></span>  
  
 <span data-ttu-id="62726-108">このトピックでは、2 番目の手順について詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="62726-108">This topic provides details about the second step.</span></span> <span data-ttu-id="62726-109">フェデレーションサービスのしくみの詳細については、「 [Federation](federation.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="62726-109">For more information about how a federated service works, see [Federation](federation.md).</span></span>  
  
### <a name="to-set-the-properties-of-issuedtokenservicecredential-in-code"></a><span data-ttu-id="62726-110">コードで IssuedTokenServiceCredential のプロパティを設定するには</span><span class="sxs-lookup"><span data-stu-id="62726-110">To set the properties of IssuedTokenServiceCredential in code</span></span>  
  
1. <span data-ttu-id="62726-111"><xref:System.ServiceModel.Description.ServiceCredentials.IssuedTokenAuthentication%2A> クラスの <xref:System.ServiceModel.Description.ServiceCredentials> プロパティを使用して、<xref:System.ServiceModel.Security.IssuedTokenServiceCredential> インスタンスへの参照を返します。</span><span class="sxs-lookup"><span data-stu-id="62726-111">Use the <xref:System.ServiceModel.Description.ServiceCredentials.IssuedTokenAuthentication%2A> property of the <xref:System.ServiceModel.Description.ServiceCredentials> class to return a reference to an <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> instance.</span></span> <span data-ttu-id="62726-112">このプロパティは、<xref:System.ServiceModel.ServiceHostBase.Credentials%2A> クラスの <xref:System.ServiceModel.ServiceHostBase> プロパティからアクセスされます。</span><span class="sxs-lookup"><span data-stu-id="62726-112">The property is accessed from the <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> property of the <xref:System.ServiceModel.ServiceHostBase> class.</span></span>  
  
2. <span data-ttu-id="62726-113"><xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> `true` CardSpace カードなどの自己発行トークンを認証する場合は、プロパティをに設定します。</span><span class="sxs-lookup"><span data-stu-id="62726-113">Set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> property to `true` if self-issued tokens such as CardSpace cards are to be authenticated.</span></span> <span data-ttu-id="62726-114">既定値は、`false` です。</span><span class="sxs-lookup"><span data-stu-id="62726-114">The default is `false`.</span></span>  
  
3. <span data-ttu-id="62726-115"><xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> プロパティによって返されるコレクションに <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> クラスのインスタンスを設定します。</span><span class="sxs-lookup"><span data-stu-id="62726-115">Populate the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property with instances of the <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> class.</span></span> <span data-ttu-id="62726-116">各インスタンスは、サービスが認証を行うトークンの発行者を表します。</span><span class="sxs-lookup"><span data-stu-id="62726-116">Each instance represents an issuer from which the service will authenticate tokens.</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="62726-117"><xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A> プロパティによって返されるクライアント側のコレクションとは異なり、既知の証明書コレクションはキー付きのコレクションではありません。</span><span class="sxs-lookup"><span data-stu-id="62726-117">Unlike the client-side collection returned by the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A> property, the known certificates collection is not a keyed collection.</span></span> <span data-ttu-id="62726-118">指定した証明書が発行するトークンは、発行済みトークンを含むメッセージを送信したクライアントのアドレスとは無関係に、サービスによって受け入れられます (その他の制約については以下で説明します)。</span><span class="sxs-lookup"><span data-stu-id="62726-118">The service accepts the tokens that the specified certificates issue regardless of the address of the client that sent the message containing the issued token (subject to the further constraints, which are described later in this topic).</span></span>  
  
4. <span data-ttu-id="62726-119"><xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> プロパティを <xref:System.ServiceModel.Security.X509CertificateValidationMode> 列挙値のいずれかに設定します。</span><span class="sxs-lookup"><span data-stu-id="62726-119">Set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> property to one of the <xref:System.ServiceModel.Security.X509CertificateValidationMode> enumeration values.</span></span> <span data-ttu-id="62726-120">これは、コードでのみ設定することができます。</span><span class="sxs-lookup"><span data-stu-id="62726-120">This can be done only in code.</span></span> <span data-ttu-id="62726-121">既定値は、<xref:System.IdentityModel.Selectors.X509CertificateValidator.ChainTrust%2A> です。</span><span class="sxs-lookup"><span data-stu-id="62726-121">The default is <xref:System.IdentityModel.Selectors.X509CertificateValidator.ChainTrust%2A>.</span></span>  
  
5. <span data-ttu-id="62726-122"><xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> プロパティが <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom> に設定されている場合、カスタム <xref:System.IdentityModel.Selectors.X509CertificateValidator> クラスのインスタンスを <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CustomCertificateValidator%2A> プロパティに割り当てます。</span><span class="sxs-lookup"><span data-stu-id="62726-122">If the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> property is set to <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>, then assign an instance of the custom <xref:System.IdentityModel.Selectors.X509CertificateValidator> class to the <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CustomCertificateValidator%2A> property.</span></span>  
  
6. <span data-ttu-id="62726-123"><xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> が `ChainTrust` または `PeerOrChainTrust` に設定されている場合、<xref:System.ServiceModel.Security.IssuedTokenServiceCredential.RevocationMode%2A> プロパティを <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> 列挙値にある適切な値に設定します。</span><span class="sxs-lookup"><span data-stu-id="62726-123">If the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> is set to `ChainTrust` or `PeerOrChainTrust`, set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.RevocationMode%2A> property to an appropriate value from the <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> enumeration.</span></span> <span data-ttu-id="62726-124">失効モードは `PeerTrust` または `Custom` 検証モードでは使用されないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="62726-124">Note that the revocation mode is not used in `PeerTrust` or `Custom` validation modes.</span></span>  
  
7. <span data-ttu-id="62726-125">必要に応じて、カスタム <xref:System.IdentityModel.Tokens.SamlSerializer> クラスのインスタンスを <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.SamlSerializer%2A> プロパティに割り当てます。</span><span class="sxs-lookup"><span data-stu-id="62726-125">If needed, assign an instance of a custom <xref:System.IdentityModel.Tokens.SamlSerializer> class to the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.SamlSerializer%2A> property.</span></span> <span data-ttu-id="62726-126">カスタム SAML (Security Assertions Markup Language) アサーションの解析などには、カスタム SAML シリアライザーが必要です。</span><span class="sxs-lookup"><span data-stu-id="62726-126">A custom Security Assertions Markup Language (SAML) serializer is needed, for example, for parsing custom SAML assertions.</span></span>  
  
### <a name="to-set-the-properties-of-issuedtokenservicecredential-in-configuration"></a><span data-ttu-id="62726-127">構成で IssuedTokenServiceCredential のプロパティを設定するには</span><span class="sxs-lookup"><span data-stu-id="62726-127">To set the properties of IssuedTokenServiceCredential in configuration</span></span>  
  
1. <span data-ttu-id="62726-128">要素を `<issuedTokenAuthentication>` <> 要素の子として作成 `serviceCredentials` します。</span><span class="sxs-lookup"><span data-stu-id="62726-128">Create an `<issuedTokenAuthentication>` element as a child of a <`serviceCredentials`> element.</span></span>  
  
2. <span data-ttu-id="62726-129">`allowUntrustedRsaIssuers` `<issuedTokenAuthentication>` CardSpace カードなどの自己発行トークンを認証する場合は、要素の属性をに設定し `true` ます。</span><span class="sxs-lookup"><span data-stu-id="62726-129">Set the `allowUntrustedRsaIssuers` attribute of the `<issuedTokenAuthentication>` element to `true` if authenticating a self-issued token, such as a CardSpace card.</span></span>  
  
3. <span data-ttu-id="62726-130">`<knownCertificates>` 要素の子要素として `<issuedTokenAuthentication>` 要素を作成します。</span><span class="sxs-lookup"><span data-stu-id="62726-130">Create a `<knownCertificates>` element as a child of the `<issuedTokenAuthentication>` element.</span></span>  
  
4. <span data-ttu-id="62726-131">`<add>` 要素の子要素として 0 個以上の `<knownCertificates>` 要素を作成し、`storeLocation`、`storeName`、`x509FindType`、および `findValue` 属性を使用して証明書の検索方法を指定します。</span><span class="sxs-lookup"><span data-stu-id="62726-131">Create zero or more `<add>` elements as children of the `<knownCertificates>` element, and specify how to locate the certificate using the `storeLocation`, `storeName`, `x509FindType`, and `findValue` attributes.</span></span>  
  
5. <span data-ttu-id="62726-132">必要に応じて、 `samlSerializer` <の> 要素の属性を `issuedTokenAuthentication` カスタムクラスの型名に設定し <xref:System.IdentityModel.Tokens.SamlSerializer> ます。</span><span class="sxs-lookup"><span data-stu-id="62726-132">If necessary, set the `samlSerializer` attribute of the <`issuedTokenAuthentication`> element to the type name of the custom <xref:System.IdentityModel.Tokens.SamlSerializer> class.</span></span>  
  
## <a name="example"></a><span data-ttu-id="62726-133">例</span><span class="sxs-lookup"><span data-stu-id="62726-133">Example</span></span>  

 <span data-ttu-id="62726-134">次の例では、<xref:System.ServiceModel.Security.IssuedTokenServiceCredential> のプロパティをコードで設定しています。</span><span class="sxs-lookup"><span data-stu-id="62726-134">The following example sets the properties of an <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> in code.</span></span>  
  
 [!code-csharp[C_FederatedService#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_federatedservice/cs/source.cs#2)]
 [!code-vb[C_FederatedService#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_federatedservice/vb/source.vb#2)]  
  
 <span data-ttu-id="62726-135">クライアントがフェデレーション サービスによって認証されるためには、発行済みトークンが次のことを満たす必要があります。</span><span class="sxs-lookup"><span data-stu-id="62726-135">In order for a federated service to authenticate a client, the following must be true about the issued token:</span></span>  
  
- <span data-ttu-id="62726-136">発行済みトークンのデジタル署名が RSA セキュリティ キー識別子を使用している場合、<xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> プロパティを `true` にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="62726-136">When the issued token’s digital signature uses an RSA security key identifier, the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> property must be `true`.</span></span>  
  
- <span data-ttu-id="62726-137">発行済みトークンの署名に X.509 発行者シリアル番号、X.509 サブジェクト キー識別子、または X.509 拇印セキュリティ識別子が使用されている場合、発行済みトークンは <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> クラスの <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> プロパティによって返されたコレクションにある証明書で署名されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="62726-137">When the issued token’s signature uses an X.509 issuer serial number, X.509 subject key identifier, or X.509 thumbprint security identifier, the issued token must be signed by a certificate in the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property of the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> class.</span></span>  
  
- <span data-ttu-id="62726-138">発行済みトークンが X.509 証明書を使用して署名されている場合、証明書が <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A> として証明書利用者に送信されたか、<xref:System.IdentityModel.Tokens.X509RawDataKeyIdentifierClause> プロパティから取得されたかに関係なく、<xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> プロパティの値で指定されるセマンティックスごとに証明書を検証する必要があります。</span><span class="sxs-lookup"><span data-stu-id="62726-138">When the issued token is signed using an X.509 certificate, the certificate must validate per the semantics specified by the value of the <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A> property, regardless of whether the certificate was sent to the relying party as a <xref:System.IdentityModel.Tokens.X509RawDataKeyIdentifierClause> or was obtained from the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property.</span></span> <span data-ttu-id="62726-139">X.509 証明書の検証の詳細については、「 [証明書の使用](working-with-certificates.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="62726-139">For more information about X.509 certificate validation, see [Working with Certificates](working-with-certificates.md).</span></span>  
  
 <span data-ttu-id="62726-140">たとえば、<xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> を <xref:System.ServiceModel.Security.X509CertificateValidationMode.PeerTrust> に設定すると、その署名の証明書が `TrustedPeople` 証明書ストアに格納されている任意の発行済みトークンが認証されます。</span><span class="sxs-lookup"><span data-stu-id="62726-140">For example, setting the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> to <xref:System.ServiceModel.Security.X509CertificateValidationMode.PeerTrust> would authenticate any issued token whose signing certificate is in the `TrustedPeople` certificate store.</span></span> <span data-ttu-id="62726-141">この場合、<xref:System.ServiceModel.Security.IssuedTokenServiceCredential.TrustedStoreLocation%2A> プロパティを <xref:System.Security.Cryptography.X509Certificates.StoreLocation.CurrentUser> または <xref:System.Security.Cryptography.X509Certificates.StoreLocation.LocalMachine> に設定します。</span><span class="sxs-lookup"><span data-stu-id="62726-141">In that case, set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.TrustedStoreLocation%2A> property to either <xref:System.Security.Cryptography.X509Certificates.StoreLocation.CurrentUser> or <xref:System.Security.Cryptography.X509Certificates.StoreLocation.LocalMachine>.</span></span> <span data-ttu-id="62726-142"><xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom> を含めて、他のモードを選択できます。</span><span class="sxs-lookup"><span data-stu-id="62726-142">You can select other modes, including <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>.</span></span> <span data-ttu-id="62726-143">`Custom` を選択した場合、<xref:System.IdentityModel.Selectors.X509CertificateValidator> クラスのインスタンスを <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CustomCertificateValidator%2A> プロパティに割り当てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="62726-143">When `Custom` is selected, you must assign an instance of the <xref:System.IdentityModel.Selectors.X509CertificateValidator> class to the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CustomCertificateValidator%2A> property.</span></span> <span data-ttu-id="62726-144">カスタム検証では、任意の基準を使用して証明書を検証できます。</span><span class="sxs-lookup"><span data-stu-id="62726-144">The custom validator can validate certificates using any criteria it likes.</span></span> <span data-ttu-id="62726-145">詳細については、「 [方法: カスタム証明書検証を使用するサービスを作成](../extending/how-to-create-a-service-that-employs-a-custom-certificate-validator.md)する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="62726-145">For more information, see [How to: Create a Service that Employs a Custom Certificate Validator](../extending/how-to-create-a-service-that-employs-a-custom-certificate-validator.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="62726-146">関連項目</span><span class="sxs-lookup"><span data-stu-id="62726-146">See also</span></span>

- [<span data-ttu-id="62726-147">フェデレーション</span><span class="sxs-lookup"><span data-stu-id="62726-147">Federation</span></span>](federation.md)
- [<span data-ttu-id="62726-148">フェデレーションと信頼</span><span class="sxs-lookup"><span data-stu-id="62726-148">Federation and Trust</span></span>](federation-and-trust.md)
- [<span data-ttu-id="62726-149">フェデレーション サンプル</span><span class="sxs-lookup"><span data-stu-id="62726-149">Federation Sample</span></span>](../samples/federation-sample.md)
- [<span data-ttu-id="62726-150">方法: WSFederationHttpBinding のセキュリティで保護されたセッションを無効にする</span><span class="sxs-lookup"><span data-stu-id="62726-150">How to: Disable Secure Sessions on a WSFederationHttpBinding</span></span>](how-to-disable-secure-sessions-on-a-wsfederationhttpbinding.md)
- [<span data-ttu-id="62726-151">方法: WSFederationHttpBinding を作成する</span><span class="sxs-lookup"><span data-stu-id="62726-151">How to: Create a WSFederationHttpBinding</span></span>](how-to-create-a-wsfederationhttpbinding.md)
- [<span data-ttu-id="62726-152">方法: フェデレーション クライアントを作成する</span><span class="sxs-lookup"><span data-stu-id="62726-152">How to: Create a Federated Client</span></span>](how-to-create-a-federated-client.md)
- [<span data-ttu-id="62726-153">証明書の使用</span><span class="sxs-lookup"><span data-stu-id="62726-153">Working with Certificates</span></span>](working-with-certificates.md)
- [<span data-ttu-id="62726-154">SecurityBindingElement 認証モード</span><span class="sxs-lookup"><span data-stu-id="62726-154">SecurityBindingElement Authentication Modes</span></span>](securitybindingelement-authentication-modes.md)
