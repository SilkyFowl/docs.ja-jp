---
description: 詳細については、「トランスポートセキュリティでの権限借用の使用」を参照してください。
title: トランスポート セキュリティでの偽装の使用
ms.date: 03/30/2017
ms.assetid: 426df8cb-6337-4262-b2c0-b96c2edf21a9
ms.openlocfilehash: 49b454369e6bf02c5c3f20661f4116f51c64c6eb
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99632322"
---
# <a name="using-impersonation-with-transport-security"></a><span data-ttu-id="68bae-103">トランスポート セキュリティでの偽装の使用</span><span class="sxs-lookup"><span data-stu-id="68bae-103">Using Impersonation with Transport Security</span></span>

<span data-ttu-id="68bae-104">*偽装* とは、サーバーアプリケーションがクライアントの id を取得する機能です。</span><span class="sxs-lookup"><span data-stu-id="68bae-104">*Impersonation* is the ability of a server application to take on the identity of the client.</span></span> <span data-ttu-id="68bae-105">リソースへのアクセスを検証するときに、サービスでは偽装が広く使用されます。</span><span class="sxs-lookup"><span data-stu-id="68bae-105">It is common for services to use impersonation when validating access to resources.</span></span> <span data-ttu-id="68bae-106">サーバー アプリケーションはサービス アカウントを使用して実行されますが、クライアントの接続を受け入れたサーバーは、クライアントの資格情報を使用してアクセス チェックが実行できるようにクライアントを偽装します。</span><span class="sxs-lookup"><span data-stu-id="68bae-106">The server application runs using a service account, but when the server accepts a client connection, it impersonates the client so that access checks are performed using the client's credentials.</span></span> <span data-ttu-id="68bae-107">トランスポート セキュリティは、資格情報を渡すこと、および渡された資格情報を使用して通信をセキュリティで保護することの 2 つの機構から成ります。</span><span class="sxs-lookup"><span data-stu-id="68bae-107">Transport security is a mechanism both for passing credentials and securing communication using those credentials.</span></span> <span data-ttu-id="68bae-108">このトピックでは、Windows Communication Foundation (WCF) のトランスポートセキュリティを権限借用機能と共に使用する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="68bae-108">This topic describes using transport security in Windows Communication Foundation (WCF) with the impersonation feature.</span></span> <span data-ttu-id="68bae-109">メッセージセキュリティを使用した偽装の詳細については、「 [委任と偽装](delegation-and-impersonation-with-wcf.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="68bae-109">For more information about impersonation using message security, see [Delegation and Impersonation](delegation-and-impersonation-with-wcf.md).</span></span>  
  
## <a name="five-impersonation-levels"></a><span data-ttu-id="68bae-110">5 つの偽装レベル</span><span class="sxs-lookup"><span data-stu-id="68bae-110">Five Impersonation Levels</span></span>  

 <span data-ttu-id="68bae-111">トランスポート セキュリティでは、次の表で説明するように 5 つの偽装レベルを使用します。</span><span class="sxs-lookup"><span data-stu-id="68bae-111">Transport security makes use of five levels of impersonation, as described in the following table.</span></span>  
  
|<span data-ttu-id="68bae-112">偽装レベル</span><span class="sxs-lookup"><span data-stu-id="68bae-112">Impersonation level</span></span>|<span data-ttu-id="68bae-113">説明</span><span class="sxs-lookup"><span data-stu-id="68bae-113">Description</span></span>|  
|-------------------------|-----------------|  
|<span data-ttu-id="68bae-114">なし</span><span class="sxs-lookup"><span data-stu-id="68bae-114">None</span></span>|<span data-ttu-id="68bae-115">サーバー アプリケーションは、クライアントの偽装を試みません。</span><span class="sxs-lookup"><span data-stu-id="68bae-115">The server application does not attempt to impersonate the client.</span></span>|  
|<span data-ttu-id="68bae-116">Anonymous</span><span class="sxs-lookup"><span data-stu-id="68bae-116">Anonymous</span></span>|<span data-ttu-id="68bae-117">サーバー アプリケーションはクライアントの資格情報に対してアクセス チェックを実行できますが、クライアントの ID に関する情報は一切受け取りません。</span><span class="sxs-lookup"><span data-stu-id="68bae-117">The server application can perform access checks against the client's credentials, but does not receive any information about the client's identity.</span></span> <span data-ttu-id="68bae-118">この偽装レベルは、名前付きパイプなど、コンピューター上での通信にのみ意味があります。</span><span class="sxs-lookup"><span data-stu-id="68bae-118">This impersonation level is meaningful only for on-machine communication, such as named pipes.</span></span> <span data-ttu-id="68bae-119">リモート接続で `Anonymous` レベルを使用すると、Identify レベルの偽装に昇格されます。</span><span class="sxs-lookup"><span data-stu-id="68bae-119">Using `Anonymous` with a remote connection promotes the impersonation level to Identify.</span></span>|  
|<span data-ttu-id="68bae-120">識別</span><span class="sxs-lookup"><span data-stu-id="68bae-120">Identify</span></span>|<span data-ttu-id="68bae-121">サーバー アプリケーションは、クライアントの ID を認識し、クライアントの資格情報に対するアクセスの検証を実行できますが、クライアントを偽装することはできません。</span><span class="sxs-lookup"><span data-stu-id="68bae-121">The server application knows the client's identity and can perform access validation against the client's credentials, but cannot impersonate the client.</span></span> <span data-ttu-id="68bae-122">トークンプロバイダーが別の偽装レベルを提供しない限り、WCF の SSPI 資格情報で使用される既定の偽装レベルは、を識別します。</span><span class="sxs-lookup"><span data-stu-id="68bae-122">Identify is the default impersonation level used with SSPI credentials in WCF unless the token provider provides a different impersonation level.</span></span>|  
|<span data-ttu-id="68bae-123">Impersonate</span><span class="sxs-lookup"><span data-stu-id="68bae-123">Impersonate</span></span>|<span data-ttu-id="68bae-124">サーバー アプリケーションは、アクセス チェックを実行できるだけでなく、クライアントとしてサーバー コンピューターのリソースにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="68bae-124">The server application can access resources on the server machine as the client in addition to performing access checks.</span></span> <span data-ttu-id="68bae-125">偽装されたトークンにはネットワーク資格情報が含まれないため、サーバー アプリケーションはクライアントの ID を使用してリモート コンピューター上のリソースにアクセスできません。</span><span class="sxs-lookup"><span data-stu-id="68bae-125">The server application cannot access resources on remote machines using the client's identity because the impersonated token does not have network credentials</span></span>|  
|<span data-ttu-id="68bae-126">代理人</span><span class="sxs-lookup"><span data-stu-id="68bae-126">Delegate</span></span>|<span data-ttu-id="68bae-127">`Impersonate` と同じ機能に加えて、Delegate レベルの偽装では、サーバー アプリケーションがクライアントの ID を使用してリモート コンピューターのリソースにアクセスし、この ID を他のアプリケーションに渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="68bae-127">In addition to having the same capabilities as `Impersonate`, the Delegate impersonation level also enables the server application to access resources on remote machines using the client's identity and to pass the identity to other applications.</span></span><br /><br /> <span data-ttu-id="68bae-128">**重要** これらの追加機能を使用するには、サーバードメインアカウントがドメインコントローラーで委任の信頼済みとしてマークされている必要があります。</span><span class="sxs-lookup"><span data-stu-id="68bae-128">**Important** The server domain account must be marked as trusted for delegation on the domain controller to use these additional features.</span></span> <span data-ttu-id="68bae-129">このレベルの偽装は、機密としてマークされているクライアント ドメイン アカウントでは使用できません。</span><span class="sxs-lookup"><span data-stu-id="68bae-129">This level of impersonation cannot be used with client domain accounts marked as sensitive.</span></span>|  
  
 <span data-ttu-id="68bae-130">トランスポートセキュリティで最も一般的に使用されるレベルは `Identify` 、と `Impersonate` です。</span><span class="sxs-lookup"><span data-stu-id="68bae-130">The levels most commonly used with transport security are `Identify` and `Impersonate`.</span></span> <span data-ttu-id="68bae-131">`None` および `Anonymous` レベルは、通常の使用にはお勧めしません。トランスポートの多くでは認証でこのレベルの使用をサポートしていません。</span><span class="sxs-lookup"><span data-stu-id="68bae-131">The levels `None` and `Anonymous` are not recommended for typical use, and many transports do not support using those levels with authentication.</span></span> <span data-ttu-id="68bae-132">`Delegate` レベルの機能は強力であり、使用に際しては注意が必要です。</span><span class="sxs-lookup"><span data-stu-id="68bae-132">The `Delegate` level is a powerful feature that should be used with care.</span></span> <span data-ttu-id="68bae-133">資格情報を委任するアクセス許可は、信頼できるサーバー アプリケーションにのみ与える必要があります。</span><span class="sxs-lookup"><span data-stu-id="68bae-133">Only trusted server applications should be given the permission to delegate credentials.</span></span>  
  
 <span data-ttu-id="68bae-134">`Impersonate` または `Delegate` レベルで偽装を使用するには、サーバー アプリケーションが `SeImpersonatePrivilege` 特権を持っている必要があります。</span><span class="sxs-lookup"><span data-stu-id="68bae-134">Using impersonation at the `Impersonate` or `Delegate` levels requires the server application to have the `SeImpersonatePrivilege` privilege.</span></span> <span data-ttu-id="68bae-135">管理者グループのアカウントまたはサービス SID (Network Service、Local Service、または Local System) を持つアカウントでアプリケーションを実行している場合は、アプリケーションに既定でこの特権があります。</span><span class="sxs-lookup"><span data-stu-id="68bae-135">An application has this privilege by default if it is running on an account in the Administrators group or on an account with a Service SID (Network Service, Local Service, or Local System).</span></span> <span data-ttu-id="68bae-136">偽装ではクライアントとサーバーの相互認証は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="68bae-136">Impersonation does not require mutual authentication of the client and server.</span></span> <span data-ttu-id="68bae-137">NTLM など、偽装をサポートする認証方式の中には、相互認証を使用できないものもあります。</span><span class="sxs-lookup"><span data-stu-id="68bae-137">Some authentication schemes that support impersonation, such as NTLM, cannot be used with mutual authentication.</span></span>  
  
## <a name="transport-specific-issues-with-impersonation"></a><span data-ttu-id="68bae-138">偽装でのトランスポート固有の問題</span><span class="sxs-lookup"><span data-stu-id="68bae-138">Transport-Specific Issues with Impersonation</span></span>  

 <span data-ttu-id="68bae-139">WCF でトランスポートを選択すると、偽装に使用できる選択肢に影響します。</span><span class="sxs-lookup"><span data-stu-id="68bae-139">The choice of a transport in WCF affects the possible choices for impersonation.</span></span> <span data-ttu-id="68bae-140">このセクションでは、WCF の標準の HTTP および名前付きパイプトランスポートに影響する問題について説明します。</span><span class="sxs-lookup"><span data-stu-id="68bae-140">This section describes issues affecting the standard HTTP and named pipe transports in WCF.</span></span> <span data-ttu-id="68bae-141">カスタム トランスポートには、偽装のサポートに関して独自の制限があります。</span><span class="sxs-lookup"><span data-stu-id="68bae-141">Custom transports have their own restrictions on support for impersonation.</span></span>  
  
### <a name="named-pipe-transport"></a><span data-ttu-id="68bae-142">名前付きパイプ トランスポート</span><span class="sxs-lookup"><span data-stu-id="68bae-142">Named Pipe Transport</span></span>  

 <span data-ttu-id="68bae-143">次の項目が名前付きパイプ トランスポートと共に使用されます。</span><span class="sxs-lookup"><span data-stu-id="68bae-143">The following items are used with the named pipe transport:</span></span>  
  
- <span data-ttu-id="68bae-144">名前付きパイプ トランスポートはローカル コンピューター上のみで使用します。</span><span class="sxs-lookup"><span data-stu-id="68bae-144">The named pipe transport is intended for use only on the local machine.</span></span> <span data-ttu-id="68bae-145">WCF の名前付きパイプトランスポートは、コンピューター間接続を明示的に許可しません。</span><span class="sxs-lookup"><span data-stu-id="68bae-145">The named pipe transport in WCF explicitly disallows cross-machine connections.</span></span>  
  
- <span data-ttu-id="68bae-146">名前付きパイプは、`Impersonate` または `Delegate` 偽装レベルでは使用できません。</span><span class="sxs-lookup"><span data-stu-id="68bae-146">Named pipes cannot be used with the `Impersonate` or `Delegate` impersonation level.</span></span> <span data-ttu-id="68bae-147">これらの偽装レベルでは、名前付きパイプはコンピューター上で保障されません。</span><span class="sxs-lookup"><span data-stu-id="68bae-147">The named pipe cannot enforce the on-machine guarantee at these impersonation levels.</span></span>  
  
 <span data-ttu-id="68bae-148">名前付きパイプの詳細については、「 [トランスポートの選択](choosing-a-transport.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="68bae-148">For more information about named pipes, see [Choosing a Transport](choosing-a-transport.md).</span></span>  
  
### <a name="http-transport"></a><span data-ttu-id="68bae-149">HTTP トランスポート</span><span class="sxs-lookup"><span data-stu-id="68bae-149">HTTP Transport</span></span>  

 <span data-ttu-id="68bae-150">HTTP トランスポートを使用するバインディング ( <xref:System.ServiceModel.WSHttpBinding> および) は、 <xref:System.ServiceModel.BasicHttpBinding> 「 [Http 認証の理解](understanding-http-authentication.md)」で説明されているように、いくつかの認証方式をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="68bae-150">The bindings that use the HTTP transport (<xref:System.ServiceModel.WSHttpBinding> and <xref:System.ServiceModel.BasicHttpBinding>) support several authentication schemes, as explained in [Understanding HTTP Authentication](understanding-http-authentication.md).</span></span> <span data-ttu-id="68bae-151">サポートされる偽装レベルは、認証方式によって異なります。</span><span class="sxs-lookup"><span data-stu-id="68bae-151">The impersonation level supported depends on the authentication scheme.</span></span> <span data-ttu-id="68bae-152">次の項目が HTTP トランスポートと共に使用されます。</span><span class="sxs-lookup"><span data-stu-id="68bae-152">The following items are used with the HTTP transport:</span></span>  
  
- <span data-ttu-id="68bae-153">`Anonymous` 認証方式は偽装を無視します。</span><span class="sxs-lookup"><span data-stu-id="68bae-153">The `Anonymous` authentication scheme ignores impersonation.</span></span>  
  
- <span data-ttu-id="68bae-154">`Basic`認証方式は、レベルのみをサポートしてい `Delegate` ます。</span><span class="sxs-lookup"><span data-stu-id="68bae-154">The `Basic` authentication scheme supports only the `Delegate` level.</span></span> <span data-ttu-id="68bae-155">これより低い偽装レベルは、アップグレードされます。</span><span class="sxs-lookup"><span data-stu-id="68bae-155">All lower impersonation levels are upgraded.</span></span>  
  
- <span data-ttu-id="68bae-156">`Digest` 認証方式では、`Impersonate` レベルと `Delegate` レベルのみをサポートします。</span><span class="sxs-lookup"><span data-stu-id="68bae-156">The `Digest` authentication scheme supports only the `Impersonate` and `Delegate` levels.</span></span>  
  
- <span data-ttu-id="68bae-157">`NTLM` 認証方式は、直接またはネゴシエーション経由で選択可能で、ローカル コンピューターで `Delegate` レベルのみをサポートします。</span><span class="sxs-lookup"><span data-stu-id="68bae-157">The `NTLM` authentication scheme, selectable either directly or through negotiation, supports only the `Delegate` level on the local machine.</span></span>  
  
- <span data-ttu-id="68bae-158">Kerberos 認証方式は、ネゴシエーション経由でのみ選択可能で、サポートされるすべての偽装レベルで使用できます。</span><span class="sxs-lookup"><span data-stu-id="68bae-158">The Kerberos authentication scheme, which can only be selected through negotiation, can be used with any supported impersonation level.</span></span>  
  
 <span data-ttu-id="68bae-159">HTTP トランスポートの詳細については、「 [トランスポートの選択](choosing-a-transport.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="68bae-159">For more information about the HTTP transport, see [Choosing a Transport](choosing-a-transport.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="68bae-160">関連項目</span><span class="sxs-lookup"><span data-stu-id="68bae-160">See also</span></span>

- [<span data-ttu-id="68bae-161">委任と偽装</span><span class="sxs-lookup"><span data-stu-id="68bae-161">Delegation and Impersonation</span></span>](delegation-and-impersonation-with-wcf.md)
- [<span data-ttu-id="68bae-162">承認</span><span class="sxs-lookup"><span data-stu-id="68bae-162">Authorization</span></span>](authorization-in-wcf.md)
- [<span data-ttu-id="68bae-163">方法: サービスでクライアントに偽装する</span><span class="sxs-lookup"><span data-stu-id="68bae-163">How to: Impersonate a Client on a Service</span></span>](../how-to-impersonate-a-client-on-a-service.md)
- [<span data-ttu-id="68bae-164">HTTP 認証の理解</span><span class="sxs-lookup"><span data-stu-id="68bae-164">Understanding HTTP Authentication</span></span>](understanding-http-authentication.md)
