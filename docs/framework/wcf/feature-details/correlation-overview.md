---
description: '詳細情報: 相関関係の概要'
title: 相関関係の概要
ms.date: 03/30/2017
ms.assetid: edcc0315-5d26-44d6-a36d-ea554c418e9f
ms.openlocfilehash: 66413a5289a8ff6172c7167a972754e3e0ba4279
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99780389"
---
# <a name="correlation-overview"></a><span data-ttu-id="f9157-103">相関関係の概要</span><span class="sxs-lookup"><span data-stu-id="f9157-103">Correlation Overview</span></span>

<span data-ttu-id="f9157-104">相関関係とは、ワークフロー サービス メッセージを互いに関連付ける、最初の要求への応答などのアプリケーションのインスタンス状態と関連付ける、または特定の注文 ID を注文処理ワークフローの永続化された状態に関連付けるためのしくみです。</span><span class="sxs-lookup"><span data-stu-id="f9157-104">Correlation is the mechanism for relating workflow service messages to each other or to the application instance state, such as a reply to an initial request, or a particular order ID to the persisted state of an order-processing workflow.</span></span> <span data-ttu-id="f9157-105">ここでは、相関関係の概要について説明します。</span><span class="sxs-lookup"><span data-stu-id="f9157-105">This topic provides an overview of correlation.</span></span> <span data-ttu-id="f9157-106">このセクションの他のトピックでは、相関関係の各種類についての追加情報を提供します。</span><span class="sxs-lookup"><span data-stu-id="f9157-106">The other topics in this section provide additional information for each type of correlation.</span></span>  
  
## <a name="types-of-correlation"></a><span data-ttu-id="f9157-107">相関関係の種類</span><span class="sxs-lookup"><span data-stu-id="f9157-107">Types of Correlation</span></span>  

 <span data-ttu-id="f9157-108">相関関係には、プロトコル ベースとコンテンツ ベースがあります。</span><span class="sxs-lookup"><span data-stu-id="f9157-108">Correlation can be protocol-based or content-based.</span></span> <span data-ttu-id="f9157-109">プロトコル ベースの相関関係では、メッセージ間のマッピングを提供するためのメッセージ配信インフラストラクチャで提供されるデータが使用されます。</span><span class="sxs-lookup"><span data-stu-id="f9157-109">Protocol-based correlations use data provided by the message delivery infrastructure to provide the mapping between messages.</span></span> <span data-ttu-id="f9157-110">プロトコル ベースの相関関係を使用して関連付けられたメッセージは、メモリ内の <xref:System.ServiceModel.Channels.RequestContext> などのオブジェクトを使用して、またはトランスポート プロトコルで提供されるトークンによって、互いに関連付けられます。</span><span class="sxs-lookup"><span data-stu-id="f9157-110">Messages that are correlated using protocol-based correlation are related to each other using an object in memory, such as a <xref:System.ServiceModel.Channels.RequestContext>, or by a token provided by the transport protocol.</span></span> <span data-ttu-id="f9157-111">コンテンツ ベースの相関関係では、メッセージが、アプリケーションで指定されたデータを使用して関連付けられます。</span><span class="sxs-lookup"><span data-stu-id="f9157-111">Content-based correlations relate messages to each other using application-specified data.</span></span> <span data-ttu-id="f9157-112">コンテンツ ベースの相関関係を使用して関連付けられたメッセージは、アプリケーションが定義する顧客番号などのメッセージ内のデータによって互いに関連付けられます。</span><span class="sxs-lookup"><span data-stu-id="f9157-112">Messages that are correlated using content-based correlation are related to each other by some application-defined data in the message, such as a customer number.</span></span>  
  
 <span data-ttu-id="f9157-113">相関関係に参加するアクティビティは、<xref:System.ServiceModel.Activities.CorrelationHandle> を使用してメッセージング アクティビティを互いに結び付けます。</span><span class="sxs-lookup"><span data-stu-id="f9157-113">Activities that participate in correlation use a <xref:System.ServiceModel.Activities.CorrelationHandle> to tie the messaging activities together.</span></span> <span data-ttu-id="f9157-114">たとえば、サービスの呼び出しに使用される <xref:System.ServiceModel.Activities.Send> と、それに続く、サービスからのコールバックの受信に使用される <xref:System.ServiceModel.Activities.Receive> は、同じ <xref:System.ServiceModel.Activities.CorrelationHandle> を共有します。</span><span class="sxs-lookup"><span data-stu-id="f9157-114">For example, a <xref:System.ServiceModel.Activities.Send> that is used to call a service and a subsequent <xref:System.ServiceModel.Activities.Receive> that is used to receive a callback from the service, share the same <xref:System.ServiceModel.Activities.CorrelationHandle>.</span></span> <span data-ttu-id="f9157-115">この基本的なパターンは、相関関係がコンテンツ ベースであっても、プロトコル ベースであっても使用されます。</span><span class="sxs-lookup"><span data-stu-id="f9157-115">This basic pattern is used whether the correlation is content based or protocol based.</span></span> <span data-ttu-id="f9157-116">関連付けハンドルは、各アクティビティに明示的に設定する、またはアクティビティを <xref:System.ServiceModel.Activities.CorrelationScope> アクティビティに格納することができます。</span><span class="sxs-lookup"><span data-stu-id="f9157-116">The correlation handle can be explicitly set on each activity or the activities can be contained in a <xref:System.ServiceModel.Activities.CorrelationScope> activity.</span></span> <span data-ttu-id="f9157-117"><xref:System.ServiceModel.Activities.CorrelationScope> に格納されたアクティビティには、<xref:System.ServiceModel.Activities.CorrelationScope> が管理する関連付けハンドルがあり、<xref:System.ServiceModel.Activities.CorrelationHandle> を明示的に設定する必要がありません。</span><span class="sxs-lookup"><span data-stu-id="f9157-117">Activities contained in a <xref:System.ServiceModel.Activities.CorrelationScope> have their correlation handles managed by the <xref:System.ServiceModel.Activities.CorrelationScope> and do not require the <xref:System.ServiceModel.Activities.CorrelationHandle> to be explicitly set.</span></span> <span data-ttu-id="f9157-118"><xref:System.ServiceModel.Activities.CorrelationScope> スコープでは、要求/応答の相関関係と、もう 1 つの種類の相関関係のための <xref:System.ServiceModel.Activities.CorrelationHandle> 管理が提供されます。</span><span class="sxs-lookup"><span data-stu-id="f9157-118">A <xref:System.ServiceModel.Activities.CorrelationScope> scope provides <xref:System.ServiceModel.Activities.CorrelationHandle> management for a request-reply correlation and one additional correlation type.</span></span> <span data-ttu-id="f9157-119"><xref:System.ServiceModel.Activities.WorkflowServiceHost> を使用してホストされるワークフロー サービスには、<xref:System.ServiceModel.Activities.CorrelationScope> アクティビティと同じ既定の関連付け管理があります。</span><span class="sxs-lookup"><span data-stu-id="f9157-119">Workflow services hosted using <xref:System.ServiceModel.Activities.WorkflowServiceHost> have the same default correlation management as the <xref:System.ServiceModel.Activities.CorrelationScope> activity.</span></span> <span data-ttu-id="f9157-120">多くのシナリオで、この既定の関連付け管理は、<xref:System.ServiceModel.Activities.CorrelationScope> 内のメッセージング アクティビティ、またはワークフロー サービスが <xref:System.ServiceModel.Activities.CorrelationHandle> セットを要求しないことを意味します。ただし、2 つの <xref:System.ServiceModel.Activities.Receive> アクティビティが並行している、または 2 つの <xref:System.ServiceModel.Activities.Send> アクティビティに 2 つの <xref:System.ServiceModel.Activities.Receive> アクティビティが続くなど、複数のメッセージング アクティビティが並行または重複している場合を除きます。</span><span class="sxs-lookup"><span data-stu-id="f9157-120">This default correlation management generally means that in many scenarios, messaging activities in a <xref:System.ServiceModel.Activities.CorrelationScope> or a workflow service do not require their <xref:System.ServiceModel.Activities.CorrelationHandle> set unless multiple messaging activities are in parallel or overlap, such as two <xref:System.ServiceModel.Activities.Receive> activities in parallel, or two <xref:System.ServiceModel.Activities.Send> activities followed by two <xref:System.ServiceModel.Activities.Receive> activities.</span></span> <span data-ttu-id="f9157-121">既定の相関関係の詳細情報は、このセクションの中のそれぞれの種類の相関関係を説明するトピックに記述されています。</span><span class="sxs-lookup"><span data-stu-id="f9157-121">More information about default correlation is provided in the topics in this section that cover each specific type of correlation.</span></span> <span data-ttu-id="f9157-122">メッセージングアクティビティの詳細については、「メッセージング [アクティビティ](messaging-activities.md) 」と「 [方法: メッセージングアクティビティを使用してワークフローサービスを作成する](how-to-create-a-workflow-service-with-messaging-activities.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f9157-122">For more information about messaging activities see [Messaging Activities](messaging-activities.md) and [How to: Create a Workflow Service with Messaging Activities](how-to-create-a-workflow-service-with-messaging-activities.md).</span></span>  
  
## <a name="protocol-based-correlation"></a><span data-ttu-id="f9157-123">プロトコル ベースの相関関係</span><span class="sxs-lookup"><span data-stu-id="f9157-123">Protocol-Based Correlation</span></span>

<span data-ttu-id="f9157-124">プロトコル ベースの相関関係では、メッセージを相互に関連付け、該当するインスタンスと関連付けるために、トランスポート機構が使用されます。</span><span class="sxs-lookup"><span data-stu-id="f9157-124">Protocol-based correlation uses the transport mechanism to relate messages to each other and the appropriate instance.</span></span> <span data-ttu-id="f9157-125">システムで提供される一部のプロトコル相関関係には、要求/応答の相関関係とコンテキスト ベースの相関関係が含まれます。</span><span class="sxs-lookup"><span data-stu-id="f9157-125">Some system-provided protocol correlations include request-reply correlation and context-based correlation.</span></span> <span data-ttu-id="f9157-126">要求/応答の相関関係を使用して、メッセージング アクティビティの 1 つのペアが関連付けられ、<xref:System.ServiceModel.Activities.Send> と <xref:System.ServiceModel.Activities.ReceiveReply> のペアや、<xref:System.ServiceModel.Activities.Receive> と <xref:System.ServiceModel.Activities.SendReply> のペアなどの双方向の操作が形成されます。</span><span class="sxs-lookup"><span data-stu-id="f9157-126">A request-reply correlation is used to correlate a single pair of messaging activities to form a two-way operation, such as a <xref:System.ServiceModel.Activities.Send> paired with a <xref:System.ServiceModel.Activities.ReceiveReply>, or a <xref:System.ServiceModel.Activities.Receive> paired with a <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="f9157-127">また、Visual Studio ワークフローデザイナーには、このパターンを迅速に実装するアクティビティテンプレートのセットも用意されています。</span><span class="sxs-lookup"><span data-stu-id="f9157-127">The Visual Studio Workflow Designer also provides a set of activity templates to quickly implement this pattern.</span></span> <span data-ttu-id="f9157-128">コンテキストベースの相関関係は、「 [.Net コンテキスト交換プロトコルの仕様](/openspecs/windows_protocols/mc-netcex/a7f26280-491f-465b-9914-c5eb5322dbb4)」で説明されているコンテキスト交換メカニズムに基づいています。</span><span class="sxs-lookup"><span data-stu-id="f9157-128">A context-based correlation is based on the context exchange mechanism described in the [.NET Context Exchange Protocol Specification](/openspecs/windows_protocols/mc-netcex/a7f26280-491f-465b-9914-c5eb5322dbb4).</span></span> <span data-ttu-id="f9157-129">コンテキスト ベースの相関関係を使用するには、<xref:System.ServiceModel.BasicHttpContextBinding>、<xref:System.ServiceModel.WSHttpContextBinding>、または <xref:System.ServiceModel.NetTcpContextBinding> などのコンテキスト ベースのバインディングがエンドポイントで使用される必要があります。</span><span class="sxs-lookup"><span data-stu-id="f9157-129">To use context-based correlation, a context-based binding such as <xref:System.ServiceModel.BasicHttpContextBinding>, <xref:System.ServiceModel.WSHttpContextBinding> or <xref:System.ServiceModel.NetTcpContextBinding> must be used on the endpoint.</span></span>  
  
<span data-ttu-id="f9157-130">プロトコルの相関関係の詳細については、「 [永続的な二重](durable-duplex-correlation.md) と [要求-応答](request-reply-correlation.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f9157-130">For more information about protocol correlation, see [Durable Duplex](durable-duplex-correlation.md) and [Request-Reply](request-reply-correlation.md).</span></span> <span data-ttu-id="f9157-131">Visual Studio のワークフローデザイナーアクティビティテンプレートの使用方法の詳細については、「 [メッセージングアクティビティ](messaging-activities.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f9157-131">For more information about using the Visual Studio Workflow Designer activity templates, see [Messaging Activities](messaging-activities.md).</span></span> <span data-ttu-id="f9157-132">サンプルコードについては、 [NetContextExchangeCorrelation](/previous-versions/dotnet/netframework-4.0/ee662963(v=vs.100)) サンプルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="f9157-132">For sample code, see the [NetContextExchangeCorrelation](/previous-versions/dotnet/netframework-4.0/ee662963(v=vs.100)) sample.</span></span>  
  
## <a name="content-based-correlation"></a><span data-ttu-id="f9157-133">コンテンツ ベースの相関関係</span><span class="sxs-lookup"><span data-stu-id="f9157-133">Content-Based Correlation</span></span>

<span data-ttu-id="f9157-134">コンテンツ ベースの相関関係では、メッセージ内の一部の情報を特定のインスタンスとの関連付けに使用します。</span><span class="sxs-lookup"><span data-stu-id="f9157-134">Content-based correlation uses some piece of information in the message to associate it to a particular instance.</span></span> <span data-ttu-id="f9157-135">プロトコル ベースの相関関係と異なり、コンテンツ ベースの相関関係では、各関連メッセージ内のこの情報がある場所に、アプリケーションの作成者が明示的に記述されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="f9157-135">Unlike protocol-based correlation, content-based correlation requires the application author to explicitly state where this data can be found in each related message.</span></span> <span data-ttu-id="f9157-136">コンテンツ ベースの相関関係を使用するアクティビティでは、<xref:System.ServiceModel.MessageQuerySet> を使用して、このメッセージ データを指定します。</span><span class="sxs-lookup"><span data-stu-id="f9157-136">Activities that use content-based correlation specify this message data by using a <xref:System.ServiceModel.MessageQuerySet>.</span></span> <span data-ttu-id="f9157-137">コンテンツ ベースの相関関係は、<xref:System.ServiceModel.BasicHttpContextBinding> などのコンテキスト バインディングの 1 つを使用しないサービスと通信する場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="f9157-137">Content-based correlation is useful when communicating with services that do not use one of the context bindings such as <xref:System.ServiceModel.BasicHttpContextBinding>.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="f9157-138">関連項目</span><span class="sxs-lookup"><span data-stu-id="f9157-138">See also</span></span>

- <span data-ttu-id="f9157-139">[NetContextExchangeCorrelation](/previous-versions/dotnet/netframework-4.0/ee662963(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="f9157-139">[NetContextExchangeCorrelation](/previous-versions/dotnet/netframework-4.0/ee662963(v=vs.100))</span></span>
