---
description: 詳細については、「データコントラクトサロゲート」を参照してください。
title: データ コントラクト サロゲート
ms.date: 03/30/2017
helpviewer_keywords:
- data contracts [WCF], surrogates
ms.assetid: 8c31134c-46c5-4ed7-94af-bab0ac0dfce5
ms.openlocfilehash: 335e7f64868177d00c747e29c463808f3eff3056
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99685804"
---
# <a name="data-contract-surrogates"></a><span data-ttu-id="9d23f-103">データ コントラクト サロゲート</span><span class="sxs-lookup"><span data-stu-id="9d23f-103">Data Contract Surrogates</span></span>

<span data-ttu-id="9d23f-104">データコントラクト *サロゲート* は、データコントラクトモデルに基づいて構築された高度な機能です。</span><span class="sxs-lookup"><span data-stu-id="9d23f-104">The data contract *surrogate* is an advanced feature built upon the Data Contract model.</span></span> <span data-ttu-id="9d23f-105">この機能は、型をシリアル化または逆シリアル化する方法や、型をメタデータに投影する方法をユーザーが変更する場合に、型のカスタマイズと置換に使用することを目的としています。</span><span class="sxs-lookup"><span data-stu-id="9d23f-105">This feature is designed to be used for type customization and substitution in situations where users want to change how a type is serialized, deserialized or projected into metadata.</span></span> <span data-ttu-id="9d23f-106">サロゲートを使用できるのは、型のデータ コントラクトが指定されていない場合、フィールドやプロパティが <xref:System.Runtime.Serialization.DataMemberAttribute> 属性でマークされていない場合、またはユーザーがスキーマのバリエーションを動的に作成することを希望している場合などです。</span><span class="sxs-lookup"><span data-stu-id="9d23f-106">Some scenarios where a surrogate may be used is when a data contract has not been specified for the type, fields and properties are not marked with the <xref:System.Runtime.Serialization.DataMemberAttribute> attribute or users wish to dynamically create schema variations.</span></span>  
  
 <span data-ttu-id="9d23f-107"><xref:System.Runtime.Serialization.DataContractSerializer> を使用して .NET Framework から XML などの適切な形式に変換するときに、データ コントラクト サロゲートを使用してシリアル化と逆シリアル化を行います。</span><span class="sxs-lookup"><span data-stu-id="9d23f-107">Serialization and deserialization are accomplished with the data contract surrogate when using <xref:System.Runtime.Serialization.DataContractSerializer> to convert from .NET Framework to a suitable format, such as XML.</span></span> <span data-ttu-id="9d23f-108">また、XML スキーマ ドキュメント (XSD) などのメタデータ表現を生成するときに、データ コントラクト サロゲートを使用して、型のエクスポートするメタデータを変更できます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-108">Data contract surrogate can also be used to modify the metadata exported for types, when producing metadata representations such as XML Schema Documents (XSD).</span></span> <span data-ttu-id="9d23f-109">インポート時には、メタデータからコードが作成されますが、この場合にサロゲートを使用すると、生成されるコードもカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-109">Upon import, code is created from metadata and the surrogate can be used in this case to customize the generated code as well.</span></span>  
  
## <a name="how-the-surrogate-works"></a><span data-ttu-id="9d23f-110">サロゲートのしくみ</span><span class="sxs-lookup"><span data-stu-id="9d23f-110">How the Surrogate Works</span></span>  

 <span data-ttu-id="9d23f-111">サロゲートは、ある型 ("元の" 型) を別の型 ("サロゲートされた" 型) に割り当てることによって機能します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-111">A surrogate works by mapping one type (the "original" type) to another type (the "surrogated" type).</span></span> <span data-ttu-id="9d23f-112">元の型 `Inventory` と新しいサロゲート型 `InventorySurrogated` の例を以下に示します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-112">The following example shows the original type `Inventory` and a new surrogate `InventorySurrogated` type.</span></span> <span data-ttu-id="9d23f-113">`Inventory` 型はシリアル化できませんが、`InventorySurrogated` 型は以下のようになります。</span><span class="sxs-lookup"><span data-stu-id="9d23f-113">The `Inventory` type is not serializable but the `InventorySurrogated` type is:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#1)]  
  
 <span data-ttu-id="9d23f-114">このクラスにはデータ コントラクトが定義されていないため、このクラスをデータ コントラクトを持つサロゲート クラスに変換します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-114">Because a data contract has not been defined for this class, convert the class to a surrogate class with a data contract.</span></span> <span data-ttu-id="9d23f-115">サロゲートされたクラスの例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-115">The surrogated class is shown in the following example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#2)]  
  
## <a name="implementing-the-idatacontractsurrogate"></a><span data-ttu-id="9d23f-116">IDataContractSurrogate の実装</span><span class="sxs-lookup"><span data-stu-id="9d23f-116">Implementing the IDataContractSurrogate</span></span>  

 <span data-ttu-id="9d23f-117">データ コントラクト サロゲートを使用するには、<xref:System.Runtime.Serialization.IDataContractSurrogate> インターフェイスを実装します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-117">To use the data contract surrogate, implement the <xref:System.Runtime.Serialization.IDataContractSurrogate> interface.</span></span>  
  
 <span data-ttu-id="9d23f-118">考えられる実装での <xref:System.Runtime.Serialization.IDataContractSurrogate> の各メソッドの概要を以下に示します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-118">The following is an overview of each method of <xref:System.Runtime.Serialization.IDataContractSurrogate> with a possible implementation.</span></span>  
  
### <a name="getdatacontracttype"></a><span data-ttu-id="9d23f-119">GetDataContractType</span><span class="sxs-lookup"><span data-stu-id="9d23f-119">GetDataContractType</span></span>  

 <span data-ttu-id="9d23f-120"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> メソッドは、ある型を別の型に割り当てます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-120">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method maps one type to another.</span></span> <span data-ttu-id="9d23f-121">これは、シリアル化、逆シリアル化、インポート、およびエクスポートに必須のメソッドです。</span><span class="sxs-lookup"><span data-stu-id="9d23f-121">This method is required for serialization, deserialization, import, and export.</span></span>  
  
 <span data-ttu-id="9d23f-122">最初の作業として、他の型に割り当てる型を定義します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-122">The first task is defining what types will be mapped to other types.</span></span> <span data-ttu-id="9d23f-123">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-123">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#3)]  
  
- <span data-ttu-id="9d23f-124">シリアル化では、後で <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> メソッドを呼び出して、元のインスタンスをサロゲートされたインスタンスに変換する際に、このメソッドによって返されたマッピングが使用されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-124">On serialization, the mapping returned by this method is subsequently used to transform the original instance to a surrogated instance by calling the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method.</span></span>  
  
- <span data-ttu-id="9d23f-125">逆シリアル化では、サロゲート型のインスタンスに逆シリアル化する際に、シリアライザーはこのメソッドによって返されたマッピングを使用します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-125">On deserialization, the mapping returned by this method is used by the serializer to deserialize into an instance of the surrogate type.</span></span> <span data-ttu-id="9d23f-126">その後、<xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> が呼び出されて、サロゲートされたインスタンスが元の型のインスタンスに変換されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-126">It subsequently calls <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> to transform the surrogated instance into an instance of the original type.</span></span>  
  
- <span data-ttu-id="9d23f-127">エクスポートでは、メタデータの生成に使用するデータ コントラクトを取得する際に、このメソッドによって返されたサロゲート型が反映されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-127">On export, the surrogate type returned by this method is reflected to get the data contract to use for generating metadata.</span></span>  
  
- <span data-ttu-id="9d23f-128">インポートでは、最初の型がサロゲート型に変更されます。このサロゲート型は、参照のサポートなどの目的で使用するデータ コントラクトを取得する際に反映されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-128">On import, the initial type is changed to a surrogate type that is reflected to get the data contract to use for purposes like referencing support.</span></span>  
  
 <span data-ttu-id="9d23f-129"><xref:System.Type> パラメーターは、シリアル化、逆シリアル化、インポート、またはエクスポートするオブジェクトの型です。</span><span class="sxs-lookup"><span data-stu-id="9d23f-129">The <xref:System.Type> parameter is the type of the object that is being serialized, deserialized, imported, or exported.</span></span> <span data-ttu-id="9d23f-130">サロゲートが型を処理しない場合、<xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> メソッドは入力の型を返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="9d23f-130">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method must return the input type if the surrogate does not handle the type.</span></span> <span data-ttu-id="9d23f-131">それ以外の場合は、サロゲートされた適切な型を返します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-131">Otherwise, return the appropriate surrogated type.</span></span> <span data-ttu-id="9d23f-132">複数のサロゲート型が存在する場合は、このメソッドで多数のマッピングを定義できます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-132">If several surrogate types exist, numerous mappings can be defined in this method.</span></span>  
  
 <span data-ttu-id="9d23f-133"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> メソッドは、組み込みのデータ コントラクト プリミティブ (<xref:System.Int32> や <xref:System.String> など) に対しては呼び出されません。</span><span class="sxs-lookup"><span data-stu-id="9d23f-133">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method is not called for built-in data contract primitives, such as <xref:System.Int32> or <xref:System.String>.</span></span> <span data-ttu-id="9d23f-134">その他の型 (配列、ユーザー定義型、その他のデータ構造体など) については、このメソッドは各型に対して呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-134">For other types, such as arrays, user-defined types, and other data structures, this method will be called for each type.</span></span>  
  
 <span data-ttu-id="9d23f-135">前の例では、このメソッドは `type` パラメーターと `Inventory` が比較可能かどうかをチェックします。</span><span class="sxs-lookup"><span data-stu-id="9d23f-135">In the previous example, the method checks if the `type` parameter and `Inventory` are comparable.</span></span> <span data-ttu-id="9d23f-136">比較可能な場合は、`InventorySurrogated` に割り当てます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-136">If so, the method maps it to `InventorySurrogated`.</span></span> <span data-ttu-id="9d23f-137">シリアル化、逆シリアル化、インポート スキーマ、またはエクスポート スキーマを呼び出すときは、常にこの関数が最初に呼び出されて、型間のマッピングが確認されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-137">Whenever a serialization, deserialization, import schema, or export schema is called, this function is called first to determine the mapping between types.</span></span>  
  
### <a name="getobjecttoserialize-method"></a><span data-ttu-id="9d23f-138">GetObjectToSerialize Method</span><span class="sxs-lookup"><span data-stu-id="9d23f-138">GetObjectToSerialize Method</span></span>  

 <span data-ttu-id="9d23f-139"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> メソッドは、元の型のインスタンスをサロゲートされた型のインスタンスに変換します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-139">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method converts the original type instance to the surrogated type instance.</span></span> <span data-ttu-id="9d23f-140">これは、シリアル化に必須のメソッドです。</span><span class="sxs-lookup"><span data-stu-id="9d23f-140">The method is required for serialization.</span></span>  
  
 <span data-ttu-id="9d23f-141">次の手順では、<xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> メソッドを実装して、物理データを元のインスタンスからサロゲートに割り当てる方法を定義します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-141">The next step is to define the way the physical data will be mapped from the original instance to the surrogate by implementing the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method.</span></span> <span data-ttu-id="9d23f-142">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-142">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#4)]  
  
 <span data-ttu-id="9d23f-143"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> メソッドは、オブジェクトをシリアル化するときに呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-143">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method is called when an object is serialized.</span></span> <span data-ttu-id="9d23f-144">このメソッドでは、元の型からサロゲートされた型のフィールドにデータを転送します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-144">This method transfers data from the original type to the fields of the surrogated type.</span></span> <span data-ttu-id="9d23f-145">フィールドは、サロゲート フィールドに直接割り当てることができます。また、元のデータの操作をサロゲートに格納することもできます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-145">Fields can be directly mapped to surrogate fields, or manipulations of the original data may be stored in the surrogate.</span></span> <span data-ttu-id="9d23f-146">このメソッドは、フィールドを直接割り当てる場合、サロゲートされたフィールドに格納されたデータに対して操作を実行する場合、サロゲートされたフィールドに元の型の XML を格納する場合などに使用できます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-146">Some possible uses include: directly mapping the fields, performing operations on the data to be stored in the surrogated fields, or storing the XML of the original type in the surrogated field.</span></span>  
  
 <span data-ttu-id="9d23f-147">`targetType` パラメーターは、メンバーの宣言された型を指します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-147">The `targetType` parameter refers to the declared type of the member.</span></span> <span data-ttu-id="9d23f-148">このパラメーターは、<xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> メソッドによって返されたサロゲートされた型です。</span><span class="sxs-lookup"><span data-stu-id="9d23f-148">This parameter is the surrogated type returned by the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method.</span></span> <span data-ttu-id="9d23f-149">シリアライザーは、返されるオブジェクトがこの型に割り当て可能であることを強制するわけではありません。</span><span class="sxs-lookup"><span data-stu-id="9d23f-149">The serializer does not enforce that the object returned is assignable to this type.</span></span> <span data-ttu-id="9d23f-150">パラメーターは、 `obj` シリアル化するオブジェクトであり、必要に応じてサロゲートに変換されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-150">The `obj` parameter is the object to serialize, and will be converted to its surrogate if necessary.</span></span> <span data-ttu-id="9d23f-151">サロゲートがオブジェクトを処理しない場合、このメソッドは入力オブジェクトを返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="9d23f-151">This method must return the input object if the surrogated does not handle the object.</span></span> <span data-ttu-id="9d23f-152">それ以外の場合は、新しいサロゲート オブジェクトが返されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-152">Otherwise, the new surrogate object will be returned.</span></span> <span data-ttu-id="9d23f-153">オブジェクトが null の場合、サロゲートは呼び出されません。</span><span class="sxs-lookup"><span data-stu-id="9d23f-153">The surrogate is not called if the object is null.</span></span> <span data-ttu-id="9d23f-154">さまざまなインスタンスの多数のサロゲートのマッピングをこのメソッドで定義できます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-154">Numerous surrogate mappings for different instances may be defined within this method.</span></span>  
  
 <span data-ttu-id="9d23f-155"><xref:System.Runtime.Serialization.DataContractSerializer> の作成時に、オブジェクト参照を保持するように指定できます </span><span class="sxs-lookup"><span data-stu-id="9d23f-155">When creating a <xref:System.Runtime.Serialization.DataContractSerializer>, you can instruct it to preserve object references.</span></span> <span data-ttu-id="9d23f-156">(詳細については、「 [シリアル化と逆シリアル化](../feature-details/serialization-and-deserialization.md)」を参照してください)。これを行うには、 `preserveObjectReferences` コンストラクターのパラメーターをに設定し `true` ます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-156">(For more information, see [Serialization and Deserialization](../feature-details/serialization-and-deserialization.md).) This is done by setting the `preserveObjectReferences` parameter in its constructor to `true`.</span></span> <span data-ttu-id="9d23f-157">この場合、サロゲートはオブジェクトに対して 1 回だけ呼び出されます。これは、以降のシリアル化では参照をストリームに書き込むだけだからです。</span><span class="sxs-lookup"><span data-stu-id="9d23f-157">In that case, the surrogate is called only once for an object since all subsequent serializations just write the reference into the stream.</span></span> <span data-ttu-id="9d23f-158">`preserveObjectReferences` を `false` に設定すると、インスタンスが発生するたびにサロゲートが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-158">If `preserveObjectReferences` is set to `false`, then the surrogate is called every time an instance is encountered.</span></span>  
  
 <span data-ttu-id="9d23f-159">シリアル化されたインスタンスの型が宣言された型と異なる場合、インスタンスをもう一方の側で逆シリアル化できるように、型情報 (`xsi:type` など) がストリームに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-159">If the type of the instance serialized differs from the declared type, type information is written into the stream, for example, `xsi:type` to allow the instance to be deserialized at the other end.</span></span> <span data-ttu-id="9d23f-160">このプロセスは、オブジェクトがサロゲートされているかどうかに関係なく発生します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-160">This process occurs whether the object is surrogated or not.</span></span>  
  
 <span data-ttu-id="9d23f-161">前述の例では、`Inventory` インスタンスのデータが `InventorySurrogated` のデータに変換されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-161">The example above converts the data of the `Inventory` instance to that of `InventorySurrogated`.</span></span> <span data-ttu-id="9d23f-162">オブジェクトの型がチェックされ、サロゲートされた型に変換するために必要な処理が実行されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-162">It checks the type of the object and performs the necessary manipulations to convert to the surrogated type.</span></span> <span data-ttu-id="9d23f-163">この場合、`Inventory` クラスの各フィールドは、`InventorySurrogated` クラスのフィールドに直接コピーされます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-163">In this case, the fields of the `Inventory` class are directly copied over to the `InventorySurrogated` class fields.</span></span>  
  
### <a name="getdeserializedobject-method"></a><span data-ttu-id="9d23f-164">GetDeserializedObject Method</span><span class="sxs-lookup"><span data-stu-id="9d23f-164">GetDeserializedObject Method</span></span>  

 <span data-ttu-id="9d23f-165"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> メソッドは、サロゲートされた型のインスタンスを元の型のインスタンスに変換します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-165">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> method converts the surrogated type instance to the original type instance.</span></span> <span data-ttu-id="9d23f-166">これは、逆シリアル化に必須のメソッドです。</span><span class="sxs-lookup"><span data-stu-id="9d23f-166">It is required for deserialization.</span></span>  
  
 <span data-ttu-id="9d23f-167">次のタスクとして、サロゲート インスタンスから元のインスタンスに物理データを割り当てる方法を定義します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-167">The next task is to define the way the physical data will be mapped from the surrogate instance to the original.</span></span> <span data-ttu-id="9d23f-168">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-168">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#5)]  
  
 <span data-ttu-id="9d23f-169">このメソッドが呼び出されるのは、オブジェクトの逆シリアル化中だけです。</span><span class="sxs-lookup"><span data-stu-id="9d23f-169">This method is called only during the deserialization of an object.</span></span> <span data-ttu-id="9d23f-170">このメソッドは、サロゲート型から元の型に戻す逆シリアル化に必要な逆方向のデータ マッピングを行います。</span><span class="sxs-lookup"><span data-stu-id="9d23f-170">It provides reverse data mapping for the deserialization from the surrogate type back to its original type.</span></span> <span data-ttu-id="9d23f-171">`GetObjectToSerialize` メソッドと同様に、フィールド データを直接交換する場合、データに対して操作を実行する場合、XML データを格納する場合などに使用できます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-171">Similar to the `GetObjectToSerialize` method, some possible uses may be to directly exchange field data, perform operations on the data, and store XML data.</span></span> <span data-ttu-id="9d23f-172">逆シリアル化するときには、データ変換時の操作の結果として、元のデータから正確なデータ値を必ずしも取得できるとは限りません。</span><span class="sxs-lookup"><span data-stu-id="9d23f-172">When  deserializing, you may not always obtain the exact data values from original due to manipulations in the data conversion.</span></span>  
  
 <span data-ttu-id="9d23f-173">`targetType` パラメーターは、メンバーの宣言された型を指します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-173">The `targetType` parameter refers to the declared type of the member.</span></span> <span data-ttu-id="9d23f-174">このパラメーターは、`GetDataContractType` メソッドによって返されたサロゲートされた型です。</span><span class="sxs-lookup"><span data-stu-id="9d23f-174">This parameter is the surrogated type returned by the `GetDataContractType` method.</span></span> <span data-ttu-id="9d23f-175">パラメーターは、 `obj` 逆シリアル化されたオブジェクトを参照します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-175">The `obj` parameter refers to the object that has been deserialized.</span></span> <span data-ttu-id="9d23f-176">オブジェクトがサロゲートされている場合、オブジェクトを変換して元の型に戻すことができます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-176">The object can be converted back to its original type if it is surrogated.</span></span> <span data-ttu-id="9d23f-177">サロゲートがオブジェクトを処理しない場合、このメソッドは入力オブジェクトを返します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-177">This method returns the input object if the surrogate does not handle the object.</span></span> <span data-ttu-id="9d23f-178">それ以外の場合は、変換が完了すると、逆シリアル化されたオブジェクトが返されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-178">Otherwise, the deserialized object will be returned once its conversion has been completed.</span></span> <span data-ttu-id="9d23f-179">複数のサロゲート型が存在する場合、各型とその変換を示すことにより、サロゲートからそれぞれのプライマリ型へのデータ変換を提供できます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-179">If several surrogate types exist, you may provide data conversion from surrogate to primary type for each by indicating each type and its conversion.</span></span>  
  
 <span data-ttu-id="9d23f-180">オブジェクトを返す場合、このサロゲートによって返されたオブジェクトで内部オブジェクト テーブルが更新されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-180">When returning an object, the internal object tables are updated with the object returned by this surrogate.</span></span> <span data-ttu-id="9d23f-181">インスタンスへの以降の参照では、このオブジェクト テーブルからサロゲートされたインスタンスが取得されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-181">Any subsequent references to an instance will obtain the surrogated instance from the object tables.</span></span>  
  
 <span data-ttu-id="9d23f-182">前の例では、`InventorySurrogated` 型のオブジェクトが最初の `Inventory` 型に変換されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-182">The previous example converts objects of type `InventorySurrogated` back to the initial type `Inventory`.</span></span> <span data-ttu-id="9d23f-183">この場合、データは `InventorySurrogated` から `Inventory` の対応するフィールドに直接転送されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-183">In this case, data is directly transferred back from `InventorySurrogated` to its corresponding fields in `Inventory`.</span></span> <span data-ttu-id="9d23f-184">データ操作は発生しないため、各メンバー フィールドにはシリアル化前と同じ値が格納されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-184">Because there are no data manipulations, the each of the member fields will contain the same values as before the serialization.</span></span>  
  
### <a name="getcustomdatatoexport-method"></a><span data-ttu-id="9d23f-185">GetCustomDataToExport Method</span><span class="sxs-lookup"><span data-stu-id="9d23f-185">GetCustomDataToExport Method</span></span>  

 <span data-ttu-id="9d23f-186">スキーマをエクスポートする場合、<xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A> メソッドは省略可能です。</span><span class="sxs-lookup"><span data-stu-id="9d23f-186">When exporting a schema, the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A> method is optional.</span></span> <span data-ttu-id="9d23f-187">このメソッドは、エクスポートするスキーマに追加データやヒントを挿入するために使用します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-187">It is used to insert additional data or hints into the exported schema.</span></span> <span data-ttu-id="9d23f-188">追加データは、メンバー レベルまたは型レベルで挿入できます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-188">Additional data can be inserted at the member level or type level.</span></span> <span data-ttu-id="9d23f-189">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-189">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#6)]  
  
 <span data-ttu-id="9d23f-190">このメソッド (2 つのオーバーロードを持ちます) を使用すると、メンバー レベルまたは型レベルで、追加情報をメタデータに含めることができます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-190">This method (with two overloads) enables the inclusion of extra information into the metadata either at the member or type level.</span></span> <span data-ttu-id="9d23f-191">メンバーが public と private のどちらであるかに関するヒントや、スキーマのエクスポートとインポート全体を通じて保持されるコメントを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-191">It is possible to include hints about whether a member is public or private, and comments which would be preserved throughout the export and import of the schema.</span></span> <span data-ttu-id="9d23f-192">このメソッドを使用しない場合、このような情報は失われます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-192">Such information would be lost without this method.</span></span> <span data-ttu-id="9d23f-193">このメソッドは、メンバーまたは型の挿入や削除を行うのではなく、メンバー レベルまたは型レベルでスキーマに付加的なデータを追加します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-193">This method does not cause the insertion or deletion of members or types, but rather adds additional data to the schemas at either of these levels.</span></span>  
  
 <span data-ttu-id="9d23f-194">このメソッドのオーバーロードでは、`Type` (`clrtype` パラメーター) または <xref:System.Reflection.MemberInfo> (`memberInfo` パラメーター) を取得できます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-194">The method is overloaded and can take either a `Type` (`clrtype` parameter) or <xref:System.Reflection.MemberInfo> (`memberInfo` parameter).</span></span> <span data-ttu-id="9d23f-195">2 番目のパラメーターは、常に `Type` (`dataContractType` パラメーター) です。</span><span class="sxs-lookup"><span data-stu-id="9d23f-195">The second parameter is always a `Type` (`dataContractType` parameter).</span></span> <span data-ttu-id="9d23f-196">このメソッドは、サロゲートされた `dataContractType` 型のすべてのメンバーと型に対して呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-196">This method is called for every member and type of the surrogated `dataContractType` type.</span></span>  
  
 <span data-ttu-id="9d23f-197">どちらのオーバーロードでも、`null` またはシリアル化可能なオブジェクトを返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="9d23f-197">Either of these overloads must return either `null` or a serializable object.</span></span> <span data-ttu-id="9d23f-198">null 以外のオブジェクトは、エクスポートするスキーマに注釈としてシリアル化されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-198">A non-null object will be serialized as annotation into the exported schema.</span></span> <span data-ttu-id="9d23f-199">`Type` オーバーロードでは、スキーマにエクスポートされる各型は、`dataContractType` パラメーターのサロゲートされた型と共に、最初のパラメーターでこのメソッドに送信されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-199">For the `Type` overload, each type that is exported to schema is sent to this method in the first parameter along with the surrogated type as the `dataContractType` parameter.</span></span> <span data-ttu-id="9d23f-200">`MemberInfo` オーバーロードでは、スキーマにエクスポートされる各メンバーが、2 番目のパラメーターのサロゲートされた型と共に `memberInfo` パラメーターとして情報を送信します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-200">For the `MemberInfo` overload, each member that is exported to schema sends its information as the `memberInfo` parameter with the surrogated type in the second parameter.</span></span>  
  
#### <a name="getcustomdatatoexport-method-type-type"></a><span data-ttu-id="9d23f-201">GetCustomDataToExport Method (Type, Type)</span><span class="sxs-lookup"><span data-stu-id="9d23f-201">GetCustomDataToExport Method (Type, Type)</span></span>  

 <span data-ttu-id="9d23f-202"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Type%2CSystem.Type%29?displayProperty=nameWithType> メソッドは、すべての型定義のスキーマのエクスポート中に呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-202">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Type%2CSystem.Type%29?displayProperty=nameWithType> method is called during schema export for every type definition.</span></span> <span data-ttu-id="9d23f-203">このメソッドは、エクスポート時にスキーマ内の型に情報を追加します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-203">The method adds information to the types within the schema when exporting.</span></span> <span data-ttu-id="9d23f-204">スキーマに含める必要のある追加データがあるかどうかを確認するために、定義済みの各型がこのメソッドに送信されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-204">Each type defined is sent to this method to determine whether there is any additional data that needs to be included in the schema.</span></span>  
  
#### <a name="getcustomdatatoexport-method-memberinfo-type"></a><span data-ttu-id="9d23f-205">GetCustomDataToExport Method (MemberInfo, Type)</span><span class="sxs-lookup"><span data-stu-id="9d23f-205">GetCustomDataToExport Method (MemberInfo, Type)</span></span>  

 <span data-ttu-id="9d23f-206"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Reflection.MemberInfo%2CSystem.Type%29?displayProperty=nameWithType> は、エクスポートする型のすべてのメンバーのエクスポート中に呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-206">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Reflection.MemberInfo%2CSystem.Type%29?displayProperty=nameWithType> is called during export for every member in the types that are exported.</span></span> <span data-ttu-id="9d23f-207">この関数を使用すると、エクスポート時にスキーマに含めるメンバーに関するコメントをカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-207">This function enables you to customize any comments for the members that will be included in the schema upon export.</span></span> <span data-ttu-id="9d23f-208">スキーマに付加的なデータを追加する必要があるかどうかをチェックするために、クラスの各メンバーの情報がこのメソッドに送信されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-208">The information for every member within the class is sent to this method to check whether any additional data need to be added in the schema.</span></span>  
  
 <span data-ttu-id="9d23f-209">前述の例では、サロゲートの各メンバーの `dataContractType` が検索されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-209">The example above searches through the `dataContractType` for each member of the surrogate.</span></span> <span data-ttu-id="9d23f-210">検索後、各フィールドの適切なアクセス修飾子が返されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-210">It then returns the appropriate access modifier for each field.</span></span> <span data-ttu-id="9d23f-211">このカスタマイズを行わない場合、アクセス修飾子の既定値は public です。</span><span class="sxs-lookup"><span data-stu-id="9d23f-211">Without this customization, the default value for access modifiers is public.</span></span> <span data-ttu-id="9d23f-212">したがって、実際のアクセス制限には関係なく、エクスポートされたスキーマを使用して生成されるコードでは、すべてのメンバーが public として定義されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-212">Therefore, all members would be defined as public in the code generated using the exported schema no matter what their actual access restrictions are.</span></span> <span data-ttu-id="9d23f-213">この実装を使用しない場合、`numpens` メンバーは、サロゲートで private として定義されている場合でも、エクスポートされたスキーマでは public になります。</span><span class="sxs-lookup"><span data-stu-id="9d23f-213">When not using this implementation, the member `numpens` would be public in the exported schema even though it was defined in the surrogate as private.</span></span> <span data-ttu-id="9d23f-214">このメソッドを使用することにより、エクスポートされるスキーマで、アクセス修飾子を private として生成できます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-214">Through the use of this method, in the exported schema, the access modifier can be generated as private.</span></span>  
  
### <a name="getreferencedtypeonimport-method"></a><span data-ttu-id="9d23f-215">GetReferencedTypeOnImport Method</span><span class="sxs-lookup"><span data-stu-id="9d23f-215">GetReferencedTypeOnImport Method</span></span>  

 <span data-ttu-id="9d23f-216">このメソッドは、サロゲートの <xref:System.Type> を元の型に割り当てます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-216">This method maps the <xref:System.Type> of the surrogate to the original type.</span></span> <span data-ttu-id="9d23f-217">スキーマのインポートでは、このメソッドは省略可能です。</span><span class="sxs-lookup"><span data-stu-id="9d23f-217">This method is optional for schema importation.</span></span>  
  
 <span data-ttu-id="9d23f-218">スキーマをインポートし、そのコードを生成するサロゲートを作成したら、次のタスクとして、元の型に対してサロゲート インスタンスの型を定義します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-218">When creating a surrogate that imports a schema and generates code for it, the next task is to define the type of a surrogate instance to its original type.</span></span>  
  
 <span data-ttu-id="9d23f-219">生成されるコードで既存のユーザー型を参照する必要がある場合は、<xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> メソッドを実装してこれを行います。</span><span class="sxs-lookup"><span data-stu-id="9d23f-219">If the generated code needs to reference an existing user type, this is done by implementing the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> method.</span></span>  
  
 <span data-ttu-id="9d23f-220">スキーマをインポートするときに、サロゲートされたデータ コントラクトを型に割り当てるために、すべての型宣言に対してこのメソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-220">When importing a schema, this method is called for every type declaration to map the surrogated data contract to a type.</span></span> <span data-ttu-id="9d23f-221">`typeName` および `typeNamespace` の各文字列パラメーターでは、サロゲートされた型の名前と名前空間が定義されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-221">The string parameters `typeName` and `typeNamespace` define the name and namespace of the surrogated type.</span></span> <span data-ttu-id="9d23f-222"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> の戻り値は、新しい型を生成する必要があるかどうかを判断するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-222">The return value for <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> is used to determine whether a new type needs to be generated.</span></span> <span data-ttu-id="9d23f-223">このメソッドは、有効な型または null のいずれかを返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="9d23f-223">This method must return either a valid type or null.</span></span> <span data-ttu-id="9d23f-224">有効な型を返す場合、返される型は生成されるコード内で参照される型として使用されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-224">For valid types, the type returned will be used as a referenced type in the generated code.</span></span> <span data-ttu-id="9d23f-225">null を返す場合は、型が参照されることはないため、新しい型を作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9d23f-225">If null is returned, no type will be referenced and a new type must be created.</span></span> <span data-ttu-id="9d23f-226">複数のサロゲートが存在する場合は、各サロゲート型から最初の型へのマッピングを実行できます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-226">If several surrogates exist, it is possible to perform the mapping for each surrogate type back to its initial type.</span></span>  
  
 <span data-ttu-id="9d23f-227">`customData` パラメーターは、<xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A> から最初に返されたオブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="9d23f-227">The `customData` parameter is the object originally returned from <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A>.</span></span> <span data-ttu-id="9d23f-228">この `customData` は、サロゲート作成者が、コードを生成するためにインポート時に使用するメタデータに追加情報やヒントを挿入する場合に使用します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-228">This `customData` is used when surrogate authors want to insert extra data/hints into the metadata to use during import to generate code.</span></span>  
  
### <a name="processimportedtype-method"></a><span data-ttu-id="9d23f-229">ProcessImportedType メソッド</span><span class="sxs-lookup"><span data-stu-id="9d23f-229">ProcessImportedType Method</span></span>  

 <span data-ttu-id="9d23f-230"><xref:System.Runtime.Serialization.IDataContractSurrogate.ProcessImportedType%2A> メソッドは、スキーマのインポートから作成された型をカスタマイズします。</span><span class="sxs-lookup"><span data-stu-id="9d23f-230">The <xref:System.Runtime.Serialization.IDataContractSurrogate.ProcessImportedType%2A> method customizes any type created from schema importation.</span></span> <span data-ttu-id="9d23f-231">このメソッドは省略可能です。</span><span class="sxs-lookup"><span data-stu-id="9d23f-231">This method is optional.</span></span>  
  
 <span data-ttu-id="9d23f-232">スキーマをインポートするときに、このメソッドを使用すると、インポートする型とコンパイルの情報をカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-232">When importing a schema, this method allows for any imported type and compilation information to be customized.</span></span> <span data-ttu-id="9d23f-233">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-233">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#7)]  
  
 <span data-ttu-id="9d23f-234">インポート中に、このメソッドは生成されるすべての型に対して呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-234">During import, this method is called for every type generated.</span></span> <span data-ttu-id="9d23f-235">指定した <xref:System.CodeDom.CodeTypeDeclaration> を変更するか、<xref:System.CodeDom.CodeCompileUnit> を変更します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-235">Change the specified <xref:System.CodeDom.CodeTypeDeclaration> or modify the <xref:System.CodeDom.CodeCompileUnit>.</span></span> <span data-ttu-id="9d23f-236">これには、`CodeTypeDeclaration` の名前、メンバー、属性、および他のさまざまなプロパティの変更が含まれます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-236">This includes changing the name, members, attributes, and many other properties of the `CodeTypeDeclaration`.</span></span> <span data-ttu-id="9d23f-237">`CodeCompileUnit` を処理することにより、ディレクティブ、名前空間、参照アセンブリ、および他のいくつかの側面を変更できます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-237">By processing the `CodeCompileUnit`, it is possible to modify the directives, namespaces, referenced assemblies, and several other aspects.</span></span>  
  
 <span data-ttu-id="9d23f-238">`CodeTypeDeclaration` パラメーターには、DOM コードの型宣言が含まれます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-238">The `CodeTypeDeclaration` parameter contains the code DOM type declaration.</span></span> <span data-ttu-id="9d23f-239">`CodeCompileUnit` パラメーターでは、コードの処理に関する変更を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-239">The `CodeCompileUnit` parameter allows for modification for processing the code.</span></span>  <span data-ttu-id="9d23f-240">`null` を返すと、型宣言が破棄されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-240">Returning `null` results in the type declaration being discarded.</span></span> <span data-ttu-id="9d23f-241">`CodeTypeDeclaration` を返すと、変更が保持されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-241">Conversely, when returning a `CodeTypeDeclaration`, the modifications are preserved.</span></span>  
  
 <span data-ttu-id="9d23f-242">メタデータのエクスポート時にカスタム データを挿入した場合は、インポート時にこのデータをユーザーに提供して、データを使用できるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="9d23f-242">If custom data is inserted during metadata export, it needs to be provided to the user during import so that it can be used.</span></span> <span data-ttu-id="9d23f-243">このカスタム データは、プログラミング モデルのヒントやその他のコメントに使用できます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-243">This custom data can be used for programming model hints, or other comments.</span></span> <span data-ttu-id="9d23f-244">各 `CodeTypeDeclaration` と <xref:System.CodeDom.CodeTypeMember> インスタンスには、<xref:System.CodeDom.CodeObject.UserData%2A> 型にキャストされる `IDataContractSurrogate` プロパティとしてカスタム データが含まれます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-244">Each `CodeTypeDeclaration` and <xref:System.CodeDom.CodeTypeMember> instance includes custom data as the <xref:System.CodeDom.CodeObject.UserData%2A> property, cast to the `IDataContractSurrogate` type.</span></span>  
  
 <span data-ttu-id="9d23f-245">前述の例では、インポートするスキーマに対して変更が行われています。</span><span class="sxs-lookup"><span data-stu-id="9d23f-245">The example above performs some changes on the schema imported.</span></span> <span data-ttu-id="9d23f-246">コードでは、サロゲートを使用して元の型の private メンバーを保持しています。</span><span class="sxs-lookup"><span data-stu-id="9d23f-246">The code preserves private members of the original type by using a surrogate.</span></span> <span data-ttu-id="9d23f-247">スキーマをインポートするときの既定のアクセス修飾子は `public` です。</span><span class="sxs-lookup"><span data-stu-id="9d23f-247">The default access modifier when importing a schema is `public`.</span></span> <span data-ttu-id="9d23f-248">したがって、この例のように変更しない限り、サロゲート スキーマのすべてのメンバーは public になります。</span><span class="sxs-lookup"><span data-stu-id="9d23f-248">Therefore, all members of the surrogate schema will be public unless modified, as in this example.</span></span> <span data-ttu-id="9d23f-249">エクスポート中に、どのメンバーが private であるかに関するカスタム データがメタデータに挿入されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-249">During export, custom data is inserted into the metadata about which members are private.</span></span> <span data-ttu-id="9d23f-250">この例では、カスタム データを調べ、アクセス修飾子が private かどうかをチェックした後、属性を設定することで適切なメンバーを private に変更しています。</span><span class="sxs-lookup"><span data-stu-id="9d23f-250">The example looks up the custom data, checks whether the access modifier is private, and then modifies the appropriate member to be private by setting its attributes.</span></span> <span data-ttu-id="9d23f-251">このカスタマイズを行わない場合、`numpens` メンバーは、private ではなく public として定義されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-251">Without this customization, the `numpens` member would be defined as public instead of private.</span></span>  
  
### <a name="getknowncustomdatatypes-method"></a><span data-ttu-id="9d23f-252">GetKnownCustomDataTypes メソッド</span><span class="sxs-lookup"><span data-stu-id="9d23f-252">GetKnownCustomDataTypes Method</span></span>  

 <span data-ttu-id="9d23f-253">このメソッドは、スキーマから定義済みのカスタム データ型を取得します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-253">This method obtains custom data types defined from the schema.</span></span> <span data-ttu-id="9d23f-254">スキーマのインポートでは、このメソッドは省略可能です。</span><span class="sxs-lookup"><span data-stu-id="9d23f-254">The method is optional for schema importation.</span></span>  
  
 <span data-ttu-id="9d23f-255">このメソッドは、スキーマのエクスポートとインポートの開始時に呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-255">The method is called at the beginning of schema export and import.</span></span> <span data-ttu-id="9d23f-256">このメソッドは、エクスポートまたはインポートするスキーマで使用されるカスタム データ型を返します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-256">The method returns the custom data types used in the schema exported or imported.</span></span> <span data-ttu-id="9d23f-257">メソッドには、型のコレクションである <xref:System.Collections.ObjectModel.Collection%601> (`customDataTypes` パラメーター) が渡されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-257">The method is passed a <xref:System.Collections.ObjectModel.Collection%601> (the `customDataTypes` parameter), which is a collection of types.</span></span> <span data-ttu-id="9d23f-258">このメソッドでは、既知の型をこのコレクションに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9d23f-258">The method should add additional known types to this collection.</span></span> <span data-ttu-id="9d23f-259">既知のカスタム データ型は、<xref:System.Runtime.Serialization.DataContractSerializer> を使用したカスタム データのシリアル化と逆シリアル化を可能にするために必要となります。</span><span class="sxs-lookup"><span data-stu-id="9d23f-259">The known custom data types are needed to enable serialization and deserialization of custom data using the <xref:System.Runtime.Serialization.DataContractSerializer>.</span></span> <span data-ttu-id="9d23f-260">詳細については、「 [データコントラクトの既知の型](../feature-details/data-contract-known-types.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9d23f-260">For more information, see [Data Contract Known Types](../feature-details/data-contract-known-types.md).</span></span>  
  
## <a name="implementing-a-surrogate"></a><span data-ttu-id="9d23f-261">サロゲートの実装</span><span class="sxs-lookup"><span data-stu-id="9d23f-261">Implementing a Surrogate</span></span>  

 <span data-ttu-id="9d23f-262">WCF 内でデータコントラクトサロゲートを使用するには、いくつかの特別な手順に従う必要があります。</span><span class="sxs-lookup"><span data-stu-id="9d23f-262">To use the data contract surrogate within WCF, you must follow a few special procedures.</span></span>  
  
### <a name="to-use-a-surrogate-for-serialization-and-deserialization"></a><span data-ttu-id="9d23f-263">シリアル化と逆シリアル化にサロゲートを使用するには</span><span class="sxs-lookup"><span data-stu-id="9d23f-263">To Use a Surrogate for Serialization and Deserialization</span></span>  

 <span data-ttu-id="9d23f-264">サロゲートを使用してデータのシリアル化と逆シリアル化を実行するには、<xref:System.Runtime.Serialization.DataContractSerializer> を使用します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-264">Use the <xref:System.Runtime.Serialization.DataContractSerializer> to perform serialization and deserialization of data with the surrogate.</span></span> <span data-ttu-id="9d23f-265"><xref:System.Runtime.Serialization.DataContractSerializer> は、<xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> によって作成されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-265">The <xref:System.Runtime.Serialization.DataContractSerializer> is created by the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>.</span></span> <span data-ttu-id="9d23f-266">サロゲートも指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9d23f-266">The surrogate must also be specified.</span></span>  
  
##### <a name="to-implement-serialization-and-deserialization"></a><span data-ttu-id="9d23f-267">シリアル化と逆シリアル化を実装するには</span><span class="sxs-lookup"><span data-stu-id="9d23f-267">To implement serialization and deserialization</span></span>  
  
1. <span data-ttu-id="9d23f-268">サービスの <xref:System.ServiceModel.ServiceHost> のインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-268">Create an instance of the <xref:System.ServiceModel.ServiceHost> for your service.</span></span> <span data-ttu-id="9d23f-269">詳しい手順については、「 [基本的な WCF プログラミング](../basic-wcf-programming.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9d23f-269">For complete instructions, see [Basic WCF Programming](../basic-wcf-programming.md).</span></span>  
  
2. <span data-ttu-id="9d23f-270">指定したサービス ホストの各 <xref:System.ServiceModel.Description.ServiceEndpoint> について、<xref:System.ServiceModel.Description.OperationDescription> を検索します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-270">For every <xref:System.ServiceModel.Description.ServiceEndpoint> of the specified service host, find its <xref:System.ServiceModel.Description.OperationDescription>.</span></span>  
  
3. <span data-ttu-id="9d23f-271">操作の動作を検索して、<xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> のインスタンスが見つかるかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-271">Search through the operation behaviors to determine if an instance of the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found.</span></span>  
  
4. <span data-ttu-id="9d23f-272"><xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> が見つかった場合、<xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> プロパティをサロゲートの新しいインスタンスに設定します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-272">If a <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found, set its <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> property to a new instance of the surrogate.</span></span> <span data-ttu-id="9d23f-273"><xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> が見つからなかった場合は、新しいインスタンスを作成し、新しい動作の <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> メンバーをサロゲートの新しいインスタンスに設定します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-273">If no <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found, then create a new instance and set the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> member of the new behavior to a new instance of the surrogate.</span></span>  
  
5. <span data-ttu-id="9d23f-274">最後に、次の例に示すように、この新しい動作を現在の操作の動作に追加します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-274">Finally, add this new behavior to the current operation behaviors, as shown in the following example:</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#8)]  
  
### <a name="to-use-a-surrogate-for-metadata-import"></a><span data-ttu-id="9d23f-275">メタデータのインポートにサロゲートを使用するには</span><span class="sxs-lookup"><span data-stu-id="9d23f-275">To Use a Surrogate for Metadata Import</span></span>  

 <span data-ttu-id="9d23f-276">WSDL や XSD などのメタデータをインポートしてクライアント側のコードを生成する場合、XSD スキーマからコードを生成するコンポーネント (<xref:System.Runtime.Serialization.XsdDataContractImporter>) にサロゲートを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9d23f-276">When importing metadata like WSDL and XSD to generate client-side code, the surrogate needs to be added to the component responsible for generating code from XSD schema, <xref:System.Runtime.Serialization.XsdDataContractImporter>.</span></span> <span data-ttu-id="9d23f-277">これを行うには、メタデータをインポートする際に使用する <xref:System.ServiceModel.Description.WsdlImporter> を直接変更します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-277">To do this, directly modify the <xref:System.ServiceModel.Description.WsdlImporter> used to import metadata.</span></span>  
  
##### <a name="to-implement-a-surrogate-for-metadata-importation"></a><span data-ttu-id="9d23f-278">メタデータのインポートに使用するサロゲートを実装するには</span><span class="sxs-lookup"><span data-stu-id="9d23f-278">To implement a surrogate for metadata importation</span></span>  
  
1. <span data-ttu-id="9d23f-279"><xref:System.ServiceModel.Description.WsdlImporter> クラスを使用して、メタデータをインポートします。</span><span class="sxs-lookup"><span data-stu-id="9d23f-279">Import the metadata using the <xref:System.ServiceModel.Description.WsdlImporter> class.</span></span>  
  
2. <span data-ttu-id="9d23f-280"><xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> メソッドを使用して、<xref:System.Runtime.Serialization.XsdDataContractImporter> が定義されているかどうかをチェックします。</span><span class="sxs-lookup"><span data-stu-id="9d23f-280">Use the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method to check whether an <xref:System.Runtime.Serialization.XsdDataContractImporter> has been defined.</span></span>  
  
3. <span data-ttu-id="9d23f-281"><xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> メソッドが `false` を返した場合、新しい <xref:System.Runtime.Serialization.XsdDataContractImporter> を作成し、<xref:System.Runtime.Serialization.XsdDataContractImporter.Options%2A> プロパティを <xref:System.Runtime.Serialization.ImportOptions> クラスの新しいインスタンスに設定します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-281">If the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method returns `false`, create a new <xref:System.Runtime.Serialization.XsdDataContractImporter> and set its <xref:System.Runtime.Serialization.XsdDataContractImporter.Options%2A> property to a new instance of the <xref:System.Runtime.Serialization.ImportOptions> class.</span></span> <span data-ttu-id="9d23f-282">それ以外の場合は、`out` メソッドの <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> パラメーターによって返されたインポーターを使用します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-282">Otherwise, use the importer returned by the `out` parameter of the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method.</span></span>  
  
4. <span data-ttu-id="9d23f-283"><xref:System.Runtime.Serialization.XsdDataContractImporter> に <xref:System.Runtime.Serialization.ImportOptions> が定義されていない場合は、このプロパティを <xref:System.Runtime.Serialization.ImportOptions> クラスの新しいインスタンスとして設定します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-283">If the <xref:System.Runtime.Serialization.XsdDataContractImporter> has no <xref:System.Runtime.Serialization.ImportOptions> defined, then set the property to be a new instance of the <xref:System.Runtime.Serialization.ImportOptions> class.</span></span>  
  
5. <span data-ttu-id="9d23f-284"><xref:System.Runtime.Serialization.ImportOptions.DataContractSurrogate%2A> の <xref:System.Runtime.Serialization.ImportOptions> の <xref:System.Runtime.Serialization.XsdDataContractImporter> プロパティを、サロゲートの新しいインスタンスに設定します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-284">Set the <xref:System.Runtime.Serialization.ImportOptions.DataContractSurrogate%2A> property of the <xref:System.Runtime.Serialization.ImportOptions> of the <xref:System.Runtime.Serialization.XsdDataContractImporter> to a new instance of the surrogate.</span></span>  
  
6. <span data-ttu-id="9d23f-285"><xref:System.Runtime.Serialization.XsdDataContractImporter> クラスから継承した <xref:System.ServiceModel.Description.MetadataExporter.State%2A> の <xref:System.ServiceModel.Description.WsdlImporter> プロパティによって返されたコレクションに、<xref:System.ServiceModel.Description.MetadataExporter> を追加します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-285">Add the <xref:System.Runtime.Serialization.XsdDataContractImporter> to the collection returned by the <xref:System.ServiceModel.Description.MetadataExporter.State%2A> property of the <xref:System.ServiceModel.Description.WsdlImporter> (inherited from the <xref:System.ServiceModel.Description.MetadataExporter> class.)</span></span>  
  
7. <span data-ttu-id="9d23f-286"><xref:System.ServiceModel.Description.WsdlImporter.ImportAllContracts%2A> の <xref:System.ServiceModel.Description.WsdlImporter> メソッドを使用して、スキーマ内のすべてのデータ コントラクトをインポートします。</span><span class="sxs-lookup"><span data-stu-id="9d23f-286">Use the <xref:System.ServiceModel.Description.WsdlImporter.ImportAllContracts%2A> method of the <xref:System.ServiceModel.Description.WsdlImporter> to import all of the data contracts within the schema.</span></span> <span data-ttu-id="9d23f-287">この最後の手順で、サロゲートを呼び出すことによって読み込まれたスキーマからコードが生成されます。</span><span class="sxs-lookup"><span data-stu-id="9d23f-287">During the last step, code is generated from the schemas loaded by calling into the surrogate.</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#9)]  
  
### <a name="to-use-a-surrogate-for-metadata-export"></a><span data-ttu-id="9d23f-288">メタデータのエクスポートにサロゲートを使用するには</span><span class="sxs-lookup"><span data-stu-id="9d23f-288">To Use a surrogate for Metadata Export</span></span>  

 <span data-ttu-id="9d23f-289">既定では、サービスの WCF からメタデータをエクスポートするときに、WSDL スキーマと XSD スキーマの両方を生成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9d23f-289">By default, when exporting metadata from WCF for a service, both WSDL and XSD schema needs to be generated.</span></span> <span data-ttu-id="9d23f-290">データ コントラクト型の XSD スキーマを生成するコンポーネント (<xref:System.Runtime.Serialization.XsdDataContractExporter>) に、サロゲートを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9d23f-290">The surrogate needs to be added to the component responsible for generating XSD schema for data contract types, <xref:System.Runtime.Serialization.XsdDataContractExporter>.</span></span> <span data-ttu-id="9d23f-291">これを行うには、<xref:System.ServiceModel.Description.IWsdlExportExtension> を実装する動作を使用して <xref:System.ServiceModel.Description.WsdlExporter> を変更するか、メタデータをエクスポートする際に使用する <xref:System.ServiceModel.Description.WsdlExporter> を直接変更します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-291">To do this, either use a behavior that implements <xref:System.ServiceModel.Description.IWsdlExportExtension> to modify the <xref:System.ServiceModel.Description.WsdlExporter>, or directly modify the <xref:System.ServiceModel.Description.WsdlExporter> used to export metadata.</span></span>  
  
##### <a name="to-use-a-surrogate-for-metadata-export"></a><span data-ttu-id="9d23f-292">メタデータのエクスポートにサロゲートを使用するには</span><span class="sxs-lookup"><span data-stu-id="9d23f-292">To use a surrogate for metadata export</span></span>  
  
1. <span data-ttu-id="9d23f-293">新しい <xref:System.ServiceModel.Description.WsdlExporter> を作成するか、`wsdlExporter` メソッドに渡された <xref:System.ServiceModel.Description.IWsdlExportExtension.ExportContract%2A> パラメーターを使用します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-293">Create a new <xref:System.ServiceModel.Description.WsdlExporter> or use the `wsdlExporter` parameter passed to the <xref:System.ServiceModel.Description.IWsdlExportExtension.ExportContract%2A> method.</span></span>  
  
2. <span data-ttu-id="9d23f-294"><xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> 関数を使用して、<xref:System.Runtime.Serialization.XsdDataContractExporter> が定義されているかどうかをチェックします。</span><span class="sxs-lookup"><span data-stu-id="9d23f-294">Use the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> function to check whether an <xref:System.Runtime.Serialization.XsdDataContractExporter> has been defined.</span></span>  
  
3. <span data-ttu-id="9d23f-295"><xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> が `false` を返した場合、<xref:System.Runtime.Serialization.XsdDataContractExporter> から生成された XML スキーマを使用して新しい <xref:System.ServiceModel.Description.WsdlExporter> を作成し、<xref:System.ServiceModel.Description.MetadataExporter.State%2A> の <xref:System.ServiceModel.Description.WsdlExporter> プロパティによって返されたコレクションに追加します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-295">If <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> returns `false`, create a new <xref:System.Runtime.Serialization.XsdDataContractExporter> with the generated XML schemas from the <xref:System.ServiceModel.Description.WsdlExporter>, and add it to the collection returned by the <xref:System.ServiceModel.Description.MetadataExporter.State%2A> property of the <xref:System.ServiceModel.Description.WsdlExporter>.</span></span> <span data-ttu-id="9d23f-296">それ以外の場合は、`out` メソッドの <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> パラメーターによって返されたエクスポーターを使用します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-296">Otherwise, use the exporter returned by the `out` parameter of the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method.</span></span>  
  
4. <span data-ttu-id="9d23f-297"><xref:System.Runtime.Serialization.XsdDataContractExporter> に <xref:System.Runtime.Serialization.ExportOptions> が定義されていない場合は、<xref:System.Runtime.Serialization.XsdDataContractExporter.Options%2A> プロパティを <xref:System.Runtime.Serialization.ExportOptions> クラスの新しいインスタンスに設定します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-297">If the <xref:System.Runtime.Serialization.XsdDataContractExporter> has no <xref:System.Runtime.Serialization.ExportOptions> defined, then set the <xref:System.Runtime.Serialization.XsdDataContractExporter.Options%2A> property to a new instance of the <xref:System.Runtime.Serialization.ExportOptions> class.</span></span>  
  
5. <span data-ttu-id="9d23f-298"><xref:System.Runtime.Serialization.ExportOptions.DataContractSurrogate%2A> の <xref:System.Runtime.Serialization.ExportOptions> の <xref:System.Runtime.Serialization.XsdDataContractExporter> プロパティを、サロゲートの新しいインスタンスに設定します。</span><span class="sxs-lookup"><span data-stu-id="9d23f-298">Set the <xref:System.Runtime.Serialization.ExportOptions.DataContractSurrogate%2A> property of the <xref:System.Runtime.Serialization.ExportOptions> of the <xref:System.Runtime.Serialization.XsdDataContractExporter> to a new instance of the surrogate.</span></span> <span data-ttu-id="9d23f-299">メタデータをエクスポートするための以降の手順を変更する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="9d23f-299">Subsequent steps for exporting metadata do not require any changes.</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#10)]  
  
## <a name="see-also"></a><span data-ttu-id="9d23f-300">関連項目</span><span class="sxs-lookup"><span data-stu-id="9d23f-300">See also</span></span>

- <xref:System.Runtime.Serialization.DataContractSerializer>
- <xref:System.Runtime.Serialization.IDataContractSurrogate>
- <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>
- <xref:System.Runtime.Serialization.ImportOptions>
- <xref:System.Runtime.Serialization.ExportOptions>
- [<span data-ttu-id="9d23f-301">データ コントラクトの使用</span><span class="sxs-lookup"><span data-stu-id="9d23f-301">Using Data Contracts</span></span>](../feature-details/using-data-contracts.md)
