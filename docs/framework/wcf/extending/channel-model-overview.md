---
description: '詳細情報: チャネルモデルの概要'
title: チャネル モデルの概要
ms.date: 03/30/2017
helpviewer_keywords:
- channel model [WCF]
ms.assetid: 07a81e11-3911-4632-90d2-cca99825b5bd
ms.openlocfilehash: 8b22c2b957eec6e3b52a84c7a30d4a17c41293e6
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99685882"
---
# <a name="channel-model-overview"></a><span data-ttu-id="bb82d-103">チャネル モデルの概要</span><span class="sxs-lookup"><span data-stu-id="bb82d-103">Channel Model Overview</span></span>

<span data-ttu-id="bb82d-104">Windows Communication Foundation (WCF) チャネルスタックは、メッセージを処理する1つ以上のチャネルを持つ階層化された通信スタックです。</span><span class="sxs-lookup"><span data-stu-id="bb82d-104">The Windows Communication Foundation (WCF) channel stack is a layered communication stack with one or more channels that process messages.</span></span> <span data-ttu-id="bb82d-105">スタックの一番下には、基になるトランスポート (TCP、HTTP、SMTP、およびその他の種類のトランスポート) にチャネル スタックを適応させるためのトランスポート チャネルがあります。</span><span class="sxs-lookup"><span data-stu-id="bb82d-105">At the bottom of the stack is a transport channel that is responsible for adapting the channel stack to the underlying transport (for example, TCP, HTTP, SMTP and other types of transport.).</span></span> <span data-ttu-id="bb82d-106">チャネルによって、メッセージを送受信するための低レベルのプログラミング モデルが提供されます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-106">Channels provide a low-level programming model for sending and receiving messages.</span></span> <span data-ttu-id="bb82d-107">このプログラミングモデルは、WCF チャネルモデルと総称されるいくつかのインターフェイスとその他の型に依存しています。</span><span class="sxs-lookup"><span data-stu-id="bb82d-107">This programming model relies on several interfaces and other types collectively known as the WCF channel model.</span></span> <span data-ttu-id="bb82d-108">このトピックでは、チャネル形状、基本的なチャネル リスナーの構築 (サービス側)、およびチャネル ファクトリ (クライアント側) について説明します。</span><span class="sxs-lookup"><span data-stu-id="bb82d-108">This topic discusses channel shapes, the construction of a basic channel listener (on the service) and channel factory (on the client).</span></span>  
  
## <a name="channel-stack"></a><span data-ttu-id="bb82d-109">チャネル スタック</span><span class="sxs-lookup"><span data-stu-id="bb82d-109">Channel Stack</span></span>  

 <span data-ttu-id="bb82d-110">WCF エンドポイントは、チャネルスタックと呼ばれる通信スタックを使用して世界と通信します。</span><span class="sxs-lookup"><span data-stu-id="bb82d-110">WCF endpoints communicate with the world using a communication stack called the channel stack.</span></span> <span data-ttu-id="bb82d-111">次の図では、チャネル スタックと、TCP/IP などの他の通信スタックを比較します。</span><span class="sxs-lookup"><span data-stu-id="bb82d-111">The following diagram compares the channel stack with other communication stacks, for example TCP/IP.</span></span>  
  
 <span data-ttu-id="bb82d-112">![チャネルモデル](./media/wcfc-channelstackhighlevelc.gif "wcfc_ChannelStackHighLevelc")</span><span class="sxs-lookup"><span data-stu-id="bb82d-112">![Channel Model](./media/wcfc-channelstackhighlevelc.gif "wcfc_ChannelStackHighLevelc")</span></span>  
  
 <span data-ttu-id="bb82d-113">まず次のような類似点があります。いずれのスタックでも、スタックの各レイヤーにおいて、そのレイヤーより下の部分のアブストラクションと、直上のレイヤーだけに公開されるアブストラクションが提供されます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-113">First, the similarities: In both cases, each layer of the stack provides some abstraction of the world below that layer and exposed that abstraction only to the layer directly above it.</span></span> <span data-ttu-id="bb82d-114">各レイヤーでは、直下のレイヤーのアブストラクションだけが使用されます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-114">Each layer uses the abstraction of only the layer directly below it.</span></span> <span data-ttu-id="bb82d-115">また、いずれのスタックでも、2 つのスタックが通信するときは、各レイヤーがもう一方のスタック内の対応するレイヤーと通信します。たとえば、IP レイヤーは IP レイヤーと、TCP レイヤーは TCP レイヤーと通信します。</span><span class="sxs-lookup"><span data-stu-id="bb82d-115">Also in both cases, when two stacks communicate, each layer communicates with the corresponding layer in the other stack, for example, the IP layer communicates with the IP layer and the TCP layer with the TCP layer, and so on.</span></span>  
  
 <span data-ttu-id="bb82d-116">次に相違点です。TCP スタックは、物理ネットワークのアブストクラションを提供するように設計されていますが、チャネル スタックは、メッセージの配信方法、すなわちトランスポートのアブストラクションだけでなく、メッセージの内容や通信用のプロトコルなど、トランスポートとそれ以上の機能を含む他の機能のアブストラクションも提供するように設計されています。</span><span class="sxs-lookup"><span data-stu-id="bb82d-116">Now, the differences: While the TCP stack was designed to provide an abstraction of the physical network, the channel stack is designed to provide an abstraction of not only how the message is delivered, that is, the transport, but also other features such as what is in the message or what protocol is used for communication, including the transport but much more than that.</span></span> <span data-ttu-id="bb82d-117">たとえば、信頼できるセッションのバインド要素は、チャネル スタックの一部ですが、トランスポートの下位でもトランスポート自体でもありません。</span><span class="sxs-lookup"><span data-stu-id="bb82d-117">For example, reliable session binding element is part of the channel stack but is not below the transport or the transport itself.</span></span> <span data-ttu-id="bb82d-118">このアブストラクションは、スタック内の最下位チャネルに、基になるトランスポート プロトコルをチャネル スタック アーキテクチャに適応させるように要求し、スタック内の上位チャネルを利用して、信頼性の保証やセキュリティなどの通信機能を提供することによって、実現されます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-118">This abstraction is achieved by requiring the bottom channel in the stack to adapt the underlying transport protocol to the channel stack architecture and then relying on channels further up in the stack to provide communication features such as reliability guarantees and security.</span></span>  
  
 <span data-ttu-id="bb82d-119">メッセージは、通信スタックを通して、<xref:System.ServiceModel.Channels.Message> オブジェクトとして転送されます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-119">Messages flow through the communication stack as <xref:System.ServiceModel.Channels.Message> objects.</span></span> <span data-ttu-id="bb82d-120">上の図に示されているように、最下位チャネルはトランスポート チャネルと呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-120">As shown in figure above, the bottom channel is called a transport channel.</span></span> <span data-ttu-id="bb82d-121">このチャネルは、他のパーティとメッセージの送受信を行うチャンネルです。</span><span class="sxs-lookup"><span data-stu-id="bb82d-121">It is the channel that is responsible for sending and receiving messages to and from other parties.</span></span> <span data-ttu-id="bb82d-122">これには、他のパーティとの通信で使用されるフォーマットへの <xref:System.ServiceModel.Channels.Message> オブジェクトの変換が含まれます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-122">This includes the responsibility of transforming the <xref:System.ServiceModel.Channels.Message> object to and from the format used to communicate with other parties.</span></span> <span data-ttu-id="bb82d-123">トランスポート チャネルには、それぞれが信頼できる配信保証などの通信機能を提供する任意の数のプロトコル チャネルを設定することができます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-123">Above the transport channel there can be any number of protocol channels each responsible for providing a communication function such as reliable delivery guarantees.</span></span> <span data-ttu-id="bb82d-124">プロトコル チャネルは、<xref:System.ServiceModel.Channels.Message> オブジェクトの形式で転送されるメッセージに対して機能します。</span><span class="sxs-lookup"><span data-stu-id="bb82d-124">Protocol channels operate on messages flowing through them in the form of the <xref:System.ServiceModel.Channels.Message> object.</span></span> <span data-ttu-id="bb82d-125">通常プロトコル チャネルでは、メッセージの変換 (ヘッダーの付加、本文の暗号化など) や独自のプロトコル制御メッセージの送受信 (確認応答の受信など) が行われます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-125">They typically either transform the message, for example, by adding headers or encrypting the body, or send and receive their own protocol control messages, for example, receipt acknowledgments.</span></span>  
  
## <a name="channel-shapes"></a><span data-ttu-id="bb82d-126">チャネル形状</span><span class="sxs-lookup"><span data-stu-id="bb82d-126">Channel Shapes</span></span>  

 <span data-ttu-id="bb82d-127">各チャネルには、チャネル形状インターフェイスまたはチャネル形状と呼ばれる 1 つ以上のインターフェイスが実装されています。</span><span class="sxs-lookup"><span data-stu-id="bb82d-127">Each channel implements one or more interfaces known as channel shape interfaces or channel shapes.</span></span> <span data-ttu-id="bb82d-128">このようなチャネル形状によって、チャネルが実装し、チャネルのユーザーが呼び出す送受信や要求、応答などの通信指向のメソッドが提供されます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-128">Those channel shapes provide the communication-oriented methods such as send and receive or request and reply that the channel implements and the user of the channel calls.</span></span> <span data-ttu-id="bb82d-129">チャネル図形のベースでは <xref:System.ServiceModel.Channels.IChannel> インターフェイスです。これは、 `GetProperty` \<T> スタック内のチャネルによって公開される任意の機能にアクセスするためのレイヤー化された機構として使用するメソッドを提供するインターフェイスです。</span><span class="sxs-lookup"><span data-stu-id="bb82d-129">At the base of the channel shapes is the <xref:System.ServiceModel.Channels.IChannel> interface, which is an interface that provides a `GetProperty`\<T> method intended as a layered mechanism to access arbitrary features exposed by channels in the stack.</span></span> <span data-ttu-id="bb82d-130"><xref:System.ServiceModel.Channels.IChannel> を拡張する 5 つのチャネル形状は、次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="bb82d-130">The five channel shapes that extend <xref:System.ServiceModel.Channels.IChannel> are:</span></span>  
  
- <xref:System.ServiceModel.Channels.IInputChannel>  
  
- <xref:System.ServiceModel.Channels.IOutputChannel>  
  
- <xref:System.ServiceModel.Channels.IRequestChannel>  
  
- <xref:System.ServiceModel.Channels.IReplyChannel>  
  
- <xref:System.ServiceModel.Channels.IDuplexChannel>  
  
 <span data-ttu-id="bb82d-131">さらに、これらの形状には、それぞれ <xref:System.ServiceModel.Channels.ISessionChannel%601?displayProperty=nameWithType> を拡張してセッションをサポートする同等の形状があります。</span><span class="sxs-lookup"><span data-stu-id="bb82d-131">Further, each of these shapes has an equivalent that extends <xref:System.ServiceModel.Channels.ISessionChannel%601?displayProperty=nameWithType> to support sessions.</span></span> <span data-ttu-id="bb82d-132">次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="bb82d-132">These are:</span></span>  
  
- <xref:System.ServiceModel.Channels.IInputSessionChannel>  
  
- <xref:System.ServiceModel.Channels.IOutputSessionChannel>  
  
- <xref:System.ServiceModel.Channels.IRequestSessionChannel>  
  
- <xref:System.ServiceModel.Channels.IReplySessionChannel>  
  
- <xref:System.ServiceModel.Channels.IDuplexSessionChannel>  
  
 <span data-ttu-id="bb82d-133">チャネル形状は、既存のトランスポート プロトコルでサポートされている基本的なメッセージ交換パターンにならってパターン化されます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-133">The channel shapes are patterned after some of the fundamental message exchange patterns supported by existing transport protocols.</span></span> <span data-ttu-id="bb82d-134">たとえば、一方向メッセージングはペアに対応 <xref:System.ServiceModel.Channels.IInputChannel> / <xref:System.ServiceModel.Channels.IOutputChannel> し、要求/応答はペアに対応します。双方向通信は、との両方を拡張したものに <xref:System.ServiceModel.Channels.IRequestChannel> / <xref:System.ServiceModel.Channels.IReplyChannel> 対応し <xref:System.ServiceModel.Channels.IDuplexChannel> <xref:System.ServiceModel.Channels.IInputChannel> <xref:System.ServiceModel.Channels.IOutputChannel> ます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-134">For example, one-way messaging corresponds to an <xref:System.ServiceModel.Channels.IInputChannel>/<xref:System.ServiceModel.Channels.IOutputChannel> pair, request-reply corresponds to <xref:System.ServiceModel.Channels.IRequestChannel>/<xref:System.ServiceModel.Channels.IReplyChannel> pairs and two-way duplex communications corresponds to <xref:System.ServiceModel.Channels.IDuplexChannel> (which extends both <xref:System.ServiceModel.Channels.IInputChannel> and <xref:System.ServiceModel.Channels.IOutputChannel>).</span></span>  
  
## <a name="programming-with-the-channel-stack"></a><span data-ttu-id="bb82d-135">チャネル スタックを使用したプログラミング</span><span class="sxs-lookup"><span data-stu-id="bb82d-135">Programming with the Channel Stack</span></span>  

 <span data-ttu-id="bb82d-136">通常、チャネル スタックは、バインドによってチャネル スタックが作成されるファクトリ パターンを使用して作成されます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-136">Channel stacks are typically created using a factory pattern where a binding creates the channel stack.</span></span> <span data-ttu-id="bb82d-137">送信側では、バインドを使用して <xref:System.ServiceModel.ChannelFactory> が作成されます。これにより、次々にチャネル スタックが作成され、スタック内の最上位チャネルへの参照が返されます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-137">On the send side, a binding is used to build a <xref:System.ServiceModel.ChannelFactory>, which in turn builds a channel stack and returns a reference to the top channel in the stack.</span></span> <span data-ttu-id="bb82d-138">アプリケーションは、このチャネルを使用して、メッセージを送信できます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-138">The application can then use this channel to send messages.</span></span> <span data-ttu-id="bb82d-139">詳細については、「 [クライアント Channel-Level プログラミング](client-channel-level-programming.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bb82d-139">For more information, see [Client Channel-Level Programming](client-channel-level-programming.md).</span></span>  
  
 <span data-ttu-id="bb82d-140">受信側では、バインドを使用して、入力メッセージを待ち受ける <xref:System.ServiceModel.Channels.IChannelListener> が作成されます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-140">On the receive side a binding is used to build a <xref:System.ServiceModel.Channels.IChannelListener>, which listens for incoming messages.</span></span> <span data-ttu-id="bb82d-141"><xref:System.ServiceModel.Channels.IChannelListener> では、チャネル スタックを作成し、最上位チャネルへのアプリケーション参照を渡すことによって、待ち受けているアプリケーションにメッセージが提供されます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-141">The <xref:System.ServiceModel.Channels.IChannelListener> provides messages to the listening application by creating channel stacks and handing the application reference to the top channel.</span></span> <span data-ttu-id="bb82d-142">アプリケーションは、このチャネルを使用して、入力メッセージを受信します。</span><span class="sxs-lookup"><span data-stu-id="bb82d-142">The application then uses this channel to receive incoming messages.</span></span> <span data-ttu-id="bb82d-143">詳細については、「 [サービス Channel-Level プログラミング](service-channel-level-programming.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bb82d-143">For more information, see [Service Channel-Level Programming](service-channel-level-programming.md).</span></span>  
  
## <a name="the-channel-object-model"></a><span data-ttu-id="bb82d-144">チャネル オブジェクト モデル</span><span class="sxs-lookup"><span data-stu-id="bb82d-144">The Channel Object Model</span></span>  

 <span data-ttu-id="bb82d-145">チャネル オブジェクト モデルは、チャネル、チャネル リスナー、およびチャネル ファクトリの実装に必要なインターフェイスのコア セットです。</span><span class="sxs-lookup"><span data-stu-id="bb82d-145">The channel object model is the core set of interfaces required to implement channels, channel listeners and channel factories.</span></span> <span data-ttu-id="bb82d-146">また、カスタム実装を支援するために基本クラスもいくつか提供されます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-146">There are also some base classes provided to assist in custom implementations.</span></span>  
  
 <span data-ttu-id="bb82d-147">チャネル リスナーは、受信メッセージを待ち受け、チャネル リスナーによって作成されたチャネル経由で上位レイヤーに受信メッセージを配信します。</span><span class="sxs-lookup"><span data-stu-id="bb82d-147">Channel listeners are responsible for listening for incoming messages, then delivering them to the layer above through channels created by the channel listener.</span></span>  
  
 <span data-ttu-id="bb82d-148">チャネル ファクトリは、メッセージの送信用のチャネルを作成し、チャネル ファクトリが閉じられたときに、作成したすべてのチャネルを閉じます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-148">Channel factories are responsible for creating channels that are used for sending messages and for closing all channels they created when the channel factory is closed.</span></span>  
  
 <span data-ttu-id="bb82d-149"><xref:System.ServiceModel.ICommunicationObject> は、すべての通信オブジェクトが実装する基本ステート マシンを定義するコア インターフェイスです。</span><span class="sxs-lookup"><span data-stu-id="bb82d-149"><xref:System.ServiceModel.ICommunicationObject> is the core interface that defines the basic state machine that all communication objects implement.</span></span> <span data-ttu-id="bb82d-150"><xref:System.ServiceModel.Channels.CommunicationObject> は、このコア インターフェイスの実装を提供し、他のチャネル クラスはインターフェイスを再実装せずに、これを派生させて利用できます。</span><span class="sxs-lookup"><span data-stu-id="bb82d-150"><xref:System.ServiceModel.Channels.CommunicationObject> provides an implementation of this core interface that other channel classes can derive from rather than re-implementing the interface.</span></span> <span data-ttu-id="bb82d-151">ただし、これは必須でありません。カスタム チャネルは、<xref:System.ServiceModel.ICommunicationObject> を直接実装できますが、<xref:System.ServiceModel.Channels.CommunicationObject> を継承できません。</span><span class="sxs-lookup"><span data-stu-id="bb82d-151">However, this is not required: a custom channel can implement <xref:System.ServiceModel.ICommunicationObject> directly and not inherit from <xref:System.ServiceModel.Channels.CommunicationObject>.</span></span> <span data-ttu-id="bb82d-152">図 3 のクラスは、いずれもチャネル モデルの一部と見なされません。これらは、チャネルを作成するカスタム チャネル実装側が利用できるヘルパーです。</span><span class="sxs-lookup"><span data-stu-id="bb82d-152">None of the classes in Figure 3 are considered part of the channel model; they are helpers available to custom channel implementers who want to build channels.</span></span>  
  
 <span data-ttu-id="bb82d-153">![チャネル モデル](./media/wcfc-wcfcchannelsigure3omumtreec.gif "wcfc_WCFCChannelsigure3OMUMTreec")</span><span class="sxs-lookup"><span data-stu-id="bb82d-153">![Channel model](./media/wcfc-wcfcchannelsigure3omumtreec.gif "wcfc_WCFCChannelsigure3OMUMTreec")</span></span>  
  
 <span data-ttu-id="bb82d-154">以下のトピックでは、チャネル オブジェクト モデルと共に、カスタム チャネルの作成に役立つさまざまな開発分野について説明します。</span><span class="sxs-lookup"><span data-stu-id="bb82d-154">The following topics describe the channel object model as well as various development areas that help build custom channels.</span></span>  
  
|<span data-ttu-id="bb82d-155">トピック</span><span class="sxs-lookup"><span data-stu-id="bb82d-155">Topic</span></span>|<span data-ttu-id="bb82d-156">説明</span><span class="sxs-lookup"><span data-stu-id="bb82d-156">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="bb82d-157">サービス:チャネル リスナーとチャネル</span><span class="sxs-lookup"><span data-stu-id="bb82d-157">Service: Channel Listeners and Channels</span></span>](service-channel-listeners-and-channels.md)|<span data-ttu-id="bb82d-158">サービス アプリケーションで受信チャネルを待ち受けるチャネル リスナーについて説明します。</span><span class="sxs-lookup"><span data-stu-id="bb82d-158">Describes channel listeners, which listen for incoming channels in a service application.</span></span>|  
|[<span data-ttu-id="bb82d-159">クライアント:チャネル ファクトリとチャネル</span><span class="sxs-lookup"><span data-stu-id="bb82d-159">Client: Channel Factories and Channels</span></span>](client-channel-factories-and-channels.md)|<span data-ttu-id="bb82d-160">サービス アプリケーションに接続するチャネルを作成するチャネル ファクトリについて説明します。</span><span class="sxs-lookup"><span data-stu-id="bb82d-160">Describes channel factories, which create channels to connect to a service application.</span></span>|  
|[<span data-ttu-id="bb82d-161">状態変更の理解</span><span class="sxs-lookup"><span data-stu-id="bb82d-161">Understanding State Changes</span></span>](understanding-state-changes.md)|<span data-ttu-id="bb82d-162"><xref:System.ServiceModel.ICommunicationObject?displayProperty=nameWithType> インターフェイス モデルの状態がチャネルでどのように変化するかについて説明します。</span><span class="sxs-lookup"><span data-stu-id="bb82d-162">Describes how the <xref:System.ServiceModel.ICommunicationObject?displayProperty=nameWithType> interface models state changes in channels.</span></span>|  
|[<span data-ttu-id="bb82d-163">メッセージ交換パターンの選択</span><span class="sxs-lookup"><span data-stu-id="bb82d-163">Choosing a Message Exchange Pattern</span></span>](choosing-a-message-exchange-pattern.md)|<span data-ttu-id="bb82d-164">チャネルがサポートできる 6 つの基本メッセージ交換パターンについて説明します。</span><span class="sxs-lookup"><span data-stu-id="bb82d-164">Describes the six basic message exchange patterns that channels can support.</span></span>|  
|[<span data-ttu-id="bb82d-165">例外とエラーの処理</span><span class="sxs-lookup"><span data-stu-id="bb82d-165">Handling Exceptions and Faults</span></span>](handling-exceptions-and-faults.md)|<span data-ttu-id="bb82d-166">カスタム チャネルでエラーと例外を処理する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="bb82d-166">Describes how to handle faults and exceptions in custom channels.</span></span>|  
|[<span data-ttu-id="bb82d-167">構成とメタデータのサポート</span><span class="sxs-lookup"><span data-stu-id="bb82d-167">Configuration and Metadata Support</span></span>](configuration-and-metadata-support.md)|<span data-ttu-id="bb82d-168">アプリケーション モデルからカスタム チャネルを使用できるようにする方法と、バインディングとバインド要素を使用してメタデータをエクスポートおよびインポートする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="bb82d-168">Describes how to support the use of custom channels from the application model and how to export and import metadata using bindings and binding elements.</span></span>|
