---
description: '詳細情報: 拡張可能なオブジェクト'
title: 拡張可能オブジェクト
ms.date: 03/30/2017
helpviewer_keywords:
- extensible objects [WCF]
ms.assetid: bc88cefc-31fb-428e-9447-6d20a7d452af
ms.openlocfilehash: 80082f4c94adf2d668ff4c241d286959d9a05038
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99756696"
---
# <a name="extensible-objects"></a><span data-ttu-id="1d751-103">拡張可能オブジェクト</span><span class="sxs-lookup"><span data-stu-id="1d751-103">Extensible Objects</span></span>

<span data-ttu-id="1d751-104">拡張可能オブジェクト パターンは、既存のランタイム クラスに新しい機能を付加して拡張したり、オブジェクトに新しい状態を追加するために使用します。</span><span class="sxs-lookup"><span data-stu-id="1d751-104">The extensible object pattern is used to either extend existing runtime classes with new functionality or to add new state to an object.</span></span> <span data-ttu-id="1d751-105">このようなオブジェクトを実際に拡張することにより、処理の段階に応じて、共通の拡張可能オブジェクトに定義された共有の状態や機能にアクセスすることができます。</span><span class="sxs-lookup"><span data-stu-id="1d751-105">Extensions, attached to one of the extensible objects, enable behaviors at very different stages in processing to access shared state and functionality attached to a common extensible object that they can access.</span></span>

## <a name="the-iextensibleobjectt-pattern"></a><span data-ttu-id="1d751-106">IExtensibleObject \<T> パターン</span><span class="sxs-lookup"><span data-stu-id="1d751-106">The IExtensibleObject\<T> Pattern</span></span>

<span data-ttu-id="1d751-107">拡張可能オブジェクト パターンには、<xref:System.ServiceModel.IExtensibleObject%601>、<xref:System.ServiceModel.IExtension%601>、および <xref:System.ServiceModel.IExtensionCollection%601> の 3 つのインターフェイスがあります。</span><span class="sxs-lookup"><span data-stu-id="1d751-107">There are three interfaces in the extensible object pattern: <xref:System.ServiceModel.IExtensibleObject%601>, <xref:System.ServiceModel.IExtension%601>, and <xref:System.ServiceModel.IExtensionCollection%601>.</span></span>

<span data-ttu-id="1d751-108"><xref:System.ServiceModel.IExtensibleObject%601> インターフェイスを実装することにより、<xref:System.ServiceModel.IExtension%601> オブジェクトの機能をカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="1d751-108">The <xref:System.ServiceModel.IExtensibleObject%601> interface is implemented by types that allow <xref:System.ServiceModel.IExtension%601> objects to customize their functionality.</span></span>

<span data-ttu-id="1d751-109">拡張可能オブジェクトを使用すると、<xref:System.ServiceModel.IExtension%601> オブジェクトの動的な集約が可能になります。</span><span class="sxs-lookup"><span data-stu-id="1d751-109">Extensible objects allow dynamic aggregation of <xref:System.ServiceModel.IExtension%601> objects.</span></span> <span data-ttu-id="1d751-110"><xref:System.ServiceModel.IExtension%601> オブジェクトには、次のインターフェイスが実装されています。</span><span class="sxs-lookup"><span data-stu-id="1d751-110"><xref:System.ServiceModel.IExtension%601> objects are characterized by the following interface:</span></span>

```csharp
public interface IExtension<T>
where T : IExtensibleObject<T>
{
    void Attach(T owner);
    void Detach(T owner);
}
```

<span data-ttu-id="1d751-111">この型制約は、<xref:System.ServiceModel.IExtensibleObject%601> であるクラスに対してしか拡張を定義できないことを保証します。</span><span class="sxs-lookup"><span data-stu-id="1d751-111">The type restriction guarantees that extensions can only be defined for classes that are <xref:System.ServiceModel.IExtensibleObject%601>.</span></span> <span data-ttu-id="1d751-112"><xref:System.ServiceModel.IExtension%601.Attach%2A> と <xref:System.ServiceModel.IExtension%601.Detach%2A> は、集約や集約解除に関する通知を提供します。</span><span class="sxs-lookup"><span data-stu-id="1d751-112"><xref:System.ServiceModel.IExtension%601.Attach%2A> and <xref:System.ServiceModel.IExtension%601.Detach%2A> provide notification of aggregation or disaggregation.</span></span>

<span data-ttu-id="1d751-113">所有者が追加や削除を行う際の制限を組み込むことも可能です。</span><span class="sxs-lookup"><span data-stu-id="1d751-113">It is valid for implementations to restrict when they may be added and removed from an owner.</span></span> <span data-ttu-id="1d751-114">たとえば、削除は全面的に禁止する、所有者や拡張がある状態であれば拡張の追加や削除を禁止する、同時に複数の所有者に追加することを禁止する、1 つ削除したら 1 つだけ追加を許可する、などの制約を指定することができます。</span><span class="sxs-lookup"><span data-stu-id="1d751-114">For example, you can disallow removal entirely, disallowing adding or removing extensions when the owner or extension are in a certain state, disallow adding to multiple owners concurrently, or allow only a single addition followed by a single remove.</span></span>

<span data-ttu-id="1d751-115"><xref:System.ServiceModel.IExtension%601> を実装しても、他の標準のマネージド インターフェイスとやりとりできるとは限りません。</span><span class="sxs-lookup"><span data-stu-id="1d751-115"><xref:System.ServiceModel.IExtension%601> does not imply any interactions with other standard managed interfaces.</span></span> <span data-ttu-id="1d751-116">特に、所有者オブジェクトの <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> メソッドは、自分自身の拡張を解除しないのが普通です。</span><span class="sxs-lookup"><span data-stu-id="1d751-116">Specifically, the <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> method on the owner object does not normally detach its extensions.</span></span>

<span data-ttu-id="1d751-117">コレクションに拡張機能が追加されると、 <xref:System.ServiceModel.IExtension%601.Attach%2A> コレクションに入る前にが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="1d751-117">When an extension is added to the collection, <xref:System.ServiceModel.IExtension%601.Attach%2A> is called before it goes into the collection.</span></span> <span data-ttu-id="1d751-118">コレクションから拡張機能を削除すると、 <xref:System.ServiceModel.IExtension%601.Detach%2A> が削除された後にが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="1d751-118">When an extension is removed from the collection, <xref:System.ServiceModel.IExtension%601.Detach%2A> is called after it is removed.</span></span> <span data-ttu-id="1d751-119">つまり、(適切な同期を想定して) 拡張は、との間でコレクション内で見つかった場合にのみ、カウントされ <xref:System.ServiceModel.IExtension%601.Attach%2A> <xref:System.ServiceModel.IExtension%601.Detach%2A> ます。</span><span class="sxs-lookup"><span data-stu-id="1d751-119">This means (assuming appropriate synchronization) an extension can count on only being found in the collection while it is between <xref:System.ServiceModel.IExtension%601.Attach%2A> and <xref:System.ServiceModel.IExtension%601.Detach%2A>.</span></span>

<span data-ttu-id="1d751-120"><xref:System.ServiceModel.IExtensionCollection%601.FindAll%2A> や <xref:System.ServiceModel.IExtensionCollection%601.Find%2A> に渡すオブジェクトは、<xref:System.ServiceModel.IExtension%601> である必要はなく、任意のオブジェクトを渡すことができますが、返される拡張は <xref:System.ServiceModel.IExtension%601> です。</span><span class="sxs-lookup"><span data-stu-id="1d751-120">The object passed to <xref:System.ServiceModel.IExtensionCollection%601.FindAll%2A> or <xref:System.ServiceModel.IExtensionCollection%601.Find%2A> need not be <xref:System.ServiceModel.IExtension%601> (for example, you can pass any object), but the returned extension is an <xref:System.ServiceModel.IExtension%601>.</span></span>

<span data-ttu-id="1d751-121">コレクション内の拡張機能がでない場合、は null を返し、は <xref:System.ServiceModel.IExtension%601> <xref:System.ServiceModel.IExtensionCollection%601.Find%2A> <xref:System.ServiceModel.IExtensionCollection%601.FindAll%2A> 空のコレクションを返します。</span><span class="sxs-lookup"><span data-stu-id="1d751-121">If no extension in the collection is an <xref:System.ServiceModel.IExtension%601>, <xref:System.ServiceModel.IExtensionCollection%601.Find%2A> returns null, and <xref:System.ServiceModel.IExtensionCollection%601.FindAll%2A> returns an empty collection.</span></span> <span data-ttu-id="1d751-122">複数の拡張機能がを実装している場合 <xref:System.ServiceModel.IExtension%601> 、は <xref:System.ServiceModel.IExtensionCollection%601.Find%2A> そのうちの1つを返します。</span><span class="sxs-lookup"><span data-stu-id="1d751-122">If multiple extensions implement <xref:System.ServiceModel.IExtension%601>, <xref:System.ServiceModel.IExtensionCollection%601.Find%2A> returns one of them.</span></span> <span data-ttu-id="1d751-123"><xref:System.ServiceModel.IExtensionCollection%601.FindAll%2A> から返される値はスナップショットです。</span><span class="sxs-lookup"><span data-stu-id="1d751-123">The value returned from <xref:System.ServiceModel.IExtensionCollection%601.FindAll%2A> is a snapshot.</span></span>

<span data-ttu-id="1d751-124">主な使い方として、次の 2 つのシナリオが考えられます。</span><span class="sxs-lookup"><span data-stu-id="1d751-124">There are two main scenarios.</span></span> <span data-ttu-id="1d751-125">1 つ目のシナリオでは、型ベースのディクショナリとして <xref:System.ServiceModel.IExtensibleObject%601.Extensions%2A> プロパティを使用し、オブジェクトに状態を追加します。これは、別のコンポーネントが型に基づいて検索できます。</span><span class="sxs-lookup"><span data-stu-id="1d751-125">The first scenario uses the <xref:System.ServiceModel.IExtensibleObject%601.Extensions%2A> property as a type-based dictionary to insert state on an object to enable another component to look it up using the type.</span></span>

<span data-ttu-id="1d751-126">2 つ目のシナリオでは、<xref:System.ServiceModel.IExtension%601.Attach%2A> プロパティおよび <xref:System.ServiceModel.IExtension%601.Detach%2A> プロパティを使用し、イベントへの登録や、状態の遷移の監視など、カスタムの動作にオブジェクトを参加させます。</span><span class="sxs-lookup"><span data-stu-id="1d751-126">The second scenario uses the <xref:System.ServiceModel.IExtension%601.Attach%2A> and <xref:System.ServiceModel.IExtension%601.Detach%2A> properties to enable an object to participate in custom behavior, such as registering for events, watching state transitions, and so on.</span></span>

<span data-ttu-id="1d751-127"><xref:System.ServiceModel.IExtensionCollection%601> インターフェイスは、型を基準にした <xref:System.ServiceModel.IExtension%601> の取得を可能にする <xref:System.ServiceModel.IExtension%601> オブジェクトのコレクションです。</span><span class="sxs-lookup"><span data-stu-id="1d751-127">The <xref:System.ServiceModel.IExtensionCollection%601> interface is a collection of the <xref:System.ServiceModel.IExtension%601> objects that allow for retrieving the <xref:System.ServiceModel.IExtension%601> by its type.</span></span> <span data-ttu-id="1d751-128"><xref:System.ServiceModel.IExtensionCollection%601.Find%2A?displayProperty=nameWithType> は、指定された型の <xref:System.ServiceModel.IExtension%601> オブジェクトのうち、最も新しく追加されたものを返します。</span><span class="sxs-lookup"><span data-stu-id="1d751-128"><xref:System.ServiceModel.IExtensionCollection%601.Find%2A?displayProperty=nameWithType> returns the most recently added object that is an <xref:System.ServiceModel.IExtension%601> of that type.</span></span>

### <a name="extensible-objects-in-windows-communication-foundation"></a><span data-ttu-id="1d751-129">Windows Communication Foundation の拡張可能オブジェクト</span><span class="sxs-lookup"><span data-stu-id="1d751-129">Extensible Objects in Windows Communication Foundation</span></span>

<span data-ttu-id="1d751-130">Windows Communication Foundation (WCF) には、次の4つの拡張可能なオブジェクトがあります。</span><span class="sxs-lookup"><span data-stu-id="1d751-130">There are four extensible objects in Windows Communication Foundation (WCF):</span></span>

- <span data-ttu-id="1d751-131"><xref:System.ServiceModel.ServiceHostBase> : サービス ホストの基本クラスです。</span><span class="sxs-lookup"><span data-stu-id="1d751-131"><xref:System.ServiceModel.ServiceHostBase> – This is the base class for the service’s host.</span></span>  <span data-ttu-id="1d751-132"><xref:System.ServiceModel.ServiceHostBase> 自身の動作を拡張するほか、各サービスの状態を保存しておくための拡張が可能です。</span><span class="sxs-lookup"><span data-stu-id="1d751-132">Extensions of this class can be used to extend the behavior of the <xref:System.ServiceModel.ServiceHostBase> itself or to store the state for each service.</span></span>

- <span data-ttu-id="1d751-133"><xref:System.ServiceModel.InstanceContext> : サービスのランタイムを使用して、サービスの型のインスタンスと接続するためのクラスです。</span><span class="sxs-lookup"><span data-stu-id="1d751-133"><xref:System.ServiceModel.InstanceContext> – This class connects an instance of the service’s type with the service runtime.</span></span>  <span data-ttu-id="1d751-134">このクラスは、インスタンスに関する情報のほか、<xref:System.ServiceModel.InstanceContext> に含まれる <xref:System.ServiceModel.ServiceHostBase> への参照を保持します。</span><span class="sxs-lookup"><span data-stu-id="1d751-134">It contains information about the instance as well as a reference to the <xref:System.ServiceModel.InstanceContext>'s containing <xref:System.ServiceModel.ServiceHostBase>.</span></span> <span data-ttu-id="1d751-135"><xref:System.ServiceModel.InstanceContext> 自身の動作を拡張するほか、各サービスの状態を保存しておくための拡張が可能です。</span><span class="sxs-lookup"><span data-stu-id="1d751-135">Extensions of this class can be used to extend the behavior of the <xref:System.ServiceModel.InstanceContext> or to store the state for each service.</span></span>

- <span data-ttu-id="1d751-136"><xref:System.ServiceModel.OperationContext> : 操作ごとにランタイムが収集した操作情報を表すクラスです。</span><span class="sxs-lookup"><span data-stu-id="1d751-136"><xref:System.ServiceModel.OperationContext> – This class represents the operation information that the runtime gathers for each operation.</span></span>  <span data-ttu-id="1d751-137">具体的には、受け取ったメッセージのヘッダーやプロパティ、受け取ったセキュリティ ID などの情報があります。</span><span class="sxs-lookup"><span data-stu-id="1d751-137">This includes information such as the incoming message headers, the incoming message properties, the incoming security identity, and other information.</span></span>  <span data-ttu-id="1d751-138"><xref:System.ServiceModel.OperationContext> 自身の動作を拡張するほか、各操作の状態を保存しておくための拡張が可能です。</span><span class="sxs-lookup"><span data-stu-id="1d751-138">Extensions of this class can either extend the behavior of <xref:System.ServiceModel.OperationContext> or store the state for each operation.</span></span>

- <span data-ttu-id="1d751-139"><xref:System.ServiceModel.IContextChannel> –このインターフェイスを使用すると、WCF ランタイムによって構築されたチャネルとプロキシの各状態を検査できます。</span><span class="sxs-lookup"><span data-stu-id="1d751-139"><xref:System.ServiceModel.IContextChannel> – This interface allows for the inspection of each state for the channels and proxies built by the WCF runtime.</span></span>  <span data-ttu-id="1d751-140"><xref:System.ServiceModel.IClientChannel> 自身の動作を拡張するほか、各チャネルの状態を保存しておくための拡張が可能です。</span><span class="sxs-lookup"><span data-stu-id="1d751-140">Extensions of this class can either extend the behavior of <xref:System.ServiceModel.IClientChannel> or can use it to store the state for each channel.</span></span>

<span data-ttu-id="1d751-141"><xref:System.ServiceModel.InstanceContext> オブジェクトの状態を追跡するという、簡単な拡張の使い方を例示したコードを次に示します。</span><span class="sxs-lookup"><span data-stu-id="1d751-141">The following code example shows the use of a simple extension to track <xref:System.ServiceModel.InstanceContext> objects.</span></span>

[!code-csharp[IInstanceContextInitializer#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/iinstancecontextinitializer/cs/initializer.cs#1)]

## <a name="see-also"></a><span data-ttu-id="1d751-142">関連項目</span><span class="sxs-lookup"><span data-stu-id="1d751-142">See also</span></span>

- <xref:System.ServiceModel.IExtensibleObject%601>
- <xref:System.ServiceModel.IExtension%601>
- <xref:System.ServiceModel.IExtensionCollection%601>
