---
description: '詳細情報: シリアル化'
title: Serialization2
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: a15ae411-8dc2-4ca3-84d2-01c9d5f1972a
ms.openlocfilehash: f4d9ecd63d4d15744fca4c6a6c61d9737cc8a196
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99803777"
---
# <a name="serialization"></a><span data-ttu-id="0faa3-103">シリアル化</span><span class="sxs-lookup"><span data-stu-id="0faa3-103">Serialization</span></span>

<span data-ttu-id="0faa3-104">このトピックでは、[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] のシリアル化機能について説明します。</span><span class="sxs-lookup"><span data-stu-id="0faa3-104">This topic describes [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] serialization capabilities.</span></span> <span data-ttu-id="0faa3-105">デザイン時のコード生成でシリアル化を追加する方法と、実行時の [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] のクラスのシリアル化の動作について説明します。</span><span class="sxs-lookup"><span data-stu-id="0faa3-105">The paragraphs that follow provide information about how to add serialization during code generation at design time and the run-time serialization behavior of [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] classes.</span></span>  
  
 <span data-ttu-id="0faa3-106">デザイン時には、次のいずれかの方法でシリアル化のコードを追加できます。</span><span class="sxs-lookup"><span data-stu-id="0faa3-106">You can add serialization code at design time by either of the following methods:</span></span>  
  
- <span data-ttu-id="0faa3-107">オブジェクト リレーショナル デザイナーで、**Serialization Mode** プロパティを **Unidirectional** に変更します。</span><span class="sxs-lookup"><span data-stu-id="0faa3-107">In the Object Relational Designer, change the **Serialization Mode** property to **Unidirectional**.</span></span>  
  
- <span data-ttu-id="0faa3-108">SQLMetal コマンド ラインに **/serialization** オプションを追加します。</span><span class="sxs-lookup"><span data-stu-id="0faa3-108">On the SQLMetal command line, add the **/serialization** option.</span></span> <span data-ttu-id="0faa3-109">詳しくは、「[SqlMetal.exe (コード生成ツール)](../../../../tools/sqlmetal-exe-code-generation-tool.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="0faa3-109">For more information, see [SqlMetal.exe (Code Generation Tool)](../../../../tools/sqlmetal-exe-code-generation-tool.md).</span></span>  
  
## <a name="overview"></a><span data-ttu-id="0faa3-110">概要</span><span class="sxs-lookup"><span data-stu-id="0faa3-110">Overview</span></span>  

 <span data-ttu-id="0faa3-111">[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] が生成するコードには、遅延読み込み機能が既定で備わっています。</span><span class="sxs-lookup"><span data-stu-id="0faa3-111">The code generated by [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] provides deferred loading capabilities by default.</span></span> <span data-ttu-id="0faa3-112">遅延読み込みは、中間層でデータを必要に応じて透過的に読み込むうえでは非常に便利です。</span><span class="sxs-lookup"><span data-stu-id="0faa3-112">Deferred loading is very convenient on the mid-tier for transparent loading of data on demand.</span></span> <span data-ttu-id="0faa3-113">しかし、シリアル化のときには問題です。遅延読み込みが意図されているかどうかに関係なく、シリアライザーによって遅延読み込みが発生するためです。</span><span class="sxs-lookup"><span data-stu-id="0faa3-113">However, it is problematic for serialization, because the serializer triggers deferred loading whether deferred loading is intended or not.</span></span> <span data-ttu-id="0faa3-114">具体的には、オブジェクトがシリアル化されるときには、遅延読み込みされるすべての外部参照の推移的閉包がシリアル化されます。</span><span class="sxs-lookup"><span data-stu-id="0faa3-114">In effect, when an object is serialized, its transitive closure under all outbound defer-loaded references is serialized.</span></span>  
  
 <span data-ttu-id="0faa3-115">[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] のシリアル化機能では、この問題に対処しています。これには主に、次の 2 つの方法が使用されます。</span><span class="sxs-lookup"><span data-stu-id="0faa3-115">The [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] serialization feature addresses this problem, primarily through two mechanisms:</span></span>  
  
- <span data-ttu-id="0faa3-116"><xref:System.Data.Linq.DataContext> のモードにより、遅延読み込みをオフにします (<xref:System.Data.Linq.DataContext.ObjectTrackingEnabled%2A>)。</span><span class="sxs-lookup"><span data-stu-id="0faa3-116">A <xref:System.Data.Linq.DataContext> mode for turning off deferred loading (<xref:System.Data.Linq.DataContext.ObjectTrackingEnabled%2A>).</span></span> <span data-ttu-id="0faa3-117">詳細については、「<xref:System.Data.Linq.DataContext>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0faa3-117">For more information, see <xref:System.Data.Linq.DataContext>.</span></span>  
  
- <span data-ttu-id="0faa3-118">コード生成のスイッチにより、生成するエンティティに <xref:System.Runtime.Serialization.DataContractAttribute?displayProperty=nameWithType> 属性および <xref:System.Runtime.Serialization.DataMemberAttribute?displayProperty=nameWithType> 属性を生成します。</span><span class="sxs-lookup"><span data-stu-id="0faa3-118">A code-generation switch to generate <xref:System.Runtime.Serialization.DataContractAttribute?displayProperty=nameWithType> and <xref:System.Runtime.Serialization.DataMemberAttribute?displayProperty=nameWithType> attributes on generated entities.</span></span> <span data-ttu-id="0faa3-119">この方法と、シリアル化での遅延読み込みクラスの動作が、このトピックの主な話題です。</span><span class="sxs-lookup"><span data-stu-id="0faa3-119">This aspect, including the behavior of defer-loading classes under serialization, is the major subject of this topic.</span></span>  
  
### <a name="definitions"></a><span data-ttu-id="0faa3-120">定義</span><span class="sxs-lookup"><span data-stu-id="0faa3-120">Definitions</span></span>  
  
- <span data-ttu-id="0faa3-121">*DataContract シリアライザー*:.NET Framework 3.0 以降のバージョンの WCF (Windows Communication Framework) コンポーネントによって使用される既定のシリアライザーです。</span><span class="sxs-lookup"><span data-stu-id="0faa3-121">*DataContract serializer*: Default serializer used by the Windows Communication Framework (WCF) component of the .NET Framework 3.0 or later versions.</span></span>  
  
- <span data-ttu-id="0faa3-122">*単方向シリアル化*:循環参照を防ぐために、一方向の関連付けプロパティのみを含む、シリアル化されたバージョンのクラスです。</span><span class="sxs-lookup"><span data-stu-id="0faa3-122">*Unidirectional serialization*: The serialized version of a class that contains only a one-way association property (to avoid a cycle).</span></span> <span data-ttu-id="0faa3-123">慣例として、主キー/外部キーのリレーションシップの親側のプロパティをシリアル化の対象としてマークします。</span><span class="sxs-lookup"><span data-stu-id="0faa3-123">By convention, the property on the parent side of a primary-foreign key relationship is marked for serialization.</span></span> <span data-ttu-id="0faa3-124">双方向の関連付けの反対側はシリアル化しません。</span><span class="sxs-lookup"><span data-stu-id="0faa3-124">The other side in a bidirectional association is not serialized.</span></span>  
  
     <span data-ttu-id="0faa3-125">[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] では、シリアル化の種類として、単方向シリアル化のみがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="0faa3-125">Unidirectional serialization is the only type of serialization supported by [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)].</span></span>  
  
## <a name="code-example"></a><span data-ttu-id="0faa3-126">コード例</span><span class="sxs-lookup"><span data-stu-id="0faa3-126">Code Example</span></span>  

 <span data-ttu-id="0faa3-127">次のコードは、Northwind サンプル データベースの典型的な `Customer` クラスおよび `Order` クラスを使用して、これらのクラスをシリアル化の属性で装飾するようすを示します。</span><span class="sxs-lookup"><span data-stu-id="0faa3-127">The following code uses the traditional `Customer` and `Order` classes from the Northwind sample database, and shows how these classes are decorated with serialization attributes.</span></span>  
  
 [!code-csharp[DLinqSerialization#1](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#1)]
 [!code-vb[DLinqSerialization#1](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#1)]  
  
 [!code-csharp[DLinqSerialization#2](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#2)]
 [!code-vb[DLinqSerialization#2](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#2)]  
  
 [!code-csharp[DLinqSerialization#3](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#3)]
 [!code-vb[DLinqSerialization#3](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#3)]  
  
 <span data-ttu-id="0faa3-128">次の例の `Order` クラスでは、簡略化のために、`Customer` クラスに関する逆関連付けのプロパティのみを示します。</span><span class="sxs-lookup"><span data-stu-id="0faa3-128">For the `Order` class in the following example, only the reverse association property corresponding to the `Customer` class is shown for brevity.</span></span> <span data-ttu-id="0faa3-129">循環参照を防ぐために、<xref:System.Runtime.Serialization.DataMemberAttribute> 属性はありません。</span><span class="sxs-lookup"><span data-stu-id="0faa3-129">It does not have a <xref:System.Runtime.Serialization.DataMemberAttribute> attribute to avoid a cycle.</span></span>  
  
 [!code-csharp[DLinqSerialization#4](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#4)]
 [!code-vb[DLinqSerialization#4](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#4)]  
  
 [!code-csharp[DLinqSerialization#5](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#5)]
 [!code-vb[DLinqSerialization#5](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#5)]  
  
### <a name="how-to-serialize-the-entities"></a><span data-ttu-id="0faa3-130">エンティティをシリアル化する方法</span><span class="sxs-lookup"><span data-stu-id="0faa3-130">How to Serialize the Entities</span></span>  

 <span data-ttu-id="0faa3-131">前のセクションで示したコードのエンティティは次のようにシリアル化できます。</span><span class="sxs-lookup"><span data-stu-id="0faa3-131">You can serialize the entities in the codes shown in the previous section as follows;</span></span>  
  
 [!code-csharp[DLinqSerialization#6](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/Program.cs#6)]
 [!code-vb[DLinqSerialization#6](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/Module1.vb#6)]  
  
### <a name="self-recursive-relationships"></a><span data-ttu-id="0faa3-132">自己再帰的リレーションシップ</span><span class="sxs-lookup"><span data-stu-id="0faa3-132">Self-Recursive Relationships</span></span>  

 <span data-ttu-id="0faa3-133">自己再帰的リレーションシップも同じパターンに従います。</span><span class="sxs-lookup"><span data-stu-id="0faa3-133">Self-recursive relationships follow the same pattern.</span></span> <span data-ttu-id="0faa3-134">外部キーに関する関連付けのプロパティには <xref:System.Runtime.Serialization.DataMemberAttribute> 属性がなく、親プロパティにはあります。</span><span class="sxs-lookup"><span data-stu-id="0faa3-134">The association property corresponding to the foreign key does not have a <xref:System.Runtime.Serialization.DataMemberAttribute> attribute, whereas the parent property does.</span></span>  
  
 <span data-ttu-id="0faa3-135">次のクラスには、自己再帰的リレーションシップが 2 つあります:Employee.Manager/Reports と Employee.Mentor/Mentees。</span><span class="sxs-lookup"><span data-stu-id="0faa3-135">Consider the following class that has two self-recursive relationships: Employee.Manager/Reports and Employee.Mentor/Mentees.</span></span>  
  
 [!code-csharp[DLinqSerialization#7](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#7)]
 [!code-vb[DLinqSerialization#7](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#7)]  
  
## <a name="see-also"></a><span data-ttu-id="0faa3-136">関連項目</span><span class="sxs-lookup"><span data-stu-id="0faa3-136">See also</span></span>

- [<span data-ttu-id="0faa3-137">背景情報</span><span class="sxs-lookup"><span data-stu-id="0faa3-137">Background Information</span></span>](background-information.md)
- [<span data-ttu-id="0faa3-138">SqlMetal.exe (コード生成ツール)</span><span class="sxs-lookup"><span data-stu-id="0faa3-138">SqlMetal.exe (Code Generation Tool)</span></span>](../../../../tools/sqlmetal-exe-code-generation-tool.md)
- [<span data-ttu-id="0faa3-139">方法: エンティティをシリアル化可能にする</span><span class="sxs-lookup"><span data-stu-id="0faa3-139">How to: Make Entities Serializable</span></span>](how-to-make-entities-serializable.md)
