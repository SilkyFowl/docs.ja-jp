---
description: '詳細情報: OLE DB、ODBC、および Oracle 接続プール'
title: OLE DB、ODBC、および Oracle 接続プール
ms.date: 03/30/2017
ms.assetid: 2bd83b1e-3ea9-43c4-bade-d9cdb9bbbb04
ms.openlocfilehash: da30d70f88c8d109d50716347e7deaacdc65991a
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99672648"
---
# <a name="ole-db-odbc-and-oracle-connection-pooling"></a><span data-ttu-id="c3e20-103">OLE DB、ODBC、および Oracle 接続プール</span><span class="sxs-lookup"><span data-stu-id="c3e20-103">OLE DB, ODBC, and Oracle connection pooling</span></span>

<span data-ttu-id="c3e20-104">接続をプールすると、アプリケーションのパフォーマンスとスケーラビリティを大幅に改善できます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-104">Pooling connections can significantly enhance the performance and scalability of your application.</span></span> <span data-ttu-id="c3e20-105">このセクションでは、OLE DB、ODBC、Oracle 用の .NET Framework データ プロバイダーの接続プールについて説明します。</span><span class="sxs-lookup"><span data-stu-id="c3e20-105">This section discusses connection pooling for the .NET Framework data providers for OLE DB, ODBC, and Oracle.</span></span>

## <a name="oledb"></a><span data-ttu-id="c3e20-106">OleDb</span><span class="sxs-lookup"><span data-stu-id="c3e20-106">OleDb</span></span>

<span data-ttu-id="c3e20-107">.NET Framework Data Provider for OLE DB は、OLE DB セッションのプール機能を使用して接続を自動的にプールします。</span><span class="sxs-lookup"><span data-stu-id="c3e20-107">The .NET Framework Data Provider for OLE DB automatically pools connections using OLE DB session pooling.</span></span> <span data-ttu-id="c3e20-108">接続文字列引数を使用して、プール機能を含む OLE DB サービスの有効や無効を切り替えることができます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-108">Connection string arguments can be used to enable or disable OLE DB services including pooling.</span></span> <span data-ttu-id="c3e20-109">たとえば、次の接続文字列は OLE DB セッション プール機能と自動的なトランザクションへの参加を無効にします。</span><span class="sxs-lookup"><span data-stu-id="c3e20-109">For example, the following connection string disables OLE DB session pooling and automatic transaction enlistment.</span></span>

```csharp
Provider=SQLOLEDB;OLE DB Services=-4;Data Source=localhost;Integrated Security=SSPI;
```

 <span data-ttu-id="c3e20-110">接続がプールに返されるようにするために、接続を使い終えたら必ず接続を終了または破棄することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="c3e20-110">We recommend that you always close or dispose of a connection when you are finished using it in order to return the connection to the pool.</span></span> <span data-ttu-id="c3e20-111">明示的に終了されていない接続は、プールに返されない場合があります。</span><span class="sxs-lookup"><span data-stu-id="c3e20-111">Connections that are not explicitly closed may not get returned to the pool.</span></span> <span data-ttu-id="c3e20-112">たとえば、スコープ外に出ても、明示的に終了されていない接続は、最大プール サイズに達した時点でその接続がまだ有効である場合にだけ接続プールに返されます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-112">For example, a connection that has gone out of scope but that has not been explicitly closed will only be returned to the connection pool if the maximum pool size has been reached and the connection is still valid.</span></span>

 <span data-ttu-id="c3e20-113">OLE DB セッション プール機能とリソース プール機能の説明、および OLE DB プロバイダー サービスの既定値をオーバーライドしてプール機能を無効にする方法については、「[OLE DB プログラマー ガイド](/previous-versions/windows/desktop/ms713643(v=vs.85))」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c3e20-113">For more information about OLE DB session or resource pooling, as well as how to disable pooling by overriding OLE DB provider service defaults, see the [OLE DB Programmer's Guide](/previous-versions/windows/desktop/ms713643(v=vs.85)).</span></span>

## <a name="odbc"></a><span data-ttu-id="c3e20-114">ODBC</span><span class="sxs-lookup"><span data-stu-id="c3e20-114">ODBC</span></span>

 <span data-ttu-id="c3e20-115">.NET Framework Data Provider for ODBC の接続プールは、接続に使用される ODBC ドライバー マネージャーによって管理されるため、.NET Framework Data Provider for ODBC の影響は受けません。</span><span class="sxs-lookup"><span data-stu-id="c3e20-115">Connection pooling for the .NET Framework Data Provider for ODBC is managed by the ODBC Driver Manager that is used for the connection, and is not affected by the .NET Framework Data Provider for ODBC.</span></span>

 <span data-ttu-id="c3e20-116">接続プール機能を有効または無効にするには、[コントロール パネル] の [管理ツール] フォルダーにある **[ODBC データ ソース アドミニストレーター]** を開きます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-116">To enable or disable connection pooling, open **ODBC Data Source Administrator** in the Administrative Tools folder of Control Panel.</span></span> <span data-ttu-id="c3e20-117">**[接続プール]** タブで、インストールされている各 ODBC ドライバーに対する接続プール パラメーターを指定できます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-117">The **Connection Pooling** tab allows you to specify connection pooling parameters for each ODBC driver installed.</span></span> <span data-ttu-id="c3e20-118">特定の ODBC ドライバーの接続プールを変更すると、その ODBC ドライバーを使用するすべてのアプリケーションに影響します。</span><span class="sxs-lookup"><span data-stu-id="c3e20-118">Connection pooling changes for a specific ODBC driver affect all applications that use that ODBC driver.</span></span>

## <a name="oracleclient"></a><span data-ttu-id="c3e20-119">OracleClient</span><span class="sxs-lookup"><span data-stu-id="c3e20-119">OracleClient</span></span>

 <span data-ttu-id="c3e20-120">Oracle の .NET データ プロバイダーは ADO.NET クライアント アプリケーションに自動的に接続プールを提供します。</span><span class="sxs-lookup"><span data-stu-id="c3e20-120">The .NET Framework Data Provider for Oracle provides connection pooling automatically for your ADO.NET client application.</span></span> <span data-ttu-id="c3e20-121">また、接続プール機能の動作を制御する接続文字列修飾子を指定することもできます (このトピックの後の「接続文字列キーワードによる接続プールの制御」を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="c3e20-121">You can also supply several connection string modifiers to control connection pooling behavior (see "Controlling Connection Pooling with Connection String Keywords," later in this topic).</span></span>

### <a name="create-and-assign-pools"></a><span data-ttu-id="c3e20-122">プールを作成して割り当てる</span><span class="sxs-lookup"><span data-stu-id="c3e20-122">Create and assign pools</span></span>

 <span data-ttu-id="c3e20-123">接続が開かれると、厳密一致のアルゴリズムに基づいて接続プールが作成され、接続内の接続文字列に関連付けられます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-123">When a connection is opened, a connection pool is created based on an exact matching algorithm that associates the pool with the connection string in the connection.</span></span> <span data-ttu-id="c3e20-124">各接続プールが別の接続文字列に関連付けられます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-124">Each connection pool is associated with a distinct connection string.</span></span> <span data-ttu-id="c3e20-125">新しい接続が開かれたとき、接続文字列が既存のプールと完全に一致しない場合は、新しいプールが作成されます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-125">When a new connection is opened, if the connection string is not an exact match to an existing pool, a new pool is created.</span></span>

 <span data-ttu-id="c3e20-126">接続プールは一度作成されるとアクティブなプロセスが終了するまで破棄されません。</span><span class="sxs-lookup"><span data-stu-id="c3e20-126">Once created, connection pools are not destroyed until the active process ends.</span></span> <span data-ttu-id="c3e20-127">アクティブでないプールまたは空のプールの維持には、システム リソースはほとんど使用されません。</span><span class="sxs-lookup"><span data-stu-id="c3e20-127">Maintaining inactive or empty pools uses very few system resources.</span></span>

### <a name="connection-addition"></a><span data-ttu-id="c3e20-128">接続の追加</span><span class="sxs-lookup"><span data-stu-id="c3e20-128">Connection Addition</span></span>

 <span data-ttu-id="c3e20-129">一意の接続文字列ごとに 1 つの接続プールが作成されます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-129">A connection pool is created for each unique connection string.</span></span> <span data-ttu-id="c3e20-130">プールが作成された段階で、複数の接続オブジェクトが作成されてそのプールへ追加され、最小プール サイズ要件を満たします。</span><span class="sxs-lookup"><span data-stu-id="c3e20-130">When a pool is created, multiple connection objects are created and added to the pool so that the minimum pool size requirement is satisfied.</span></span> <span data-ttu-id="c3e20-131">必要に応じて、最大プール サイズに達するまで、接続がプールへ追加されます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-131">Connections are added to the pool as needed, up to the maximum pool size.</span></span>

 <span data-ttu-id="c3e20-132"><xref:System.Data.OracleClient.OracleConnection> オブジェクトが要求されたとき、プールに使用可能な接続がある場合はプールから取得されます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-132">When an <xref:System.Data.OracleClient.OracleConnection> object is requested, it is obtained from the pool if a usable connection is available.</span></span> <span data-ttu-id="c3e20-133">使用可能な接続とは、サーバーへの有効なリンクを持つ接続のうち、現在使用中でないか、一致するトランザクション コンテキストを持っているか、またはどのトランザクション コンテキストにも関連付けられていない接続のことです。</span><span class="sxs-lookup"><span data-stu-id="c3e20-133">To be usable, the connection must currently be unused, have a matching transaction context or not be associated with any transaction context, and have a valid link to the server.</span></span>

 <span data-ttu-id="c3e20-134">最大プール サイズに達すると、使用可能な接続を取得できなくなり、要求はキューに置かれます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-134">If the maximum pool size has been reached and no usable connection is available, the request is queued.</span></span> <span data-ttu-id="c3e20-135">接続プーラーは、接続がプールに解放されたときに接続の再割り当てを行ってそれらの要求に応えます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-135">The connection pooler satisfies these requests by reallocating connections as they are released back into the pool.</span></span> <span data-ttu-id="c3e20-136">接続が終了または破棄されると、その接続は解放され、プールに戻されます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-136">Connections are released back into the pool when they are closed or disposed.</span></span>

### <a name="connection-removal"></a><span data-ttu-id="c3e20-137">接続の削除</span><span class="sxs-lookup"><span data-stu-id="c3e20-137">Connection Removal</span></span>

 <span data-ttu-id="c3e20-138">接続が長時間アイドル状態のとき、またはサーバーとの接続が切断されたことが検出されると、接続プーラーによってプールから接続が削除されます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-138">The connection pooler removes a connection from the pool after it has been idle for an extended period of time or if the pooler detects that the connection with the server has been severed.</span></span> <span data-ttu-id="c3e20-139">これを検出できるのは、サーバーとの通信を試みた後だけです。</span><span class="sxs-lookup"><span data-stu-id="c3e20-139">This can be detected only after attempting to communicate with the server.</span></span> <span data-ttu-id="c3e20-140">接続がサーバーに接続していないことがわかると、その接続は無効としてマークされます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-140">If a connection is found that is no longer connected to the server, it is marked as invalid.</span></span> <span data-ttu-id="c3e20-141">接続プーラーは、定期的に接続プールをスキャンし、プールから解放して無効としてマークするオブジェクトを検索します。</span><span class="sxs-lookup"><span data-stu-id="c3e20-141">The connection pooler periodically scans connection pools looking for objects that have been released to the pool and are marked as invalid.</span></span> <span data-ttu-id="c3e20-142">その後、それらの接続は永久に削除されます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-142">These connections are then permanently removed.</span></span>

 <span data-ttu-id="c3e20-143">既に存在しないサーバーへの接続が存在する場合は、接続プーラーが、その接続が切断されていることをまだ検出せず、無効というマークを付けていない状況のときに、プールからその接続を削除できます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-143">If a connection exists to a server that has disappeared, this connection can be drawn from the pool if the connection pooler has not detected the severed connection and marked it as invalid.</span></span> <span data-ttu-id="c3e20-144">このような状況が発生したときは、例外が生成されます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-144">When this occurs, an exception is generated.</span></span> <span data-ttu-id="c3e20-145">ただし、その場合も開発者は接続を終了して解放し、プールへ返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="c3e20-145">However, you must still close the connection in order to release it back into the pool.</span></span>

 <span data-ttu-id="c3e20-146">クラスの `Close` メソッド内で `Dispose`、`Connection`、またはその他のマネージド オブジェクトの `DataReader` または `Finalize` を呼び出さないでください。</span><span class="sxs-lookup"><span data-stu-id="c3e20-146">Do not call `Close` or `Dispose` on a `Connection`, a `DataReader`, or any other managed object in the `Finalize` method of your class.</span></span> <span data-ttu-id="c3e20-147">終了処理では、クラスに直接所有されているアンマネージ リソースだけを解放してください。</span><span class="sxs-lookup"><span data-stu-id="c3e20-147">In a finalizer, only release unmanaged resources that your class owns directly.</span></span> <span data-ttu-id="c3e20-148">クラスがアンマネージ リソースを所有していない場合は、クラス定義に `Finalize` メソッドを含めないでください。</span><span class="sxs-lookup"><span data-stu-id="c3e20-148">If your class does not own any unmanaged resources, do not include a `Finalize` method in your class definition.</span></span> <span data-ttu-id="c3e20-149">詳しくは、「[ガベージ コレクション](../../../standard/garbage-collection/index.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="c3e20-149">For more information, see [Garbage Collection](../../../standard/garbage-collection/index.md).</span></span>

### <a name="transaction-support"></a><span data-ttu-id="c3e20-150">トランザクションのサポート</span><span class="sxs-lookup"><span data-stu-id="c3e20-150">Transaction Support</span></span>

 <span data-ttu-id="c3e20-151">接続はプールから取り出され、トランザクション コンテキストに基づいて割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-151">Connections are drawn from the pool and assigned based on transaction context.</span></span> <span data-ttu-id="c3e20-152">要求スレッドのコンテキストと割り当てられた接続は一致している必要があります。</span><span class="sxs-lookup"><span data-stu-id="c3e20-152">The context of the requesting thread and the assigned connection must match.</span></span> <span data-ttu-id="c3e20-153">したがって、各接続プールは、トランザクション コンテキストに関連付けられていない接続の部分と、それぞれが特定のトランザクション コンテキストに関連付けられている接続を含む *N* 個の部分に分かれています。</span><span class="sxs-lookup"><span data-stu-id="c3e20-153">Therefore, each connection pool is subdivided into connections with no associated transaction context and into *N* subdivisions that each contain connections with a particular transaction context.</span></span>

 <span data-ttu-id="c3e20-154">接続が終了すると、その接続は解放されてプールへ返り、さらに、そのトランザクション コンテキストに基づいて特定のサブプールへ返ります。</span><span class="sxs-lookup"><span data-stu-id="c3e20-154">When a connection is closed, it is released back into the pool and into the appropriate subdivision based on its transaction context.</span></span> <span data-ttu-id="c3e20-155">そのため、分散トランザクションが保留状態である場合を含め、エラーを発生させることなく、開発者が接続を終了させることは可能です。</span><span class="sxs-lookup"><span data-stu-id="c3e20-155">Therefore, you can close the connection without generating an error, even though a distributed transaction is still pending.</span></span> <span data-ttu-id="c3e20-156">これにより、分散トランザクションを後でコミットまたはアボートできます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-156">This allows you to commit or abort the distributed transaction at a later time.</span></span>

### <a name="control-connection-pooling-with-connection-string-keywords"></a><span data-ttu-id="c3e20-157">接続文字列キーワードで接続プールを制御する</span><span class="sxs-lookup"><span data-stu-id="c3e20-157">Control Connection Pooling with Connection String Keywords</span></span>

 <span data-ttu-id="c3e20-158"><xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A> オブジェクトの <xref:System.Data.OracleClient.OracleConnection> プロパティは、接続プール ロジックの動作を調整するために使用できる接続文字列キーおよび値のペアをサポートします。</span><span class="sxs-lookup"><span data-stu-id="c3e20-158">The <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A> property of the <xref:System.Data.OracleClient.OracleConnection> object supports connection string key/value pairs that can be used to adjust the behavior of the connection pooling logic.</span></span>

 <span data-ttu-id="c3e20-159">接続プールの動作を調整するための <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A> 値についての説明を次の表に示します。</span><span class="sxs-lookup"><span data-stu-id="c3e20-159">The following table describes the <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A> values you can use to adjust connection pooling behavior.</span></span>

|<span data-ttu-id="c3e20-160">名前</span><span class="sxs-lookup"><span data-stu-id="c3e20-160">Name</span></span>|<span data-ttu-id="c3e20-161">Default</span><span class="sxs-lookup"><span data-stu-id="c3e20-161">Default</span></span>|<span data-ttu-id="c3e20-162">説明</span><span class="sxs-lookup"><span data-stu-id="c3e20-162">Description</span></span>|
|----------|-------------|-----------------|
|`Connection Lifetime`|<span data-ttu-id="c3e20-163">0</span><span class="sxs-lookup"><span data-stu-id="c3e20-163">0</span></span>|<span data-ttu-id="c3e20-164">接続がプールに返された時点で、その接続の作成時刻と現在の時刻を比較し、その時間の長さ (秒) が `Connection Lifetime` で指定した値を超えている場合は、その接続が破棄されます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-164">When a connection is returned to the pool, its creation time is compared with the current time, and the connection is destroyed if that time span (in seconds) exceeds the value specified by `Connection Lifetime`.</span></span> <span data-ttu-id="c3e20-165">これは、クラスター構成を採用している状況で、実行中のサーバーと、オンラインになったばかりのサーバーの間での、負荷を強制的に分散するのに便利です。</span><span class="sxs-lookup"><span data-stu-id="c3e20-165">This is useful in clustered configurations to force load balancing between a running server and a server just brought online.</span></span><br /><br /> <span data-ttu-id="c3e20-166">値ゼロ (0) を指定した場合は、プールされている接続に、最大のタイムアウトが割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-166">A value of zero (0) will cause pooled connections to have the maximum time-out.</span></span>|
|`Enlist`|<span data-ttu-id="c3e20-167">'true'</span><span class="sxs-lookup"><span data-stu-id="c3e20-167">'true'</span></span>|<span data-ttu-id="c3e20-168">`true` に設定すると、トランザクション コンテキストが存在する場合、プーラーは自動的に、作成スレッドの現在のトランザクション コンテキストの中に、その接続を参加させます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-168">When `true`, the pooler automatically enlists the connection in the current transaction context of the creation thread if a transaction context exists.</span></span>|
|`Max Pool Size`|<span data-ttu-id="c3e20-169">100</span><span class="sxs-lookup"><span data-stu-id="c3e20-169">100</span></span>|<span data-ttu-id="c3e20-170">プールに格納できる最大接続数。</span><span class="sxs-lookup"><span data-stu-id="c3e20-170">The maximum number of connections allowed in the pool.</span></span>|
|`Min Pool Size`|<span data-ttu-id="c3e20-171">0</span><span class="sxs-lookup"><span data-stu-id="c3e20-171">0</span></span>|<span data-ttu-id="c3e20-172">プールで維持できる最小接続数。</span><span class="sxs-lookup"><span data-stu-id="c3e20-172">The minimum number of connections maintained in the pool.</span></span>|
|`Pooling`|<span data-ttu-id="c3e20-173">'true'</span><span class="sxs-lookup"><span data-stu-id="c3e20-173">'true'</span></span>|<span data-ttu-id="c3e20-174">`true` に設定すると、接続が適切なプールから取り出されるか、または必要に応じて作成され、適切なプールに追加されます。</span><span class="sxs-lookup"><span data-stu-id="c3e20-174">When `true`, the connection is drawn from the appropriate pool, or if necessary, created and added to the appropriate pool.</span></span>|

## <a name="see-also"></a><span data-ttu-id="c3e20-175">関連項目</span><span class="sxs-lookup"><span data-stu-id="c3e20-175">See also</span></span>

- [<span data-ttu-id="c3e20-176">接続プール</span><span class="sxs-lookup"><span data-stu-id="c3e20-176">Connection Pooling</span></span>](connection-pooling.md)
- [<span data-ttu-id="c3e20-177">パフォーマンス カウンター</span><span class="sxs-lookup"><span data-stu-id="c3e20-177">Performance Counters</span></span>](performance-counters.md)
- [<span data-ttu-id="c3e20-178">ADO.NET の概要</span><span class="sxs-lookup"><span data-stu-id="c3e20-178">ADO.NET Overview</span></span>](ado-net-overview.md)
