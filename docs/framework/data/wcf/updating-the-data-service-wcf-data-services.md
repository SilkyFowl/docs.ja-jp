---
description: '詳細情報: データ サービスの更新 (WCF Data Services)'
title: データ サービスの更新 (WCF Data Services)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF Data Services, changing data
- WCF Data Services, client library
ms.assetid: 00d993be-ffed-4dea-baf7-6eea982cdb54
ms.openlocfilehash: 3223207b310c28d8e586a537b5c76b7e1b7ca17c
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99764893"
---
# <a name="updating-the-data-service-wcf-data-services"></a><span data-ttu-id="91f5f-103">データ サービスの更新 (WCF Data Services)</span><span class="sxs-lookup"><span data-stu-id="91f5f-103">Updating the Data Service (WCF Data Services)</span></span>

[!INCLUDE [wcf-deprecated](~/includes/wcf-deprecated.md)]

<span data-ttu-id="91f5f-104">WCF Data Services クライアント ライブラリを使用して Open Data Protocol (OData) フィードを操作する場合、フィード内のエントリがクライアント データ サービス クラスのインスタンスに変換されます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-104">When you use the WCF Data Services client library to consume an Open Data Protocol (OData) feed, the library translates the entries in the feed into instances of client data service classes.</span></span> <span data-ttu-id="91f5f-105">これらのデータ サービス クラスは、<xref:System.Data.Services.Client.DataServiceContext> が属する <xref:System.Data.Services.Client.DataServiceQuery%601> を使用して追跡されます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-105">These data service classes are tracked by using the <xref:System.Data.Services.Client.DataServiceContext> to which the <xref:System.Data.Services.Client.DataServiceQuery%601> belongs.</span></span> <span data-ttu-id="91f5f-106">クライアントでは、<xref:System.Data.Services.Client.DataServiceContext> にメソッドを使用して報告する、エンティティへの変更が追跡されます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-106">The client tracks changes to entities that you report by using methods on <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="91f5f-107">これらのメソッドを使用すると、クライアントは、追加および削除されたエンティティの追跡に加えて、プロパティ値に対して行われた変更やエンティティ インスタンス間のリレーションシップに対して行われた変更を追跡できます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-107">These methods enable the client to track added and deleted entities and also changes that you make to property values or to relationships between entity instances.</span></span> <span data-ttu-id="91f5f-108">追跡されたこれらの変更は、<xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> メソッドが呼び出されたときに、REST ベースの操作としてデータ サービスに送り返されます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-108">Those tracked changes are sent back to the data service as REST-based operations when you call the <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> method.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="91f5f-109"><xref:System.Data.Services.Client.DataServiceCollection%601> のインスタンスを使用してデータをコントロールにバインドする場合、バインドされたコントロールのデータに対して行われた変更は <xref:System.Data.Services.Client.DataServiceContext> に自動的に報告されます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-109">When you use an instance of <xref:System.Data.Services.Client.DataServiceCollection%601> to bind data to controls, changes made to data in the bound control are automatically reported to the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="91f5f-110">詳しくは、「[コントロールへのデータのバインド](binding-data-to-controls-wcf-data-services.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="91f5f-110">For more information, see [Binding Data to Controls](binding-data-to-controls-wcf-data-services.md).</span></span>  
  
## <a name="adding-modifying-and-changing-entities"></a><span data-ttu-id="91f5f-111">エンティティの追加および変更</span><span class="sxs-lookup"><span data-stu-id="91f5f-111">Adding, Modifying, and Changing Entities</span></span>  

 <span data-ttu-id="91f5f-112">Visual Studio の **[サービス参照の追加]** ダイアログを使用して OData フィードへの参照を追加した場合、結果のクライアント データ サービス クラスにはそれぞれ、静的な *Create* メソッドが作成されます。このメソッドは、null 非許容のエンティティ プロパティごとに 1 つのパラメーターを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="91f5f-112">When you use the **Add Service Reference** dialog in Visual Studio to add a reference to an OData feed, the resulting client data service classes each have a static *Create* method that takes one parameter for each non-nullable entity property.</span></span> <span data-ttu-id="91f5f-113">このメソッドを使用すると、次の例に示すように、エンティティ型クラスのインスタンスを作成できます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-113">You can use this method to create instances of entity type classes, as in the following example:</span></span>  
  
 [!code-csharp[Astoria Northwind Client#CreateNewProduct](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#createnewproduct)]
 [!code-vb[Astoria Northwind Client#CreateNewProduct](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#createnewproduct)]  
  
 <span data-ttu-id="91f5f-114">エンティティ インスタンスを追加するには、次の例に示すように、 **[サービス参照の追加]** ダイアログ ボックスによって生成された <xref:System.Data.Services.Client.DataServiceContext> クラスで適切な *AddTo* メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-114">To add an entity instance, call the appropriate *AddTo* method on the <xref:System.Data.Services.Client.DataServiceContext> class generated by the **Add Service Reference** dialog box, as in the following example:</span></span>  
  
 [!code-csharp[Astoria Northwind Client#AddProductSpecific](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#addproductspecific)]
 [!code-vb[Astoria Northwind Client#AddProductSpecific](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#addproductspecific)]  
  
 <span data-ttu-id="91f5f-115">オブジェクトがコンテキストおよび正しいエンティティ セットに追加されます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-115">This adds the object to the context and into the correct entity set.</span></span> <span data-ttu-id="91f5f-116"><xref:System.Data.Services.Client.DataServiceContext.AddObject%2A> を呼び出すこともできますが、エンティティ セット名を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="91f5f-116">You can also call <xref:System.Data.Services.Client.DataServiceContext.AddObject%2A>, but you must instead supply the entity set name.</span></span> <span data-ttu-id="91f5f-117">追加したエンティティにその他のエンティティへの 1 つ以上のリレーションシップがある場合は、<xref:System.Data.Services.Client.DataServiceContext.AddRelatedObject%2A> メソッドを使用するか、前のメソッドの 1 つを使用してこれらのリンクを明示的に定義することができます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-117">If the added entity has one or more relationships to other entities, you can either use the <xref:System.Data.Services.Client.DataServiceContext.AddRelatedObject%2A> method or use one of the previous methods and also explicitly define those links.</span></span> <span data-ttu-id="91f5f-118">これらの操作の詳細については、このトピックの後半で説明します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-118">These operations are discussed later in this topic.</span></span>  
  
 <span data-ttu-id="91f5f-119">既存のエンティティ インスタンスを変更するには、まずそのエンティティを照会し、このエンティティのプロパティに必要な変更を加えてから、オブジェクトの更新を送信する必要があることをクライアント ライブラリに示すために、次のように <xref:System.Data.Services.Client.DataServiceContext.UpdateObject%2A> で <xref:System.Data.Services.Client.DataServiceContext> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-119">To modify an existing entity instance, first query for that entity, make the desired changes to its properties, and then call the <xref:System.Data.Services.Client.DataServiceContext.UpdateObject%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> to indicate to the client library that it needs to send an update for that object, as shown in the following example:</span></span>  
  
 [!code-csharp[Astoria Northwind Client#ModifyCustomerSpecific](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#modifycustomerspecific)]
 [!code-vb[Astoria Northwind Client#ModifyCustomerSpecific](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#modifycustomerspecific)]  
  
 <span data-ttu-id="91f5f-120">エンティティ インスタンスを削除するには、次の例に示すように、<xref:System.Data.Services.Client.DataServiceContext.DeleteObject%2A> で <xref:System.Data.Services.Client.DataServiceContext> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-120">To delete an entity instance, call the <xref:System.Data.Services.Client.DataServiceContext.DeleteObject%2A> method on the <xref:System.Data.Services.Client.DataServiceContext>, as shown in the following example:</span></span>  
  
 [!code-csharp[Astoria Northwind Client#DeleteProductSpecific](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#deleteproductspecific)]
 [!code-vb[Astoria Northwind Client#DeleteProductSpecific](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#deleteproductspecific)]  
  
 <span data-ttu-id="91f5f-121">詳細については、[エンティティを追加、変更、および削除する](how-to-add-modify-and-delete-entities-wcf-data-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="91f5f-121">For more information, see [How to: Add, Modify, and Delete Entities](how-to-add-modify-and-delete-entities-wcf-data-services.md).</span></span>  
  
## <a name="attaching-entities"></a><span data-ttu-id="91f5f-122">エンティティのアタッチ</span><span class="sxs-lookup"><span data-stu-id="91f5f-122">Attaching Entities</span></span>  

 <span data-ttu-id="91f5f-123">クライアント ライブラリでは、クエリを実行してエンティティを <xref:System.Data.Services.Client.DataServiceContext> に読み込むことなく、エンティティに対して行った変更を保存できます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-123">The client library enables you to save updates that you made to an entity without first executing a query to load the entity into the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="91f5f-124"><xref:System.Data.Services.Client.DataServiceContext.AttachTo%2A> メソッドを使用して、既存のオブジェクトを <xref:System.Data.Services.Client.DataServiceContext> の特定のエンティティ セットにアタッチします。</span><span class="sxs-lookup"><span data-stu-id="91f5f-124">Use the <xref:System.Data.Services.Client.DataServiceContext.AttachTo%2A> method to attach an existing object to a specific entity set in the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="91f5f-125">その後、オブジェクトを変更して、変更内容をデータ サービスに保存できます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-125">You can then modify the object and save the changes to the data service.</span></span> <span data-ttu-id="91f5f-126">次の例では、変更された顧客オブジェクトがコンテキストにアタッチされた後、<xref:System.Data.Services.Client.DataServiceContext.UpdateObject%2A> が呼び出される前に、<xref:System.Data.Services.Client.EntityStates.Modified> が呼び出され、アタッチされたオブジェクトが <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> としてマークされます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-126">In the following example, a customer object that has been changed is attached to the context and then <xref:System.Data.Services.Client.DataServiceContext.UpdateObject%2A> is called to mark the attached object as <xref:System.Data.Services.Client.EntityStates.Modified> before <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> is called:</span></span>  
  
 [!code-csharp[Astoria Northwind Client#AttachObjectSpecific](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#attachobjectspecific)]
 [!code-vb[Astoria Northwind Client#AttachObjectSpecific](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#attachobjectspecific)]  
  
 <span data-ttu-id="91f5f-127">オブジェクトをアタッチする際は、次の点に注意してください。</span><span class="sxs-lookup"><span data-stu-id="91f5f-127">The following considerations apply when attaching objects:</span></span>  
  
- <span data-ttu-id="91f5f-128">オブジェクトは、<xref:System.Data.Services.Client.EntityStates.Unchanged> 状態でアタッチされます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-128">An object is attached in the <xref:System.Data.Services.Client.EntityStates.Unchanged> state.</span></span>  
  
- <span data-ttu-id="91f5f-129">オブジェクトがアタッチされるとき、アタッチされるオブジェクトに関連付けられたオブジェクトはアタッチされません。</span><span class="sxs-lookup"><span data-stu-id="91f5f-129">When an object is attached, objects that are related to the attached object are not also attached.</span></span>  
  
- <span data-ttu-id="91f5f-130">エンティティがコンテキストによって既に追跡されている場合は、オブジェクトをアタッチできません。</span><span class="sxs-lookup"><span data-stu-id="91f5f-130">An object cannot be attached if the entity is already being tracked by the context.</span></span>  
  
- <span data-ttu-id="91f5f-131">eTag 値と一緒に受け取ったエンティティ オブジェクトをアタッチした場合は、<xref:System.Data.Services.Client.DataServiceContext.AttachTo%28System.String%2CSystem.Object%2CSystem.String%29> メソッドの、`etag` パラメーターを受け取るオーバーロードが使用されます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-131">The <xref:System.Data.Services.Client.DataServiceContext.AttachTo%28System.String%2CSystem.Object%2CSystem.String%29> method overload that takes an `etag` parameter is used when you attach an entity object that was received along with an eTag value.</span></span> <span data-ttu-id="91f5f-132">この eTag 値は、アタッチされたオブジェクトへの変更を保存したときに、コンカレンシーをチェックするために使用されます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-132">This eTag value is then used to check for concurrency when changes to the attached object are saved.</span></span>  
  
 <span data-ttu-id="91f5f-133">詳細については、[既存のエンティティを DataServiceContext にアタッチする](attach-an-existing-entity-to-dc-wcf-data.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="91f5f-133">For more information, see [How to: Attach an Existing Entity to the DataServiceContext](attach-an-existing-entity-to-dc-wcf-data.md).</span></span>  
  
## <a name="creating-and-modifying-relationship-links"></a><span data-ttu-id="91f5f-134">リレーションシップ リンクの作成および変更</span><span class="sxs-lookup"><span data-stu-id="91f5f-134">Creating and Modifying Relationship Links</span></span>  

 <span data-ttu-id="91f5f-135">**[サービス参照の追加]** ダイアログで生成された <xref:System.Data.Services.Client.DataServiceContext> クラスの <xref:System.Data.Services.Client.DataServiceContext.AddObject%2A> メソッド、または適切な *AddTo* メソッドを使用して新しいエンティティを追加する場合、新しいエンティティと関連付けられたエンティティの間のリレーションシップの自動定義は行われません。</span><span class="sxs-lookup"><span data-stu-id="91f5f-135">When you add a new entity by using either the <xref:System.Data.Services.Client.DataServiceContext.AddObject%2A> method or the appropriate *AddTo* method of the <xref:System.Data.Services.Client.DataServiceContext> class that the **Add Service Reference** dialog generates, any relationships between the new entity and related entities are not automatically defined.</span></span>  
  
 <span data-ttu-id="91f5f-136">エンティティ インスタンス間のリレーションシップを作成および変更し、クライアント ライブラリを使用して、これらの変更をデータ サービスに反映できます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-136">You can create and change relationships between entity instances and have the client library reflect those changes in the data service.</span></span> <span data-ttu-id="91f5f-137">エンティティ間のリレーションシップは、モデル内の関連付けとして定義されています。また、<xref:System.Data.Services.Client.DataServiceContext> は、各リレーションシップをコンテキスト内のリンク オブジェクトとして追跡します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-137">Relationships between entities are defined as associations in the model, and the <xref:System.Data.Services.Client.DataServiceContext> tracks each relationship as a link object in the context.</span></span> <span data-ttu-id="91f5f-138">WCF Data Services は、<xref:System.Data.Services.Client.DataServiceContext> クラスで、これらのリンクを作成、変更、および削除する以下のメソッドを提供します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-138">WCF Data Services provides the following methods on the <xref:System.Data.Services.Client.DataServiceContext> class to create, modify, and delete these links:</span></span>  
  
|<span data-ttu-id="91f5f-139">メソッド</span><span class="sxs-lookup"><span data-stu-id="91f5f-139">Method</span></span>|<span data-ttu-id="91f5f-140">説明</span><span class="sxs-lookup"><span data-stu-id="91f5f-140">Description</span></span>|  
|------------|-----------------|  
|<xref:System.Data.Services.Client.DataServiceContext.AddRelatedObject%2A>|<span data-ttu-id="91f5f-141">関連付けられた 2 つのエンティティ オブジェクトの間に新しいリンクを作成します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-141">Creates a new link between two related entity objects.</span></span> <span data-ttu-id="91f5f-142">このメソッドを呼び出すことは、<xref:System.Data.Services.Client.DataServiceContext.AddObject%2A> と <xref:System.Data.Services.Client.DataServiceContext.AddLink%2A> を呼び出して、新しいオブジェクトを作成すること、および既存のオブジェクトへのリレーションシップを定義することと同じです。</span><span class="sxs-lookup"><span data-stu-id="91f5f-142">Calling this method is equivalent to calling <xref:System.Data.Services.Client.DataServiceContext.AddObject%2A> and <xref:System.Data.Services.Client.DataServiceContext.AddLink%2A> to both create the new object and define the relationship to an existing object.</span></span>|  
|<xref:System.Data.Services.Client.DataServiceContext.AddLink%2A>|<span data-ttu-id="91f5f-143">関連付けられた 2 つのエンティティ オブジェクトの間に新しいリンクを作成します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-143">Creates a new link between two related entity objects.</span></span>|  
|<xref:System.Data.Services.Client.DataServiceContext.SetLink%2A>|<span data-ttu-id="91f5f-144">関連付けられた 2 つのエンティティ オブジェクト間の既存のリンクを更新します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-144">Updates an existing link between two related entity objects.</span></span> <span data-ttu-id="91f5f-145">また、<xref:System.Data.Services.Client.DataServiceContext.SetLink%2A> は、0 または 1 対 1 (`0..1:1`) および 1 対 1 (`1:1`) のカーディナリティを持つリンクの削除にも使用します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-145"><xref:System.Data.Services.Client.DataServiceContext.SetLink%2A> is also used to delete links with a cardinality of zero-or-one-to-one (`0..1:1`) and one-to-one (`1:1`).</span></span> <span data-ttu-id="91f5f-146">これを行うには、関連付けられたオブジェクトを `null` に設定します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-146">You can do this by setting the related object to `null`.</span></span>|  
|<xref:System.Data.Services.Client.DataServiceContext.DeleteLink%2A>|<span data-ttu-id="91f5f-147"><xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> メソッドが呼び出されたときに、コンテキストが追跡するリンクに削除のマークを付けます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-147">Marks a link that the context is tracking for deletion when the <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> method is called.</span></span> <span data-ttu-id="91f5f-148">このメソッドは、関連付けられたオブジェクトを削除する場合、または既存のオブジェクトへのリンクを削除した後に関連付けられた新しいオブジェクトへのリンクを追加してリレーションシップを変更する場合に使用します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-148">Use this method when you delete a related object or change a relationship by first deleting the link to an existing object and then adding a link to the new related object.</span></span>|  
|<xref:System.Data.Services.Client.DataServiceContext.AttachLink%2A>|<span data-ttu-id="91f5f-149">2 つのエンティティ オブジェクトの間の既存のリンクのコンテキストを通知します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-149">Notifies the context of an existing link between two entity objects.</span></span> <span data-ttu-id="91f5f-150">コンテキストでは、このリレーションシップがデータ サービス内に既に存在するものと見なされるので、<xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> メソッドを呼び出してもリンクは作成されません。</span><span class="sxs-lookup"><span data-stu-id="91f5f-150">The context assumes that this relationship already exists in the data service and does not try to create the link when you call the <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> method.</span></span> <span data-ttu-id="91f5f-151">このメソッドは、2 つのオブジェクトをコンテキストにアタッチして、オブジェクト間のリンクもアタッチする必要がある場合に使用します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-151">Use this method when you attach objects to a context and need to also attach the link between the two.</span></span> <span data-ttu-id="91f5f-152">新しいリレーションシップを定義する場合は、<xref:System.Data.Services.Client.DataServiceContext.AddLink%2A> を使用してください。</span><span class="sxs-lookup"><span data-stu-id="91f5f-152">If you are defining a new relationship, you should instead use <xref:System.Data.Services.Client.DataServiceContext.AddLink%2A>.</span></span>|  
|<xref:System.Data.Services.Client.DataServiceContext.DetachLink%2A>|<span data-ttu-id="91f5f-153">コンテキストでの指定リンクの追跡を停止します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-153">Stops tracking the specified link in the context.</span></span> <span data-ttu-id="91f5f-154">このメソッドは、一対多 (`*:*`) のリレーションシップの削除に使用します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-154">This method is used to delete one-to-many (`*:*`) relationships.</span></span> <span data-ttu-id="91f5f-155">カーディナリティが 1 のリレーションシップ リンクの場合は、<xref:System.Data.Services.Client.DataServiceContext.SetLink%2A> を代わりに使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="91f5f-155">For relationship links with a cardinality of one, you must instead use <xref:System.Data.Services.Client.DataServiceContext.SetLink%2A>.</span></span>|  
  
 <span data-ttu-id="91f5f-156">次の例は、<xref:System.Data.Services.Client.DataServiceContext.AddRelatedObject%2A> メソッドを使用して、既存の `Order_Detail` エンティティに関連付けられた新しい `Orders` を追加する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-156">The following example shows how to use the <xref:System.Data.Services.Client.DataServiceContext.AddRelatedObject%2A> method to add a new `Order_Detail` that is related to an existing `Orders` entity.</span></span> <span data-ttu-id="91f5f-157">新しい `Order_Details` オブジェクトは <xref:System.Data.Services.Client.DataServiceContext> によって追跡されるので、既存の `Order_Details` エンティティと追加された `Products` オブジェクトのリレーションシップは、<xref:System.Data.Services.Client.DataServiceContext.AddLink%2A> メソッドを呼び出すことによって定義されます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-157">Because the new `Order_Details` object is now tracked by the <xref:System.Data.Services.Client.DataServiceContext>, the relationship of the added `Order_Details` object to the existing `Products` entity is defined by calling the <xref:System.Data.Services.Client.DataServiceContext.AddLink%2A> method:</span></span>  
  
 [!code-csharp[Astoria Northwind Client#AddOrderDetailToOrderSpecific](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#addorderdetailtoorderspecific)]
 [!code-vb[Astoria Northwind Client#AddOrderDetailToOrderSpecific](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#addorderdetailtoorderspecific)]  
  
 <span data-ttu-id="91f5f-158"><xref:System.Data.Services.Client.DataServiceContext.AddLink%2A> メソッドは、データ サービス内に作成する必要のあるリンクを定義しますが、これらのリンクをコンテキスト内のオブジェクトに反映させるには、オブジェクト自身でナビゲーション プロパティを設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="91f5f-158">While the <xref:System.Data.Services.Client.DataServiceContext.AddLink%2A> method defines links that must be created in the data service, to have these links reflected in the objects that are in the context, you must also set the navigation properties on the objects themselves.</span></span> <span data-ttu-id="91f5f-159">前の例では、次のようにナビゲーション プロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-159">In the previous example, you should set the navigation properties as follows:</span></span>  
  
 [!code-csharp[Astoria Northwind Client#SetNavProps](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#setnavprops)]
 [!code-vb[Astoria Northwind Client#SetNavProps](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#setnavprops)]  
  
 <span data-ttu-id="91f5f-160">詳細については、[エンティティ リレーションシップを定義する](how-to-define-entity-relationships-wcf-data-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="91f5f-160">For more information, see [How to: Define Entity Relationships](how-to-define-entity-relationships-wcf-data-services.md).</span></span>  
  
## <a name="saving-changes"></a><span data-ttu-id="91f5f-161">変更の保存</span><span class="sxs-lookup"><span data-stu-id="91f5f-161">Saving Changes</span></span>  

 <span data-ttu-id="91f5f-162">変更は、<xref:System.Data.Services.Client.DataServiceContext> インスタンスで追跡されますが、サーバーには直ちに送信されません。</span><span class="sxs-lookup"><span data-stu-id="91f5f-162">Changes are tracked in the <xref:System.Data.Services.Client.DataServiceContext> instance but not sent to the server immediately.</span></span> <span data-ttu-id="91f5f-163">指定されたアクティビティに対して必要な変更が完了した後、<xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> を呼び出して、すべての変更をデータ サービスに送信します。</span><span class="sxs-lookup"><span data-stu-id="91f5f-163">After you are finished with the required changes for a specified activity, call <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> to submit all the changes to the data service.</span></span> <span data-ttu-id="91f5f-164">詳細については、「[データ サービス コンテキストの管理](managing-the-data-service-context-wcf-data-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="91f5f-164">For more information, see [Managing the Data Service Context](managing-the-data-service-context-wcf-data-services.md).</span></span> <span data-ttu-id="91f5f-165">変更は、<xref:System.Data.Services.Client.DataServiceContext.BeginSaveChanges%2A> および <xref:System.Data.Services.Client.DataServiceContext.EndSaveChanges%2A> メソッドを使用して、非同期で保存することもできます。</span><span class="sxs-lookup"><span data-stu-id="91f5f-165">You can also save changes asynchronously by using the <xref:System.Data.Services.Client.DataServiceContext.BeginSaveChanges%2A> and <xref:System.Data.Services.Client.DataServiceContext.EndSaveChanges%2A> methods.</span></span> <span data-ttu-id="91f5f-166">詳細については、「[非同期操作](asynchronous-operations-wcf-data-services.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="91f5f-166">For more information, see [Asynchronous Operations](asynchronous-operations-wcf-data-services.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="91f5f-167">関連項目</span><span class="sxs-lookup"><span data-stu-id="91f5f-167">See also</span></span>

- [<span data-ttu-id="91f5f-168">WCF Data Services クライアント ライブラリ</span><span class="sxs-lookup"><span data-stu-id="91f5f-168">WCF Data Services Client Library</span></span>](wcf-data-services-client-library.md)
- [<span data-ttu-id="91f5f-169">データ サービスに対するクエリ</span><span class="sxs-lookup"><span data-stu-id="91f5f-169">Querying the Data Service</span></span>](querying-the-data-service-wcf-data-services.md)
- [<span data-ttu-id="91f5f-170">非同期操作</span><span class="sxs-lookup"><span data-stu-id="91f5f-170">Asynchronous Operations</span></span>](asynchronous-operations-wcf-data-services.md)
- [<span data-ttu-id="91f5f-171">バッチ処理</span><span class="sxs-lookup"><span data-stu-id="91f5f-171">Batching Operations</span></span>](batching-operations-wcf-data-services.md)
- [<span data-ttu-id="91f5f-172">オブジェクトの具体化</span><span class="sxs-lookup"><span data-stu-id="91f5f-172">Object Materialization</span></span>](object-materialization-wcf-data-services.md)
- [<span data-ttu-id="91f5f-173">データ サービス コンテキストの管理</span><span class="sxs-lookup"><span data-stu-id="91f5f-173">Managing the Data Service Context</span></span>](managing-the-data-service-context-wcf-data-services.md)
