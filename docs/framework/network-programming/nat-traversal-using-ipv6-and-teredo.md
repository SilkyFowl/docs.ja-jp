---
description: '詳細情報: IPv6 および Teredo を使用した NAT トラバーサル'
title: IPv6 および Teredo を使用した NAT トラバーサル
ms.date: 03/30/2017
ms.assetid: 568cd245-3300-49ef-a995-d81bf845d961
ms.openlocfilehash: 4ff7f273c01ef52f4d307cbd3e0698c5cc2ead4d
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99785745"
---
# <a name="nat-traversal-using-ipv6-and-teredo"></a><span data-ttu-id="82a8e-103">IPv6 および Teredo を使用した NAT トラバーサル</span><span class="sxs-lookup"><span data-stu-id="82a8e-103">NAT Traversal using IPv6 and Teredo</span></span>

<span data-ttu-id="82a8e-104">ネットワーク アドレス変換 (NAT) トラバーサルをサポートする機能強化が行われました。</span><span class="sxs-lookup"><span data-stu-id="82a8e-104">Enhancements were made that provide support for Network Address Translation (NAT) traversal.</span></span> <span data-ttu-id="82a8e-105">これらの変更は、IPv6 および Teredo での使用を想定して設計されていますが、他の IP トンネリング テクノロジにも適用されます。</span><span class="sxs-lookup"><span data-stu-id="82a8e-105">These changes are designed for use with IPv6 and Teredo, but they are also applicable to other IP tunneling technologies.</span></span> <span data-ttu-id="82a8e-106">これらの拡張機能は、<xref:System.Net> および関連する名前空間のクラスに影響します。</span><span class="sxs-lookup"><span data-stu-id="82a8e-106">These enhancements affect classes in the <xref:System.Net> and related namespaces.</span></span>  
  
 <span data-ttu-id="82a8e-107">これらの変更は、IP トンネリング テクノロジを使用するクライアント サーバー アプリケーションに影響を与える可能性があります。</span><span class="sxs-lookup"><span data-stu-id="82a8e-107">These changes can affect client and server applications that plan to use IP tunneling technologies.</span></span>  
  
 <span data-ttu-id="82a8e-108">NAT トラバーサルをサポートするための変更は、.NET Framework Version 4 を使用しているアプリケーションでのみ機能します。</span><span class="sxs-lookup"><span data-stu-id="82a8e-108">The changes to support NAT traversal are available only for applications using .NET Framework version 4.</span></span> <span data-ttu-id="82a8e-109">これらの機能は、.NET Framework の以前のバージョンではご利用いただけません。</span><span class="sxs-lookup"><span data-stu-id="82a8e-109">These features are not available on earlier versions of the .NET Framework.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="82a8e-110">概要</span><span class="sxs-lookup"><span data-stu-id="82a8e-110">Overview</span></span>  

 <span data-ttu-id="82a8e-111">Internet Protocol version 4 (IPv4) では、IPv4 アドレスが 32 ビット長として定義されました。</span><span class="sxs-lookup"><span data-stu-id="82a8e-111">The Internet Protocol version 4 (IPv4) defined an IPv4 address as 32 bits long.</span></span> <span data-ttu-id="82a8e-112">その結果、IPv4 は約 40 億個の一意の IP アドレスをサポートしています (2 ^32)。</span><span class="sxs-lookup"><span data-stu-id="82a8e-112">As a result, IPv4 supports approximately 4 billion unique IP addresses (2^32).</span></span> <span data-ttu-id="82a8e-113">1990 年代にインターネット上のコンピューターやネットワーク デバイスの数が拡大したため、IPv4 アドレス空間の逼迫が明らかになりました。</span><span class="sxs-lookup"><span data-stu-id="82a8e-113">As the number of computers and network devices on the Internet expanded in the 1990s, the limits of the IPv4 address space became apparent.</span></span>  
  
 <span data-ttu-id="82a8e-114">IPv4 の枯渇を遅らせるために採用された複数の手法の 1 つが、単一の一意なパブリック IP アドレスで多数のプライベート IP アドレス (プライベート イントラネット) を表すことができる NAT の展開でした。</span><span class="sxs-lookup"><span data-stu-id="82a8e-114">One of several techniques used to extend the lifetime of IPv4 has been to deploy NAT to allow a single unique public IP address to represent a large number of private IP addresses (private Intranet).</span></span> <span data-ttu-id="82a8e-115">NAT デバイスの背後にあるプライベート IP アドレスは、単一のパブリック IPv4 アドレスを共有しています。</span><span class="sxs-lookup"><span data-stu-id="82a8e-115">The private IP addresses behind the NAT device share the single public IPv4 address.</span></span> <span data-ttu-id="82a8e-116">専用ハードウェア デバイス (安価なワイヤレス アクセス ポイントとルーターなど) や、NAT を提供するサービスを実行しているコンピューターを NAT デバイスとすることができます。</span><span class="sxs-lookup"><span data-stu-id="82a8e-116">The NAT device may be a dedicated hardware device (an inexpensive Wireless Access Point and router, for example) or a computer running a service to provide NAT.</span></span> <span data-ttu-id="82a8e-117">このパブリック IP アドレスを提供するデバイスまたはサービスは、パブリック インターネットとプライベート イントラネットの間で IP ネットワーク パケットを変換します。</span><span class="sxs-lookup"><span data-stu-id="82a8e-117">A device or service for this public IP address translates IP network packets between the public Internet and the private Intranet.</span></span>  
  
 <span data-ttu-id="82a8e-118">プライベート イントラネットで実行され、インターネット上の他の IP アドレス (通常はサーバー) に要求を送信するクライアント アプリケーションの場合、このスキームが効果的です。</span><span class="sxs-lookup"><span data-stu-id="82a8e-118">This scheme works well for client applications running on the private Intranet that send requests to other IP addresses (usually servers) on the Internet.</span></span> <span data-ttu-id="82a8e-119">NAT デバイスまたはサーバーはクライアント要求のマッピングを維持しており、応答が返されたときに応答の送信先を認識できます。</span><span class="sxs-lookup"><span data-stu-id="82a8e-119">The NAT device or server can keep a mapping of client requests so when a response is returned it knows where to send the response.</span></span> <span data-ttu-id="82a8e-120">一方、NAT デバイスの背後のプライベート イントラネットで実行され、サービスを提供し、パケットをリッスンして応答するアプリケーションの場合、このスキームには問題があります。</span><span class="sxs-lookup"><span data-stu-id="82a8e-120">But this scheme poses problems for applications running in the private Intranet behind the NAT device that want to provide services, listen for packets, and respond.</span></span> <span data-ttu-id="82a8e-121">ピアツーピア アプリケーションの場合は特に顕著です。</span><span class="sxs-lookup"><span data-stu-id="82a8e-121">This is particularly the case for peer-to-peer applications.</span></span>  
  
 <span data-ttu-id="82a8e-122">IPv6 プロトコルは、IPv4 アドレスを 128 ビット長と定義しています。</span><span class="sxs-lookup"><span data-stu-id="82a8e-122">The IPv6 protocol defined an IPv4 address as 128 bits long.</span></span> <span data-ttu-id="82a8e-123">その結果、IPv6 は、3.2 x 10^38 個の一意のアドレス (2 ^128) が使用できる非常に大規模な IP アドレス空間をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="82a8e-123">As a result, IPv6 supports very a large IP address space of 3.2 x 10^38 unique addresses (2^128).</span></span> <span data-ttu-id="82a8e-124">このサイズのアドレス空間があるため、インターネットに接続されたすべてのデバイスに、それぞれ固有のアドレスを付与することができます。</span><span class="sxs-lookup"><span data-stu-id="82a8e-124">With an address space of this size, it is possible for every device connected to the Internet to be given a unique address.</span></span> <span data-ttu-id="82a8e-125">ところが、これには問題があります。</span><span class="sxs-lookup"><span data-stu-id="82a8e-125">But there are problems.</span></span> <span data-ttu-id="82a8e-126">世界の大部分では、まだ IPv4 だけを使用しています。</span><span class="sxs-lookup"><span data-stu-id="82a8e-126">Much of the world is still using only IPv4.</span></span> <span data-ttu-id="82a8e-127">具体的には、小規模な企業、組織、家庭で使用されている既存のルーターやワイヤレス アクセス ポイントは、IPv6 をサポートしていません。</span><span class="sxs-lookup"><span data-stu-id="82a8e-127">In particular, many of the existing routers and wireless access points used by small companies, organizations, and households do not support IPv6.</span></span> <span data-ttu-id="82a8e-128">それらの顧客にサービスを提供する一部のインターネット サービス プロバイダーも、IPv6 をサポートしていないか、IPv6 のサポートを構成に組み込んでいません。</span><span class="sxs-lookup"><span data-stu-id="82a8e-128">Also some Internet service providers that serve these customers either do not support or have not configured support for IPv6.</span></span>  
  
 <span data-ttu-id="82a8e-129">IPv4 パケットで IPv6 アドレスをトンネリングするために、複数の IPv6 移行テクノロジが開発されています。</span><span class="sxs-lookup"><span data-stu-id="82a8e-129">Several IPv6 transition technologies have been developed to tunnel IPv6 addresses in an IPv4 packet.</span></span> <span data-ttu-id="82a8e-130">そのようなテクノロジとして、6to4、ISATAP、Teredo のトンネルがあります。これらのテクノロジは、IPv6 ホストが他の IPv6 ネットワークに到達するために IPv4 ネットワークを経由する必要があるときに、ユニキャスト IPv6 トラフィックに対するアドレス割り当てとホスト間の自動トンネリングを提供します。</span><span class="sxs-lookup"><span data-stu-id="82a8e-130">These technologies include 6to4, ISATAP, and Teredo tunnels that provide address assignment and host-to-host automatic tunneling for unicast IPv6 traffic when IPv6 hosts must traverse IP4 networks to reach other IPv6 networks.</span></span> <span data-ttu-id="82a8e-131">IPv6 パケットは、IPv4 パケットとしてトンネリングされて送信されます。</span><span class="sxs-lookup"><span data-stu-id="82a8e-131">IPv6 packets are sent tunneled as IPv4 packets.</span></span> <span data-ttu-id="82a8e-132">NAT デバイスを介した IPv6 アドレスの NAT トラバーサルを可能にする複数のトンネリング手法が使用されています。</span><span class="sxs-lookup"><span data-stu-id="82a8e-132">Several tunneling techniques are being used that allow NAT traversal for IPv6 addresses through a NAT device.</span></span>  
  
 <span data-ttu-id="82a8e-133">Teredo は、IPv4 ネットワークで IPv6 接続を実現する IPv6 移行テクノロジの 1 つです。</span><span class="sxs-lookup"><span data-stu-id="82a8e-133">Teredo is one of the IPv6 transition technologies which brings IPv6 connectivity to IPv4 networks.</span></span> <span data-ttu-id="82a8e-134">Teredo は、インターネット技術標準化委員会 (IETF) が公開している RFC 4380 で規定されています。</span><span class="sxs-lookup"><span data-stu-id="82a8e-134">Teredo is documented in RFC 4380 published by the Internet Engineering Task Force (IETF).</span></span> <span data-ttu-id="82a8e-135">Windows XP SP2 以降では、2001:0::/32 の範囲でパブリック IPv6 アドレスを提供する仮想 Teredo アダプターがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="82a8e-135">Windows XP SP2 and later provide support for a virtual Teredo adapter which can provide a public IPv6 address in the range 2001:0::/32.</span></span> <span data-ttu-id="82a8e-136">この IPv6 アドレスは、インターネットからの着信接続をリッスンするために使用でき、リッスンしているサービスに接続しようとする IPv6 対応クライアントに提供できます。</span><span class="sxs-lookup"><span data-stu-id="82a8e-136">This IPv6 address can be used to listen for incoming connections from the Internet and can be provided to IPv6 enabled clients that wish to connect to the listening service.</span></span> <span data-ttu-id="82a8e-137">これにより、IPv6 Teredo アドレスを使用してそのコンピューターに接続できるようになるため、アプリケーションは NAT デバイスの背後にあるコンピューターのアドレスを指定する方法について考慮する必要がなくなります。</span><span class="sxs-lookup"><span data-stu-id="82a8e-137">This frees an application from worrying about how to address a computer behind a NAT device, since the application can just connect to it using its IPv6 Teredo address.</span></span>  
  
## <a name="enhancements-to-support-nat-traversal-and-teredo"></a><span data-ttu-id="82a8e-138">NAT トラバーサルと Teredo をサポートするための機能強化</span><span class="sxs-lookup"><span data-stu-id="82a8e-138">Enhancements to Support NAT Traversal and Teredo</span></span>  

 <span data-ttu-id="82a8e-139">IPv6 および Teredo を使用した NAT トラバーサルをサポートするために、<xref:System.Net>、<xref:System.Net.NetworkInformation>、および <xref:System.Net.Sockets> 名前空間に強化機能が追加されました。</span><span class="sxs-lookup"><span data-stu-id="82a8e-139">Enhancements are added to the <xref:System.Net>, <xref:System.Net.NetworkInformation>, and <xref:System.Net.Sockets> namespaces for supporting NAT traversal using IPv6 and Teredo.</span></span>  
  
 <span data-ttu-id="82a8e-140"><xref:System.Net.NetworkInformation.IPGlobalProperties?displayProperty=nameWithType> クラスに、ホスト上のユニキャスト IP アドレスの一覧を取得するための複数のメソッドが追加されています。</span><span class="sxs-lookup"><span data-stu-id="82a8e-140">Several methods are added to the <xref:System.Net.NetworkInformation.IPGlobalProperties?displayProperty=nameWithType> class to get the list of unicast IP addresses on the host.</span></span> <span data-ttu-id="82a8e-141"><xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A> メソッドは、ローカル コンピューター上の安定したユニキャスト IP アドレス テーブルを取得するための非同期要求を開始します。</span><span class="sxs-lookup"><span data-stu-id="82a8e-141">The <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A> method begins an asynchronous request to retrieve the stable unicast IP address table on the local computer.</span></span> <span data-ttu-id="82a8e-142"><xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A> メソッドは、ローカル コンピューター上の安定したユニキャスト IP アドレス テーブルを取得するための保留中の非同期要求を終了します。</span><span class="sxs-lookup"><span data-stu-id="82a8e-142">The <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A> method ends a pending asynchronous request to retrieve the stable unicast IP address table on the local computer.</span></span> <span data-ttu-id="82a8e-143"><xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A> メソッドは、ローカル コンピューター上の安定したユニキャスト IP アドレス テーブルを取得するための同期要求であり、アドレス テーブルが安定化されるまで必要に応じて待機します。</span><span class="sxs-lookup"><span data-stu-id="82a8e-143">The <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A> method is a synchronous request to retrieve the stable unicast IP address table on the local computer, waiting until the address table stabilizes if necessary.</span></span>  
  
 <span data-ttu-id="82a8e-144"><xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType> プロパティは、<xref:System.Net.IPAddress> が IPv6 Teredo アドレスであるかどうかを確認するために使用できます。</span><span class="sxs-lookup"><span data-stu-id="82a8e-144">The <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType> property can be used to determine if an <xref:System.Net.IPAddress> is an IPv6 Teredo address.</span></span>  
  
 <span data-ttu-id="82a8e-145">これらの新しい <xref:System.Net.NetworkInformation.IPGlobalProperties> クラス メソッドを <xref:System.Net.IPAddress.IsIPv6Teredo%2A> プロパティと組み合わせて使用することで、アプリケーションは Teredo アドレスを簡単に見つけることができます。</span><span class="sxs-lookup"><span data-stu-id="82a8e-145">Using these new <xref:System.Net.NetworkInformation.IPGlobalProperties> class methods in combination with the <xref:System.Net.IPAddress.IsIPv6Teredo%2A> property allows an application to easily find the Teredo address.</span></span> <span data-ttu-id="82a8e-146">通常、アプリケーションが知る必要があるのは、ローカルの Teredo アドレスだけです (アプリケーションがこの情報をリモート アプリケーションに送信する場合)。</span><span class="sxs-lookup"><span data-stu-id="82a8e-146">An application normally only needs to know the local Teredo address if it is communicating this information to remote applications.</span></span> <span data-ttu-id="82a8e-147">たとえば、ピアツーピア アプリケーションがすべての IPv6 アドレスをマッチメイキング サーバーに送信し、サーバーが受け取ったアドレスを他のピアに転送して直接通信ができるようにする場合です。</span><span class="sxs-lookup"><span data-stu-id="82a8e-147">For example, a peer-to-peer application might send all of its IPv6 addresses to a matchmaking server which can then forward them to others peers to enable direct communication.</span></span>  
  
 <span data-ttu-id="82a8e-148">アプリケーションは通常、ローカルの Teredo アドレスではなく <xref:System.Net.IPAddress.IPv6Any?displayProperty=nameWithType> でリッスンするようにリッスン サービスを設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82a8e-148">An application should normally set its listening service to listen on <xref:System.Net.IPAddress.IPv6Any?displayProperty=nameWithType> rather than on the local Teredo address.</span></span> <span data-ttu-id="82a8e-149">そのため、リモート クライアントまたはピアが、リッスンしているサービスのホストへの直接的な IPv6 ルートを持っている場合、クライアントまたはピアは、IPv6 を使用して直接接続することができ、Teredo を使用してパケットをトンネリングする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="82a8e-149">So if a remote client or peer has a direct IPv6 route to the host of the listening service, the client or peer can connect directly using IPv6 and not have to use Teredo to tunnel packets.</span></span>  
  
 <span data-ttu-id="82a8e-150">TCP アプリケーションの場合、<xref:System.Net.Sockets.TcpListener?displayProperty=nameWithType> クラスに、NAT トラバーサルを有効にする <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A> メソッドがあります。</span><span class="sxs-lookup"><span data-stu-id="82a8e-150">For TCP applications, the <xref:System.Net.Sockets.TcpListener?displayProperty=nameWithType> class has an <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A> method to enable NAT traversal.</span></span> <span data-ttu-id="82a8e-151">UDP アプリケーションの場合、<xref:System.Net.Sockets.UdpClient?displayProperty=nameWithType> クラスに、NAT トラバーサルを有効にする <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A> メソッドがあります。</span><span class="sxs-lookup"><span data-stu-id="82a8e-151">For UDP applications, the <xref:System.Net.Sockets.UdpClient?displayProperty=nameWithType> class has an <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A> method to enable NAT traversal.</span></span>  
  
 <span data-ttu-id="82a8e-152"><xref:System.Net.Sockets.Socket?displayProperty=nameWithType> および関連したクラスを使用するアプリケーションでは、<xref:System.Net.Sockets.Socket.GetSocketOption%2A> メソッドと <xref:System.Net.Sockets.Socket.SetSocketOption%2A> メソッドを <xref:System.Net.Sockets.SocketOptionName.IPProtectionLevel?displayProperty=nameWithType> ソケット オプションと共に使用して、NAT トラバーサルのクエリ、有効化、または無効化を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="82a8e-152">For applications that use the <xref:System.Net.Sockets.Socket?displayProperty=nameWithType> and related classes, the <xref:System.Net.Sockets.Socket.GetSocketOption%2A> and <xref:System.Net.Sockets.Socket.SetSocketOption%2A> methods can be used with the <xref:System.Net.Sockets.SocketOptionName.IPProtectionLevel?displayProperty=nameWithType> socket option to query, enable, or disable NAT traversal.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="82a8e-153">関連項目</span><span class="sxs-lookup"><span data-stu-id="82a8e-153">See also</span></span>

- <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType>
- <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A?displayProperty=nameWithType>
- <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A?displayProperty=nameWithType>
- <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A?displayProperty=nameWithType>
- <xref:System.Net.Sockets.IPProtectionLevel?displayProperty=nameWithType>
- <xref:System.Net.Sockets.Socket.SetIPProtectionLevel%2A?displayProperty=nameWithType>
- <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A?displayProperty=nameWithType>
- <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A?displayProperty=nameWithType>
